<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Joffrey Joumaa">
<meta name="dcterms.date" content="2017-06-05">
<title>Booking Interview Project – Joffrey Joumaa | portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-2f8a1b2753634644d1dc90402284f863.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-c3132db34a2a42639c44de93e826e000.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Joffrey Joumaa | portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-notebooks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Notebooks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-notebooks">
<li>
    <a class="dropdown-item" href="./dataiku_jjoumaa.html">
 <span class="dropdown-text">Dataiku Interview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./saegus_jjoumaa.html">
 <span class="dropdown-text">Saegus Interview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./booking_jjoumaa.html">
 <span class="dropdown-text">Booking Interview</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-webapps" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Webapps</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-webapps">
<li>
    <a class="dropdown-item" href="https://nestrack.duckdns.org/" target="_blank">
 <span class="dropdown-text">DiveMap (Python)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://dash-risk.onrender.com/" target="_blank">
 <span class="dropdown-text">CropRisk (Python)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://joffreyjoumaa.shinyapps.io/shiny_risk/" target="_blank">
 <span class="dropdown-text">CropRisk (R)</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-packages" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Packages</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-packages">
<li>
    <a class="dropdown-item" href="https://sesjo.github.io/ontodive/" target="_blank">
 <span class="dropdown-text">ontodive</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="./resume_jjoumaa.html"> 
<span class="menu-text">Resume</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="https://www.researchgate.net/profile/Joffrey-Joumaa-2" target="_blank"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="simple-icons:researchgate" aria-label="Icon researchgate from simple-icons Iconify.design set." title="Icon researchgate from simple-icons Iconify.design set."></iconify-icon></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=8x1xOj4AAAAJ&amp;hl" target="_blank"> <i class="bi bi-mortarboard-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://orcid.org/0000-0002-2862-0899" target="_blank"> <i class="bi bi-fingerprint" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/joffreyjoumaa/" target="_blank"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/SESjo" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#loading-library" id="toc-loading-library" class="nav-link active" data-scroll-target="#loading-library"><span class="header-section-number">1</span> Loading library</a></li>
  <li><a href="#preambule" id="toc-preambule" class="nav-link" data-scroll-target="#preambule"><span class="header-section-number">2</span> Preambule</a></li>
  <li>
<a href="#first-question" id="toc-first-question" class="nav-link" data-scroll-target="#first-question"><span class="header-section-number">3</span> First question</a>
  <ul class="collapse">
<li><a href="#statement" id="toc-statement" class="nav-link" data-scroll-target="#statement"><span class="header-section-number">3.1</span> Statement</a></li>
  <li>
<a href="#data-mining" id="toc-data-mining" class="nav-link" data-scroll-target="#data-mining"><span class="header-section-number">3.2</span> Data mining</a>
  <ul class="collapse">
<li><a href="#FC1" id="toc-FC1" class="nav-link" data-scroll-target="#FC1"><span class="header-section-number">3.2.1</span> Few comments</a></li>
  <li><a href="#analysis-results" id="toc-analysis-results" class="nav-link" data-scroll-target="#analysis-results"><span class="header-section-number">3.2.2</span> Analysis &amp; Results</a></li>
  </ul>
</li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions"><span class="header-section-number">3.3</span> Conclusions</a></li>
  </ul>
</li>
  <li>
<a href="#second-question" id="toc-second-question" class="nav-link" data-scroll-target="#second-question"><span class="header-section-number">4</span> Second question</a>
  <ul class="collapse">
<li><a href="#statement-1" id="toc-statement-1" class="nav-link" data-scroll-target="#statement-1"><span class="header-section-number">4.1</span> Statement</a></li>
  <li>
<a href="#data-mining-1" id="toc-data-mining-1" class="nav-link" data-scroll-target="#data-mining-1"><span class="header-section-number">4.2</span> Data mining</a>
  <ul class="collapse">
<li><a href="#few-comments" id="toc-few-comments" class="nav-link" data-scroll-target="#few-comments"><span class="header-section-number">4.2.1</span> Few comments</a></li>
  <li><a href="#analysis-results-1" id="toc-analysis-results-1" class="nav-link" data-scroll-target="#analysis-results-1"><span class="header-section-number">4.2.2</span> Analysis &amp; Results</a></li>
  </ul>
</li>
  <li><a href="#conclusions-1" id="toc-conclusions-1" class="nav-link" data-scroll-target="#conclusions-1"><span class="header-section-number">4.3</span> Conclusions</a></li>
  </ul>
</li>
  <li>
<a href="#other-insights" id="toc-other-insights" class="nav-link" data-scroll-target="#other-insights"><span class="header-section-number">5</span> Other insights</a>
  <ul class="collapse">
<li><a href="#few-comments-1" id="toc-few-comments-1" class="nav-link" data-scroll-target="#few-comments-1"><span class="header-section-number">5.1</span> Few comments</a></li>
  <li><a href="#analysis-results-2" id="toc-analysis-results-2" class="nav-link" data-scroll-target="#analysis-results-2"><span class="header-section-number">5.2</span> Analysis &amp; Results</a></li>
  <li><a href="#conclusions-2" id="toc-conclusions-2" class="nav-link" data-scroll-target="#conclusions-2"><span class="header-section-number">5.3</span> Conclusions</a></li>
  </ul>
</li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix"><span class="header-section-number">6</span> Appendix</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Booking Interview Project</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joffrey Joumaa </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 5, 2017</p>
    </div>
  </div>
  
    
  </div>
  


</header><style>
body {
text-align: justify}
</style>
<section id="loading-library" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Loading library</h1>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/">nlme</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/">pander</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">itsadug</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="co"># avoid scientific notation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>scipen <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="preambule" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Preambule</h1>
<p>I received an email from Irina Itu (HQ Recruiter - <a href="https://www.booking.com">Booking.com</a>), the 2<sup>nd</sup> of June including two documents:</p>
<ul>
<li>
<strong>Assessment_Reporting_Analyst.pdf</strong>, the document presenting the situation and the questions that I have to answer as a reporting analyst.</li>
<li>
<strong>Assessment_Reporting_Analyst.csv</strong>, the dataset that would allow me to addressed these questions.</li>
</ul>
<p>To make sure everyone knows what I am dealing with, you will find a summary of those data <a href="#tbl-str" class="quarto-xref">Table&nbsp;1</a>:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># dataset loading</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"./booking_data//Assessment_Reporting_Analyst.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># time format</span></span>
<span><span class="va">data</span><span class="op">[</span>, <span class="va">first_opened</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="va">first_opened</span>, tz <span class="op">=</span> <span class="st">"UTC"</span>, format <span class="op">=</span> <span class="st">"%m/%d/%y"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>,</span>
<span>    classe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">typeof</span><span class="op">)</span>,</span>
<span>    first_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">data</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    row.names <span class="op">=</span> <span class="cn">NULL</span></span>
<span>  <span class="op">)</span>,</span>
<span>  booktabs <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-str" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-str-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Summary of the provided dataset.
</figcaption><div aria-describedby="tbl-str-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 9%">
<col style="width: 70%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: left;">classe</th>
<th style="text-align: left;">first_values</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">id</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">56676, 99059, 17540, 105158, 107208, 46448</td>
</tr>
<tr class="even">
<td style="text-align: left;">city</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">Paris, Napoli, Paris, Florence, Cannes, Paris</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cc1</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">fr, it, fr, it, fr, fr</td>
</tr>
<tr class="even">
<td style="text-align: left;">minrate</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">234.22, 58.8, 0, 146.02, 78.4, 184.7496</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nr_rooms</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">1, 1, 1, 1, 1, 1</td>
</tr>
<tr class="even">
<td style="text-align: left;">checkin</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">14:00, 14:00, 16:00, 17:00, 16:00, 15:00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">default_comm_lang</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">NA, it, en, it, fr, NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">office_id</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">4, 353, 4, 279, 378, 4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">km_from_city_center</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">2, 15, 0, 6, 13, 0</td>
</tr>
<tr class="even">
<td style="text-align: left;">first_opened</td>
<td style="text-align: left;">double</td>
<td style="text-align: left;">2015-04-14, 2015-11-04, 2014-05-14, 2016-02-02, 2016-02-23, 2014-12-05</td>
</tr>
<tr class="odd">
<td style="text-align: left;">payment_method</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">cc,bt, bc, cc,ca,bt,bc, cc,ca, cc,bt, ca</td>
</tr>
<tr class="even">
<td style="text-align: left;">star_rating</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">5, 5, 2, 5, 3, 5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hotel_type</td>
<td style="text-align: left;">character</td>
<td style="text-align: left;">Apartment, Holiday home, Apartment, Apartment, Villa, Apartment</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>This represents a random sample of 10.000 properties from April 2016, wihtout information on the availability of properties.</p>
</section><section id="first-question" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> First question</h1>
<section id="statement" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="statement">
<span class="header-section-number">3.1</span> Statement</h2>
<p>“<em>Dear Reporting Team,</em></p>
<p><em>I am account manager for France. I would like to get some insights in our supply in regards to the football championship that will be held in France this year. I am especially interested to see if we are opening enough new properties. Can you please share your findings on our supply and highlight your outtakes?</em></p>
<p><em>Thanks in advance.</em>”</p>
</section><section id="data-mining" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="data-mining">
<span class="header-section-number">3.2</span> Data mining</h2>
<section id="FC1" class="level3" data-number="3.2.1"><h3 data-number="3.2.1" class="anchored" data-anchor-id="FC1">
<span class="header-section-number">3.2.1</span> Few comments</h3>
<p>The dataset (<code>data</code>) is considered as a snapshot of 10.000 properties randomly selected in 10 cities: Paris, Napoli, Florence, Cannes, Roma, Nice, Palermo, Milano, Venice, Lyon, during April 2016. That means we do not know what proportion these 10.000 properties represent in each cities. In addition, this dataset do not include any information on the estimation of the number of people that will attend the football championship this summer, neither the proportion of these people that is expected to book a reservation via <a href="https://www.booking.com">Booking.com</a>, nor the number of properties already booked through <a href="https://www.booking.com">Booking.com</a>. Considering these, we need to:</p>
<ul>
<li>Have an idea of the proportion these 10.000 properties represent of the <a href="https://www.booking.com">Booking.com</a>’s offer in each city;</li>
<li>Estimate the number of people that will attend the football championship.</li>
</ul>
<p>We also need to make several asumption:</p>
<ul>
<li>Considering the football championship will be held in France, we will only keep french cities in our analysis. In addition, in the present dataset, only Paris, Lyon and Nice have a stadium that will be used for the competition (<a href="https://en.wikipedia.org/wiki/UEFA_Euro_2016">UEFA2016 - Wikipedia</a>), so we will focus on these cities thereafter;</li>
<li>Someone that will attend the football championship is defined here as someone with a ticket for a match (and not someone that will only go to the Fan zones);</li>
</ul></section><section id="analysis-results" class="level3" data-number="3.2.2"><h3 data-number="3.2.2" class="anchored" data-anchor-id="analysis-results">
<span class="header-section-number">3.2.2</span> Analysis &amp; Results</h3>
<section id="number-of-rooms-available" class="level4" data-number="3.2.2.1"><h4 data-number="3.2.2.1" class="anchored" data-anchor-id="number-of-rooms-available">
<span class="header-section-number">3.2.2.1</span> Number of rooms available</h4>
<p>Based on a snapshot of the website <a href="https://www.booking.com">Booking.com</a> dated of April 1<sup>st</sup>, 2016 (thanks to <a href="https://web.archive.org">web.archive.org</a>), we know that Paris has <a href="https://web.archive.org/web/20160401205022/http://www.booking.com/city/fr/paris.fr.html">3981</a> properties, Nice <a href="https://web.archive.org/web/20160401225547/http://www.booking.com/city/fr/nice.fr.html">856</a>, and Lyon <a href="https://web.archive.org/web/20160401210028/http://www.booking.com/city/fr/lyon.fr.html">396</a> (<a href="#tbl-properAvailable" class="quarto-xref">Table&nbsp;2</a>).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># subset with the relevant cities</span></span>
<span><span class="va">data.uefa</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">city</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Paris"</span>, <span class="st">"Nice"</span>, <span class="st">"Lyon"</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co"># nb of properties in dataset per city</span></span>
<span><span class="va">data.uefa.cities</span> <span class="op">&lt;-</span> <span class="va">data.uefa</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span></span>
<span>  nb_rooms_dataset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">nr_rooms</span><span class="op">)</span>,</span>
<span>  nb_properties_dataset <span class="op">=</span> <span class="va">.N</span></span>
<span><span class="op">)</span>, by <span class="op">=</span> <span class="va">city</span><span class="op">]</span></span>
<span><span class="co"># add nb of properties available</span></span>
<span><span class="va">data.uefa.cities</span><span class="op">[</span>, <span class="va">nb_properties_available</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3981</span>, <span class="fl">856</span>, <span class="fl">396</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># proportion of properties in the dataset</span></span>
<span><span class="va">data.uefa.cities</span><span class="op">[</span>, <span class="va">prop_properties_dataset</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="op">(</span><span class="fl">100</span> <span class="op">/</span> <span class="va">nb_properties_available</span><span class="op">)</span> <span class="op">*</span> <span class="va">nb_properties_dataset</span>, <span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># nb of rooms available based on the proportion of properties in the dataset</span></span>
<span><span class="va">data.uefa.cities</span><span class="op">[</span>, <span class="va">nb_rooms_available</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="op">(</span><span class="va">nb_rooms_dataset</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span> <span class="op">/</span> <span class="va">prop_properties_dataset</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">data.uefa.cities</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-properAvailable" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-properAvailable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Summary of properties available based on the provided dataset.
</figcaption><div aria-describedby="tbl-properAvailable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 5%">
<col style="width: 15%">
<col style="width: 19%">
<col style="width: 21%">
<col style="width: 21%">
<col style="width: 16%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">city</th>
<th style="text-align: right;">nb_rooms_dataset</th>
<th style="text-align: right;">nb_properties_dataset</th>
<th style="text-align: right;">nb_properties_available</th>
<th style="text-align: right;">prop_properties_dataset</th>
<th style="text-align: right;">nb_rooms_available</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Paris</td>
<td style="text-align: right;">7411</td>
<td style="text-align: right;">2009</td>
<td style="text-align: right;">3981</td>
<td style="text-align: right;">50.46</td>
<td style="text-align: right;">14686</td>
</tr>
<tr class="even">
<td style="text-align: left;">Nice</td>
<td style="text-align: right;">869</td>
<td style="text-align: right;">580</td>
<td style="text-align: right;">856</td>
<td style="text-align: right;">67.76</td>
<td style="text-align: right;">1282</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lyon</td>
<td style="text-align: right;">553</td>
<td style="text-align: right;">188</td>
<td style="text-align: right;">396</td>
<td style="text-align: right;">47.47</td>
<td style="text-align: right;">1164</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>This means the dataset <code>data</code> represents 50.46 % of the properties in Paris, 67.76 % of the properties in Nice and 47.47 % of the properties in Lyon (considering these proportions, the 10.000 properties within this dataset were probably not randomly selected after all…). Based on the number of rooms available in the dataset and these proportions, we estimated the total number of rooms available for:</p>
<ul>
<li>Paris of 14,686;</li>
<li>Nice of 1,282;</li>
<li>Lyon of 1,164.</li>
</ul></section><section id="number-of-attendees-per-city" class="level4" data-number="3.2.2.2"><h4 data-number="3.2.2.2" class="anchored" data-anchor-id="number-of-attendees-per-city">
<span class="header-section-number">3.2.2.2</span> Number of attendees per city</h4>
<p>I based my estimation of the number of attendees (<a href="#fig-attendees" class="quarto-xref">Figure&nbsp;1</a>) on the capacity of each stadium in each cities, multiplied by the number of matches, based on the Wikipedia page (<a href="https://en.wikipedia.org/wiki/UEFA_Euro_2016">UEFA-2016</a>).</p>
<ul>
<li>Paris with 5 matches at the <a href="https://en.wikipedia.org/wiki/Parc_des_Princes"><em>Parc des Princes</em></a> (capacity: 48712) and 7 matches at the <a href="https://en.wikipedia.org/wiki/Stade_de_France"><em>Stade de France</em></a> (capacity: 81338) =&gt; <span class="math inline">\(5 \times 48712 + 7 \times 81338 = 812926\)</span>;</li>
<li>Nice with 4 matches at the <a href="https://en.wikipedia.org/wiki/Allianz_Riviera"><em>Stade de Nice</em></a> (capacity: 35624) =&gt; <span class="math inline">\(4 \times 35624 = 142496\)</span>;</li>
<li>Lyon with 3 matches at the <a href="https://en.wikipedia.org/wiki/Parc_Olympique_Lyonnais"><em>Parc Olympique Lyonnais</em></a> (capacity: 59186) =&gt; <span class="math inline">\(3 \times 59186 = 177558\)</span>.</li>
</ul>
<p>For Paris, I also considered to include the <em>Stade de France</em> which is located in Saint-Denis, closed to Paris. As specified in the <a href="#FC1">Few comments</a> section, this basically means that I made the following assumption:</p>
<blockquote class="blockquote">
<p>1 ticket = 1 attendee</p>
</blockquote>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span></span>
<span>  City <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Paris"</span>, <span class="st">"Nice"</span>, <span class="st">"Lyon"</span><span class="op">)</span>,</span>
<span>  Attendees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">812926</span>, <span class="fl">142496</span>, <span class="fl">177558</span><span class="op">)</span></span>
<span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">City</span>, <span class="va">Attendees</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Expected number of attendees"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-attendees" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-attendees-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="booking_jjoumaa_files/figure-html/fig-attendees-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-attendees-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Expected number of attendees per city based on the capacity of each stadium.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="number-of-rooms-vs.-number-of-attendees" class="level4" data-number="3.2.2.3"><h4 data-number="3.2.2.3" class="anchored" data-anchor-id="number-of-rooms-vs.-number-of-attendees">
<span class="header-section-number">3.2.2.3</span> Number of rooms vs.&nbsp;number of attendees</h4>
<p>Considering that <a href="https://www.booking.com">Booking.com</a> is able to offer a maximum of 14,686, 1,282 and 1,164 rooms, for respectively Paris, Nice and Lyon, a simple difference (<a href="#fig-diffNbRoomsNbAttendees" class="quarto-xref">Figure&nbsp;2</a>) shows that <a href="https://www.booking.com">Booking.com</a> needs to increase significantly the number of rooms available, and so of properties, to reach the demand and welcome all the attendees of the football championship.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span></span>
<span>    City <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Paris"</span>, <span class="st">"Nice"</span>, <span class="st">"Lyon"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>    Attendees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>      <span class="fl">812926</span> <span class="op">-</span> <span class="va">data.uefa.cities</span><span class="op">[</span><span class="va">city</span> <span class="op">==</span> <span class="st">"Paris"</span>, <span class="va">nb_rooms_available</span><span class="op">]</span>,</span>
<span>      <span class="fl">142496</span> <span class="op">-</span> <span class="va">data.uefa.cities</span><span class="op">[</span><span class="va">city</span> <span class="op">==</span> <span class="st">"Nice"</span>, <span class="va">nb_rooms_available</span><span class="op">]</span>,</span>
<span>      <span class="fl">177558</span> <span class="op">-</span> <span class="va">data.uefa.cities</span><span class="op">[</span><span class="va">city</span> <span class="op">==</span> <span class="st">"Lyon"</span>, <span class="va">nb_rooms_available</span><span class="op">]</span>,</span>
<span>      <span class="va">data.uefa.cities</span><span class="op">[</span><span class="va">city</span> <span class="op">==</span> <span class="st">"Paris"</span>, <span class="va">nb_rooms_available</span><span class="op">]</span>,</span>
<span>      <span class="va">data.uefa.cities</span><span class="op">[</span><span class="va">city</span> <span class="op">==</span> <span class="st">"Nice"</span>, <span class="va">nb_rooms_available</span><span class="op">]</span>,</span>
<span>      <span class="va">data.uefa.cities</span><span class="op">[</span><span class="va">city</span> <span class="op">==</span> <span class="st">"Lyon"</span>, <span class="va">nb_rooms_available</span><span class="op">]</span></span>
<span>    <span class="op">)</span>,</span>
<span>    Group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Other"</span>, <span class="st">"Other"</span>, <span class="st">"Other"</span>, <span class="st">"Booking"</span>, <span class="st">"Booking"</span>, <span class="st">"Booking"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">City</span>, <span class="va">Attendees</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">Group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span></span>
<span>    title.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"accommodation"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Expected number of attendees"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-diffNbRoomsNbAttendees" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diffNbRoomsNbAttendees-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="booking_jjoumaa_files/figure-html/fig-diffNbRoomsNbAttendees-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diffNbRoomsNbAttendees-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Histogram of the number of attendees per city with a colour code for the capacity of <a href="https://www.booking.com">Booking.com</a> to provide them a room.
</figcaption></figure>
</div>
</div>
</div>
<p>Fortunately for <a href="https://www.booking.com">Booking.com</a>, this graph does not take into consideration two features:</p>
<ul>
<li>The real proportion of attendees behind our estimation of the number of attendees, <em>e.g</em> an attendee could buy two tickets, meaning that our estimation of the number of attendees is over-estimated;</li>
<li>Not all the estimated attendees will book a room though Booking.com, in other words what is the market share of <a href="https://www.booking.com">Booking.com</a> among those who will book a room through internet.</li>
</ul>
<p>Considering this, I propose an image plot (<a href="#fig-imgplot" class="quarto-xref">Figure&nbsp;3</a>) where we can easily read if <a href="https://www.booking.com">Booking.com</a> has enough rooms available considering (<em>i</em>) the real proportion of attendees based on our estimation, and (<em>ii</em>) the proportion of this people that will book a room through <a href="https://www.booking.com">Booking.com</a>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># a function to create a 100x100 matrix of the number of rooms available in function of the proportion of real attendees and the proportion of these people that will book a room through Booking.com</span></span>
<span><span class="va">img.fct</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nb_attendees</span>, <span class="va">nb_rooms</span>, <span class="va">city</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">nb_rooms</span> <span class="op">&lt;-</span> <span class="va">nb_rooms</span></span>
<span>  <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nb_attendees</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">100</span>, ncol <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="fl">100</span>, <span class="fl">100</span> <span class="op">/</span> <span class="fl">100</span>, length <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">100</span>, ncol <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">C</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">A</span> <span class="op">*</span> <span class="va">B</span><span class="op">)</span> <span class="op">-</span> <span class="va">nb_rooms</span></span>
<span>  <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span></span>
<span>  <span class="va">D</span><span class="op">$</span><span class="va">City</span> <span class="op">&lt;-</span> <span class="va">city</span></span>
<span>  <span class="va">D</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># calculation of this matrix for each city</span></span>
<span><span class="va">img.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu">img.fct</span><span class="op">(</span><span class="fl">812926</span>, <span class="va">data.uefa.cities</span><span class="op">[</span><span class="va">city</span> <span class="op">==</span> <span class="st">"Paris"</span>, <span class="va">nb_rooms_available</span><span class="op">]</span>, <span class="st">"Paris"</span><span class="op">)</span>,</span>
<span>  <span class="fu">img.fct</span><span class="op">(</span><span class="fl">142496</span>, <span class="va">data.uefa.cities</span><span class="op">[</span><span class="va">city</span> <span class="op">==</span> <span class="st">"Nice"</span>, <span class="va">nb_rooms_available</span><span class="op">]</span>, <span class="st">"Nice"</span><span class="op">)</span>,</span>
<span>  <span class="fu">img.fct</span><span class="op">(</span><span class="fl">177558</span>, <span class="va">data.uefa.cities</span><span class="op">[</span><span class="va">city</span> <span class="op">==</span> <span class="st">"Lyon"</span>, <span class="va">nb_rooms_available</span><span class="op">]</span>, <span class="st">"Lyon"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">img.data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Var1</span>, <span class="va">Var2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>, interpolate <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Proportion of attendees that will book reservation through Booking.com (%)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Proportion of real attendees based on my estimation (%)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>    colours <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    na.value <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">60</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">3000</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">160000</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">60</span>, <span class="fl">3000</span>, <span class="fl">160000</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html">guide_colorbar</a></span><span class="op">(</span></span>
<span>    title.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    barwidth <span class="op">=</span> <span class="fl">11</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Additional nb of rooms to open"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="st">"~ City"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-imgplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-imgplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="booking_jjoumaa_files/figure-html/fig-imgplot-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-imgplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Image plot for the three cities of the number of rooms vs.&nbsp;the real proportion of attendees based on our estimation and the proportion of this people that will book a room through <a href="https://www.booking.com">Booking.com</a>.
</figcaption></figure>
</div>
</div>
</div>
<p>In <a href="#fig-imgplot" class="quarto-xref">Figure&nbsp;3</a>, the <em>grey</em> area represents the number of rooms <a href="https://www.booking.com">Booking.com</a> is able to offer, considering a certain proportion of real attendees as well as a proportion of these people that will book a room through <a href="https://www.booking.com">Booking.com</a>.</p>
</section></section></section><section id="conclusions" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="conclusions">
<span class="header-section-number">3.3</span> Conclusions</h2>
<p>Considering all the assumptions and results, Paris seems to have the best capacity to welcome attendees, compared to Nice or Lyon (in <a href="#fig-imgplot" class="quarto-xref">Figure&nbsp;3</a>), the <em>grey</em> area is bigger for Paris than Nice and Lyon). Based on this results, I would recommend to increase the number of properties in both cities (Nice and Lyon) to make sure it reach the same level of capacity than Paris. In order to reach this same level of capacity, Nice has to open 1,293 rooms and Lyon 2,044. In addition, assuming that one ticket in four (the choice is totally arbitrary) will be sell to someone looking for an accommodation, <em>i.e.</em> 25 % of the proportion of real attendees and that 20 % (also an arbitrary choice) of these people will look for an accommodation through <a href="https://www.booking.com">Booking.com</a>, it appears that 24,728, 5,627 and 7,445 rooms needs to be available in Paris, Nice and Lyon, that is to say respectively 6,704, 3,756 and 2,532 new properties to meet the demand.</p>
</section></section><section id="second-question" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Second question</h1>
<section id="statement-1" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="statement-1">
<span class="header-section-number">4.1</span> Statement</h2>
<p>“<em>Dear Reporting Team,</em></p>
<p><em>Lately I get the feeling that the properties we are opening in Southern Europe are getting more and more expensive, while our customers demand lower priced accommodations. I would like to present some data in our next account managers meetup, but of course I would like to have some validated insights to back this up. Can you help me out on this?</em></p>
<p><em>Regards.</em>”</p>
</section><section id="data-mining-1" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="data-mining-1">
<span class="header-section-number">4.2</span> Data mining</h2>
<section id="few-comments" class="level3" data-number="4.2.1"><h3 data-number="4.2.1" class="anchored" data-anchor-id="few-comments">
<span class="header-section-number">4.2.1</span> Few comments</h3>
<p>As I only get a snapshot of the situation for 10.000 properties randomly selected from April 2016, we will focus on the relationship between the minimal room rate for a single-night (<code>minrate</code>) and the date that the property was available at <a href="https://www.booking.com">Booking.com</a> for the first time (<code>first_opened</code>). I will thus test the hypothesis of an increase in <code>minrate</code> with <code>first_opened</code>. As the question is focused on the Southern Europe, I only considered cities in Italy (Napoli, Florence, Roma, Palermo, Milano, Venice) in the further analysis.</p>
</section><section id="analysis-results-1" class="level3" data-number="4.2.2"><h3 data-number="4.2.2" class="anchored" data-anchor-id="analysis-results-1">
<span class="header-section-number">4.2.2</span> Analysis &amp; Results</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># new dataset for Italia</span></span>
<span><span class="va">data.it</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">cc1</span> <span class="op">==</span> <span class="st">"it"</span>, <span class="op">]</span></span>
<span><span class="co"># some exploratory graphs</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data.it</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">minrate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Minimal room rate for a single night"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Density"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data.it</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">minrate</span>, x <span class="op">=</span> <span class="va">city</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="st">"Minimal room rate for a single night"</span>,</span>
<span>      x <span class="op">=</span> <span class="st">"City"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-histBox" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-histBox-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="booking_jjoumaa_files/figure-html/fig-histBox-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histBox-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Histogram and boxplot of the minimal room rate for a single night in several italian cities.
</figcaption></figure>
</div>
</div>
</div>
<p>It appears there are a lot of outliers and zeros in the dataset (<a href="#fig-histBox" class="quarto-xref">Figure&nbsp;4</a>). I decided then to remove any rows with a minimal room rate for a single night of zero and other outliers using the IQR rule.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># we removed zeros</span></span>
<span><span class="va">data.it</span> <span class="op">&lt;-</span> <span class="va">data.it</span><span class="op">[</span><span class="va">minrate</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span><span class="co"># and other outliers</span></span>
<span><span class="va">outliers</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">q1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">out</span>, <span class="fl">0.25</span><span class="op">)</span></span>
<span>  <span class="va">q3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">out</span>, <span class="fl">0.75</span><span class="op">)</span></span>
<span>  <span class="va">iqr</span> <span class="op">&lt;-</span> <span class="va">q3</span> <span class="op">-</span> <span class="va">q1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">out</span> <span class="op">&gt;</span> <span class="va">q1</span> <span class="op">-</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="va">iqr</span> <span class="op">&amp;</span> <span class="va">out</span> <span class="op">&lt;</span> <span class="va">q3</span> <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="va">iqr</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">data.it.out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">data.it</span>, by <span class="op">=</span> <span class="st">"city"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu">outliers</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">minrate</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># new plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data.it.out</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">minrate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="st">"Minimal room rate for a single night"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Density"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data.it.out</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">minrate</span>, x <span class="op">=</span> <span class="va">city</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>      y <span class="op">=</span> <span class="st">"Minimal room rate for a single night"</span>,</span>
<span>      x <span class="op">=</span> <span class="st">"Cities"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-histBoxOUT" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-histBoxOUT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="booking_jjoumaa_files/figure-html/fig-histBoxOUT-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-histBoxOUT-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Histogram and boxplot of the minimal room rate in several italian cities, without considering outliers.
</figcaption></figure>
</div>
</div>
</div>
<p>This is much better, now we are going to look at the trend over time (<a href="#fig-distriMRRGAM" class="quarto-xref">Figure&nbsp;6</a>), by first using a <a href="https://en.wikipedia.org/wiki/Generalized_additive_model">generalized additive model</a>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data.it.out</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">first_opened</span>, y <span class="op">=</span> <span class="va">minrate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="st">"Minimal room rate for a single night"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date that the property was available at Booking.com for the first time"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-distriMRRGAM" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-distriMRRGAM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="booking_jjoumaa_files/figure-html/fig-distriMRRGAM-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-distriMRRGAM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Distribution of minimal room rates for a single night with the date that the property was available at <a href="https://www.booking.com">Booking.com</a> for the first time. The blue line is for a generalized additive model automatically adjusted with data.
</figcaption></figure>
</div>
</div>
</div>
<p>Nothing really clear here, neither using a simple linear regression (<a href="#fig-distriMRRLM" class="quarto-xref">Figure&nbsp;7</a>).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data.it.out</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">first_opened</span>, y <span class="op">=</span> <span class="va">minrate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    y <span class="op">=</span> <span class="st">"Minimal room rate for a single night"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Date that the property was available at Booking.com for the first time"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-distriMRRLM" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-distriMRRLM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="booking_jjoumaa_files/figure-html/fig-distriMRRLM-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-distriMRRLM-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Distribution of minimal room rates for a single night with the date that the property was available at <a href="https://www.booking.com">Booking.com</a> for the first time. The blue line is for a linear regression automatically adjusted with data.
</figcaption></figure>
</div>
</div>
</div>
<p>As the dataset is structured by city, it is better to include a random effect in our models, using a <a href="https://en.wikipedia.org/wiki/Mixed_model">linear mixed effects models</a>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># na.action = na.omit)"}</span></span>
<span><span class="co"># building LME</span></span>
<span><span class="va">lme.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlme/man/lme.html">lme</a></span><span class="op">(</span><span class="va">minrate</span> <span class="op">~</span> <span class="va">first_opened</span>, data <span class="op">=</span> <span class="va">data.it.out</span>, random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">city</span>, na.action <span class="op">=</span> <span class="va">na.omit</span><span class="op">)</span></span>
<span><span class="co"># results</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lme.1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-summaryLME" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-summaryLME-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Output for the linear mixed effect model: lme(minrate<sub>first_opened,data=data.it.out,random=</sub>1|city)
</figcaption><div aria-describedby="tbl-summaryLME-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Fixed effects: minrate ~ first_opened</caption>
<colgroup>
<col style="width: 26%">
<col style="width: 18%">
<col style="width: 16%">
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 15%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Value</th>
<th style="text-align: center;">Std.Error</th>
<th style="text-align: center;">DF</th>
<th style="text-align: center;">t-value</th>
<th style="text-align: center;">p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>(Intercept)</strong></td>
<td style="text-align: center;">144</td>
<td style="text-align: center;">54.1</td>
<td style="text-align: center;">4132</td>
<td style="text-align: center;">2.661</td>
<td style="text-align: center;">0.007811</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>first_opened</strong></td>
<td style="text-align: center;">-3.283e-08</td>
<td style="text-align: center;">3.598e-08</td>
<td style="text-align: center;">4132</td>
<td style="text-align: center;">-0.9123</td>
<td style="text-align: center;">0.3617</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Standardized Within-Group Residuals</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">Min</th>
<th style="text-align: center;">Q1</th>
<th style="text-align: center;">Med</th>
<th style="text-align: center;">Q3</th>
<th style="text-align: center;">Max</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: center;">-3.364</td>
<td style="text-align: center;">-0.6873</td>
<td style="text-align: center;">-0.1539</td>
<td style="text-align: center;">0.5618</td>
<td style="text-align: center;">3.79</td>
</tr></tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Linear mixed-effects model fit by REML : minrate ~ first_opened</caption>
<colgroup>
<col style="width: 15%">
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 38%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">&nbsp;</th>
<th style="text-align: center;">Observations</th>
<th style="text-align: center;">Groups</th>
<th style="text-align: center;">Log-restricted-likelihood</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: center;"><strong>city</strong></td>
<td style="text-align: center;">4139</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">-21373</td>
</tr></tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>The ouput reveals there is no significant (<code>p-value</code> for <code>first_opened</code> &gt; 0.05) linear trend over time (defined as the date the property was available for the first time) of the minimal room rate for a single. Now, I take a look at the residual to know how trustful this result is.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># diagnostic plots</span></span>
<span><span class="co"># plot(lme.1)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/acf.html">acf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">lme.1</span>, normalized <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">lme.1</span>, normalized <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">lme.1</span>, normalized <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-diagPlot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-diagPlot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="booking_jjoumaa_files/figure-html/fig-diagPlot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-diagPlot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Some diagnostic plot of the linear mixed effect model lme.1.
</figcaption></figure>
</div>
</div>
</div>
<p>The diagnostic plots (<a href="#fig-diagPlot" class="quarto-xref">Figure&nbsp;8</a>) realized on the residuals of the linear mixed effect model <code>lme.1</code> do not reveal any patterns, meaning the model is not missing any relevant variable. This also means that we can be confident in its results, regardless the city: there are no trend towards the minimal room rate for a single night with the date the property was available at Booking.com for the first time in this dataset.</p>
</section></section><section id="conclusions-1" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="conclusions-1">
<span class="header-section-number">4.3</span> Conclusions</h2>
<p>No matter the city considered, there is no trend towards the minimal room rate for a single night with the date the property was available at Booking.com for the first time. Rather, there is a relative stability of the room rate with the date the property was available for the first time. While this analysis is interesting, it would probably be even more interesting to look at the relationship of the minimal room rate with time, and not only during the month of April 2016. This would may be highlight trends in agreement with your feeling.</p>
</section></section><section id="other-insights" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> Other insights</h1>
<section id="few-comments-1" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="few-comments-1">
<span class="header-section-number">5.1</span> Few comments</h2>
<p>Given this dataset, there are a lot of questions that could be addressed, such as:</p>
<ul>
<li>Which city has the center the most covered by properties?</li>
<li>Is there any differences among cities and countries in terms of properties offering (<code>hotel_type</code>, <code>nr_rooms</code>, <code>payment_method</code> or <code>star_rating</code>)?</li>
<li>Can we relate the type of properties to the distance from the city center?</li>
</ul>
<p>But here, I decided to focus on the minimal room rate for a single night, and I tried to model this variable considering other information present within the dataset.</p>
</section><section id="analysis-results-2" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="analysis-results-2">
<span class="header-section-number">5.2</span> Analysis &amp; Results</h2>
<p>I basically used the same approach than before, I removed zeros and outliers:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># I removed zeros</span></span>
<span><span class="va">data.inter</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="va">minrate</span> <span class="op">!=</span> <span class="fl">0</span>, <span class="op">]</span></span>
<span><span class="co"># and other outliers</span></span>
<span><span class="va">data.inter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">data.inter</span>, by <span class="op">=</span> <span class="st">"city"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu">outliers</span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">minrate</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then I converted every qualitative variables as factor:</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data.inter</span><span class="op">$</span><span class="va">city</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data.inter</span><span class="op">$</span><span class="va">city</span><span class="op">)</span></span>
<span><span class="va">data.inter</span><span class="op">$</span><span class="va">cc1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data.inter</span><span class="op">$</span><span class="va">cc1</span><span class="op">)</span></span>
<span><span class="va">data.inter</span><span class="op">$</span><span class="va">star_rating</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data.inter</span><span class="op">$</span><span class="va">star_rating</span><span class="op">)</span></span>
<span><span class="va">data.inter</span><span class="op">$</span><span class="va">hotel_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data.inter</span><span class="op">$</span><span class="va">hotel_type</span><span class="op">)</span></span>
<span><span class="va">data.inter</span><span class="op">$</span><span class="va">payment_method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">data.inter</span><span class="op">$</span><span class="va">payment_method</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally I ran a set of <a href="https://en.wikipedia.org/wiki/Generalized_additive_model">generalized additive models</a> using all the relevant information found in <code>data.inter</code>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bam.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">bam.list</span><span class="op">$</span><span class="va">bam.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html">bam</a></span><span class="op">(</span></span>
<span>  <span class="va">minrate</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">km_from_city_center</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">city</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">payment_method</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">star_rating</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">hotel_type</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.inter</span>,</span>
<span>  na.action <span class="op">=</span> <span class="va">na.omit</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">bam.list</span><span class="op">$</span><span class="va">bam.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html">bam</a></span><span class="op">(</span></span>
<span>  <span class="va">minrate</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">km_from_city_center</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">city</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">star_rating</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">hotel_type</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.inter</span>,</span>
<span>  na.action <span class="op">=</span> <span class="va">na.omit</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">bam.list</span><span class="op">$</span><span class="va">bam.3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html">bam</a></span><span class="op">(</span></span>
<span>  <span class="va">minrate</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">km_from_city_center</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">city</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)+</span></span>
<span>    <span class="co"># s(nr_rooms, km_from_city_center,star_rating, bs="fs",m=1)+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">hotel_type</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.inter</span>,</span>
<span>  na.action <span class="op">=</span> <span class="va">na.omit</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">bam.list</span><span class="op">$</span><span class="va">bam.4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html">bam</a></span><span class="op">(</span></span>
<span>  <span class="va">minrate</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># s(km_from_city_center)+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">city</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)+</span></span>
<span>    <span class="co"># s(nr_rooms, km_from_city_center,star_rating, bs="fs",m=1)+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">hotel_type</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.inter</span>,</span>
<span>  na.action <span class="op">=</span> <span class="va">na.omit</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">bam.list</span><span class="op">$</span><span class="va">bam.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html">bam</a></span><span class="op">(</span></span>
<span>  <span class="va">minrate</span> <span class="op">~</span> <span class="co"># s(nr_rooms)+</span></span>
<span>    <span class="co"># s(km_from_city_center)+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">city</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)+</span></span>
<span>    <span class="co"># s(nr_rooms, km_from_city_center,star_rating, bs="fs",m=1)+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">nr_rooms</span>, <span class="va">km_from_city_center</span>, <span class="va">hotel_type</span>, bs <span class="op">=</span> <span class="st">"fs"</span>, m <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.inter</span>,</span>
<span>  na.action <span class="op">=</span> <span class="va">na.omit</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">bam.list</span><span class="op">$</span><span class="va">bam.6</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/bam.html">bam</a></span><span class="op">(</span></span>
<span>  <span class="va">minrate</span> <span class="op">~</span> <span class="co"># s(nr_rooms)+</span></span>
<span>    <span class="co"># s(km_from_city_center)+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">city</span>, bs <span class="op">=</span> <span class="st">"re"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)+</span></span>
<span>    <span class="co"># s(nr_rooms, km_from_city_center,star_rating, bs="fs",m=1)+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">hotel_type</span>, bs <span class="op">=</span> <span class="st">"re"</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">data.inter</span>,</span>
<span>  na.action <span class="op">=</span> <span class="va">na.omit</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I based the model selection looking at the <code>p-value</code> and the deviance explained. You can find in the <a href="#appendix">Appendix</a> section a summary of each model. Basically, I removed any non-significant part of the equation that was due to a random effect, <em>i.e</em>:</p>
<ul>
<li><code>s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)</code></li>
<li><code>s(nr_rooms, km_from_city_center,star_rating, bs="fs",m=1)</code></li>
</ul>
<p>Then I removed any non-significant part of the equation that was due to a fixed effect, <em>i.e</em>:</p>
<ul>
<li><code>s(nr_rooms)</code></li>
<li><code>s(km_from_city_center)</code></li>
</ul>
<p>As it remained two random smooth (a random effect on the intercept and the slope) and no fixed terms, I transformed these random smooth effects by random intercept effects, <em>i.e</em>:</p>
<ul>
<li><code>s(city, bs="re")</code></li>
<li><code>s(hotel_type, bs="re"</code></li>
</ul>
<p>The deviance, that is to say the proportion of variation in <code>minrate</code>, explained by the first full model <code>bam.1</code> is nearly the same as the much more simplify model (<code>bam.6</code>), around 36 %.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span></span>
<span>  deviance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">bam.list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">dev.expl</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">bam.list</span><span class="op">)</span></span>
<span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">model</span>, y <span class="op">=</span> <span class="va">deviance</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent_format</a></span><span class="op">(</span>scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Generalized additive models"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Deviance explained"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-devModel" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-devModel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="booking_jjoumaa_files/figure-html/fig-devModel-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-devModel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Deviance explained of the minimal room rate for a single night by each model.
</figcaption></figure>
</div>
</div>
</div>
<p>Based on this analysis and using the principle of parsimony, the best model to explain variation of the minimal room rate for a single night is composed of two random intercept effects, the city and the type of properties.</p>
</section><section id="conclusions-2" class="level2" data-number="5.3"><h2 data-number="5.3" class="anchored" data-anchor-id="conclusions-2">
<span class="header-section-number">5.3</span> Conclusions</h2>
<p>Without any fixed term in the model <code>bam.6</code>, this analysis showed that minimal room rate for a single night is nearly constant no matter the number of rooms or the distance from the city center. It also showed that the only qualitative variables that matters when setting a price is the location and the type of property proposed. To go further in the analysis I could have look at the effect of each mode, <em>i.e.</em> Paris, Napoli, Florence, Cannes, Roma, Nice, Milano, Venice, Palermo, Lyon for the cities, and Apartment, Hotel, Bed and Breakfast, ApartHotel, Holiday home, Hostel, Guest house, Homestay, Villa, Farm stay, Country house, Boat for type of properties, within the model <code>bam.1</code>, but a simple boxplot will higlight these differences in a more visual way <a href="#fig-boxplotBAM1" class="quarto-xref">Figure&nbsp;10</a> and <a href="#fig-boxplotBAM2" class="quarto-xref">Figure&nbsp;11</a>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data.inter</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">city</span>, y <span class="op">=</span> <span class="va">minrate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"City"</span>, y <span class="op">=</span> <span class="st">"Minimal room rate for a single night"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-boxplotBAM1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-boxplotBAM1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="booking_jjoumaa_files/figure-html/fig-boxplotBAM1-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplotBAM1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Minimal room rate for a single night related to cities
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">data.inter</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hotel_type</span>, y <span class="op">=</span> <span class="va">minrate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Type of property"</span>, y <span class="op">=</span> <span class="st">"Minimal rate for a single room"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-boxplotBAM2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-boxplotBAM2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="booking_jjoumaa_files/figure-html/fig-boxplotBAM2-1.png" class="img-fluid figure-img" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplotBAM2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Minimal room rate for a single night related to type of properties
</figcaption></figure>
</div>
</div>
</div>
</section></section><section id="appendix" class="level1" data-number="6"><h1 data-number="6">
<span class="header-section-number">6</span> Appendix</h1>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># get the summary of each GAM</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">bam.list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/itsadug/man/gamtabs.html">gamtabs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"HTML"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><!-- html table generated in R 4.4.3 by xtable 1.8-4 package --><!-- Tue Apr 15 18:11:45 2025 --><a name="tab.gam"></a><table border="1">
<caption align="bottom">
</caption>
<tbody><tr>
<td>
A. parametric coefficients
</td>
<td align="right">
Estimate
</td>
<td align="right">
Std. Error
</td>
<td align="right">
t-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
(Intercept)
</td>
<td align="right">
102.2215
</td>
<td align="right">
17.2963
</td>
<td align="right">
5.9100
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
B. smooth terms
</td>
<td align="right">
edf
</td>
<td align="right">
Ref.df
</td>
<td align="right">
F-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
s(nr_rooms)
</td>
<td align="right">
1.0001
</td>
<td align="right">
1.0001
</td>
<td align="right">
2.4847
</td>
<td align="right">
0.1150
</td>
</tr>
<tr>
<td>
s(km_from_city_center)
</td>
<td align="right">
1.6788
</td>
<td align="right">
2.0219
</td>
<td align="right">
0.5528
</td>
<td align="right">
0.6020
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,city)
</td>
<td align="right">
31.5905
</td>
<td align="right">
256.0000
</td>
<td align="right">
6.1804
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,payment_method)
</td>
<td align="right">
0.0020
</td>
<td align="right">
189.0000
</td>
<td align="right">
0.0000
</td>
<td align="right">
0.3760
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,star_rating)
</td>
<td align="right">
3.3992
</td>
<td align="right">
131.0000
</td>
<td align="right">
0.0504
</td>
<td align="right">
0.0513
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,hotel_type)
</td>
<td align="right">
10.6123
</td>
<td align="right">
168.0000
</td>
<td align="right">
1.5025
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>

</tbody></table>
<!-- html table generated in R 4.4.3 by xtable 1.8-4 package --><!-- Tue Apr 15 18:11:48 2025 --><a name="tab.gam"></a><table border="1">
<caption align="bottom">
</caption>
<tbody><tr>
<td>
A. parametric coefficients
</td>
<td align="right">
Estimate
</td>
<td align="right">
Std. Error
</td>
<td align="right">
t-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
(Intercept)
</td>
<td align="right">
102.2215
</td>
<td align="right">
17.2963
</td>
<td align="right">
5.9100
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
B. smooth terms
</td>
<td align="right">
edf
</td>
<td align="right">
Ref.df
</td>
<td align="right">
F-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
s(nr_rooms)
</td>
<td align="right">
1.0002
</td>
<td align="right">
1.0002
</td>
<td align="right">
2.4843
</td>
<td align="right">
0.1150
</td>
</tr>
<tr>
<td>
s(km_from_city_center)
</td>
<td align="right">
1.6787
</td>
<td align="right">
2.0219
</td>
<td align="right">
0.5527
</td>
<td align="right">
0.6020
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,city)
</td>
<td align="right">
31.5911
</td>
<td align="right">
256.0000
</td>
<td align="right">
6.1804
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,star_rating)
</td>
<td align="right">
3.3991
</td>
<td align="right">
131.0000
</td>
<td align="right">
0.0504
</td>
<td align="right">
0.0513
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,hotel_type)
</td>
<td align="right">
10.6125
</td>
<td align="right">
169.0000
</td>
<td align="right">
1.4936
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>

</tbody></table>
<!-- html table generated in R 4.4.3 by xtable 1.8-4 package --><!-- Tue Apr 15 18:11:49 2025 --><a name="tab.gam"></a><table border="1">
<caption align="bottom">
</caption>
<tbody><tr>
<td>
A. parametric coefficients
</td>
<td align="right">
Estimate
</td>
<td align="right">
Std. Error
</td>
<td align="right">
t-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
(Intercept)
</td>
<td align="right">
101.8454
</td>
<td align="right">
17.5891
</td>
<td align="right">
5.7902
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
B. smooth terms
</td>
<td align="right">
edf
</td>
<td align="right">
Ref.df
</td>
<td align="right">
F-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
s(nr_rooms)
</td>
<td align="right">
1.0001
</td>
<td align="right">
1.0002
</td>
<td align="right">
2.8534
</td>
<td align="right">
0.0912
</td>
</tr>
<tr>
<td>
s(km_from_city_center)
</td>
<td align="right">
1.1513
</td>
<td align="right">
1.2430
</td>
<td align="right">
0.5497
</td>
<td align="right">
0.5714
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,city)
</td>
<td align="right">
37.7995
</td>
<td align="right">
260.0000
</td>
<td align="right">
7.7636
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,hotel_type)
</td>
<td align="right">
13.0992
</td>
<td align="right">
204.0000
</td>
<td align="right">
1.6481
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>

</tbody></table>
<!-- html table generated in R 4.4.3 by xtable 1.8-4 package --><!-- Tue Apr 15 18:11:50 2025 --><a name="tab.gam"></a><table border="1">
<caption align="bottom">
</caption>
<tbody><tr>
<td>
A. parametric coefficients
</td>
<td align="right">
Estimate
</td>
<td align="right">
Std. Error
</td>
<td align="right">
t-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
(Intercept)
</td>
<td align="right">
102.8456
</td>
<td align="right">
17.5345
</td>
<td align="right">
5.8653
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
B. smooth terms
</td>
<td align="right">
edf
</td>
<td align="right">
Ref.df
</td>
<td align="right">
F-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
s(nr_rooms)
</td>
<td align="right">
1.0001
</td>
<td align="right">
1.0002
</td>
<td align="right">
2.5471
</td>
<td align="right">
0.1106
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,city)
</td>
<td align="right">
38.5806
</td>
<td align="right">
261.0000
</td>
<td align="right">
7.7408
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,hotel_type)
</td>
<td align="right">
13.2798
</td>
<td align="right">
205.0000
</td>
<td align="right">
1.6327
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>

</tbody></table>
<!-- html table generated in R 4.4.3 by xtable 1.8-4 package --><!-- Tue Apr 15 18:11:51 2025 --><a name="tab.gam"></a><table border="1">
<caption align="bottom">
</caption>
<tbody><tr>
<td>
A. parametric coefficients
</td>
<td align="right">
Estimate
</td>
<td align="right">
Std. Error
</td>
<td align="right">
t-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
(Intercept)
</td>
<td align="right">
97.0824
</td>
<td align="right">
17.2006
</td>
<td align="right">
5.6441
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
B. smooth terms
</td>
<td align="right">
edf
</td>
<td align="right">
Ref.df
</td>
<td align="right">
F-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,city)
</td>
<td align="right">
38.2978
</td>
<td align="right">
262.0000
</td>
<td align="right">
7.6939
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
s(nr_rooms,km_from_city_center,hotel_type)
</td>
<td align="right">
13.2111
</td>
<td align="right">
206.0000
</td>
<td align="right">
1.7439
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>

</tbody></table>
<!-- html table generated in R 4.4.3 by xtable 1.8-4 package --><!-- Tue Apr 15 18:11:51 2025 --><a name="tab.gam"></a><table border="1">
<caption align="bottom">
</caption>
<tbody><tr>
<td>
A. parametric coefficients
</td>
<td align="right">
Estimate
</td>
<td align="right">
Std. Error
</td>
<td align="right">
t-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
(Intercept)
</td>
<td align="right">
98.6229
</td>
<td align="right">
18.1212
</td>
<td align="right">
5.4424
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
B. smooth terms
</td>
<td align="right">
edf
</td>
<td align="right">
Ref.df
</td>
<td align="right">
F-value
</td>
<td align="right">
p-value
</td>
</tr>
<tr>
<td>
s(city)
</td>
<td align="right">
8.9470
</td>
<td align="right">
9.0000
</td>
<td align="right">
13453.8003
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>
<tr>
<td>
s(hotel_type)
</td>
<td align="right">
9.5921
</td>
<td align="right">
11.0000
</td>
<td align="right">
1846.0795
</td>
<td align="right">
&lt; 0.0001
</td>
</tr>

</tbody></table>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb20" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Booking Interview Project"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Joffrey Joumaa"</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "June 5, 2017"</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-align: "center"</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: true</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk:</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co">    message: false</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co">    rownames.print: false</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co">    tidy: styler</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="in">body {</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="in">text-align: justify}</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># Loading library</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(itsadug)</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="co"># avoid scientific notation</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a><span class="fu"># Preambule</span></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>I received an email from Irina Itu (HQ Recruiter - <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span>), the 2^nd^ of June including two documents:</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**`r list.files("./booking_data/")[2]`**, the document presenting the situation and the questions that I have to answer as a reporting analyst.</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>**`r list.files("./booking_data/")[1]`**, the dataset that would allow me to addressed these questions.</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>To make sure everyone knows what I am dealing with, you will find a summary of those data @tbl-str:</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tbl-str}</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Summary of the provided dataset."</span></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a><span class="in"># dataset loading</span></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a><span class="in">data &lt;- fread("./booking_data//Assessment_Reporting_Analyst.csv")</span></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a><span class="in"># time format</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a><span class="in">data[, first_opened := as.POSIXct(first_opened, tz = "UTC", format = "%m/%d/%y")]</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a><span class="in"># summary</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a><span class="in">kable(</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a><span class="in">    variable = names(data),</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a><span class="in">    classe = sapply(data, typeof),</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a><span class="in">    first_values = sapply(data, function(x) {</span></span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a><span class="in">      paste0(head(x), collapse = ", ")</span></span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a><span class="in">    }),</span></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a><span class="in">    row.names = NULL</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a><span class="in">  booktabs = TRUE</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>This represents a random sample of 10.000 properties from April 2016, wihtout information on the availability of properties. </span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a><span class="fu"># First question</span></span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a><span class="fu">## Statement</span></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>"*Dear Reporting Team,*</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>*I am account manager for France. I would like to get some insights in our supply in regards to the football championship that will be held in France this year. I am especially interested to see if we are opening enough new</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>properties. Can you please share your findings on our supply and highlight</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>your outtakes?*</span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a>*Thanks in advance.*"</span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data mining</span></span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a><span class="fu">### Few comments {#FC1}</span></span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a><span class="co"># trick to avoid crash when render using quarto</span></span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a>nb_unique_city <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>city)), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a>unique_city <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">unique</span>(data<span class="sc">$</span>city), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a>The dataset (<span class="in">`data`</span>) is considered as a snapshot of 10.000 properties randomly selected in <span class="in">`r nb_unique_city`</span> cities: <span class="in">`r unique_city`</span>, during April 2016. That means we do not know what proportion these 10.000 properties represent in each cities. In addition, this dataset do not include any information on the estimation of the number of people that will attend the football championship this summer, neither the proportion of these people that is expected to book a reservation via <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span>, nor the number of properties already booked through <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span>. Considering these, we need to:</span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Have an idea of the proportion these 10.000 properties represent of the <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span>'s offer in each city;</span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Estimate the number of people that will attend the football championship.</span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a>We also need to make several asumption:</span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Considering the football championship will be held in France, we will only keep french cities in our analysis. In addition, in the present dataset, only Paris, Lyon and Nice have a stadium that will be used for the competition (<span class="co">[</span><span class="ot">UEFA2016 - Wikipedia</span><span class="co">](https://en.wikipedia.org/wiki/UEFA_Euro_2016)</span>), so we will focus on these cities thereafter;</span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Someone that will attend the football championship is defined here as someone with a ticket for a match (and not someone that will only go to the Fan zones);</span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analysis &amp; Results</span></span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Number of rooms available</span></span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a>Based on a snapshot of the website <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span> dated of April 1^st^, 2016 (thanks to <span class="co">[</span><span class="ot">web.archive.org</span><span class="co">](https://web.archive.org)</span>), we know that Paris has <span class="co">[</span><span class="ot">3981</span><span class="co">](https://web.archive.org/web/20160401205022/http://www.booking.com/city/fr/paris.fr.html)</span> properties, Nice <span class="co">[</span><span class="ot">856</span><span class="co">](https://web.archive.org/web/20160401225547/http://www.booking.com/city/fr/nice.fr.html)</span>, and Lyon <span class="co">[</span><span class="ot">396</span><span class="co">](https://web.archive.org/web/20160401210028/http://www.booking.com/city/fr/lyon.fr.html)</span> (@tbl-properAvailable).</span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tbl-properAvailable}</span></span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Summary of properties available based on the provided dataset."</span></span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a><span class="in"># subset with the relevant cities</span></span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a><span class="in">data.uefa &lt;- data[city %in% c("Paris", "Nice", "Lyon"), ]</span></span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a><span class="in"># nb of properties in dataset per city</span></span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a><span class="in">data.uefa.cities &lt;- data.uefa[, .(</span></span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a><span class="in">  nb_rooms_dataset = sum(nr_rooms),</span></span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a><span class="in">  nb_properties_dataset = .N</span></span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a><span class="in">), by = city]</span></span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a><span class="in"># add nb of properties available</span></span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a><span class="in">data.uefa.cities[, nb_properties_available := c(3981, 856, 396)]</span></span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a><span class="in"># proportion of properties in the dataset</span></span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a><span class="in">data.uefa.cities[, prop_properties_dataset := round((100 / nb_properties_available) * nb_properties_dataset, 2)]</span></span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a><span class="in"># nb of rooms available based on the proportion of properties in the dataset</span></span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a><span class="in">data.uefa.cities[, nb_rooms_available := floor((nb_rooms_dataset * 100) / prop_properties_dataset)]</span></span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a><span class="in">kable(data.uefa.cities)</span></span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a><span class="co"># trick to avoid crash when render using quarto</span></span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a>prop_city_paris <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(data.uefa.cities[data.uefa.cities<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Paris"</span>]<span class="sc">$</span>prop_properties_dataset,</span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a>  <span class="at">big.mark =</span> <span class="st">","</span></span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a>prop_city_nice <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(data.uefa.cities[data.uefa.cities<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Nice"</span>]<span class="sc">$</span>prop_properties_dataset,</span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a>  <span class="at">big.mark =</span> <span class="st">","</span></span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a>prop_city_lyon <span class="ot">&lt;-</span></span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prettyNum</span>(data.uefa.cities[data.uefa.cities<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Lyon"</span>]<span class="sc">$</span>prop_properties_dataset,</span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a>    <span class="at">big.mark =</span> <span class="st">","</span></span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a>nb_room_paris <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(data.uefa.cities[data.uefa.cities<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Paris"</span>]<span class="sc">$</span>nb_rooms_available,</span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a>  <span class="at">big.mark =</span> <span class="st">","</span></span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a>nb_room_nice <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(data.uefa.cities[data.uefa.cities<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Nice"</span>]<span class="sc">$</span>nb_rooms_available,</span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a>  <span class="at">big.mark =</span> <span class="st">","</span></span>
<span id="cb20-171"><a href="#cb20-171" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-172"><a href="#cb20-172" aria-hidden="true" tabindex="-1"></a>nb_room_lyon <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(data.uefa.cities[data.uefa.cities<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Lyon"</span>]<span class="sc">$</span>nb_rooms_available,</span>
<span id="cb20-173"><a href="#cb20-173" aria-hidden="true" tabindex="-1"></a>  <span class="at">big.mark =</span> <span class="st">","</span></span>
<span id="cb20-174"><a href="#cb20-174" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a>This means the dataset <span class="in">`data`</span> represents <span class="in">`r prop_city_paris`</span> \% of the properties in Paris, <span class="in">`r prop_city_nice`</span> \% of the properties in Nice and <span class="in">`r prop_city_lyon`</span> \% of the properties in Lyon (considering these proportions, the 10.000 properties within this dataset were probably not randomly selected after all...). Based on the number of rooms available in the dataset and these proportions, we estimated the total number of rooms available for:</span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Paris of <span class="in">`r nb_room_paris`</span>;</span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Nice of <span class="in">`r nb_room_nice`</span>;</span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Lyon of <span class="in">`r nb_room_lyon`</span>.</span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Number of attendees per city</span></span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a>I based my estimation of the number of attendees (@fig-attendees) on the capacity of each stadium in each cities, multiplied by the number of matches, based on the Wikipedia page (<span class="co">[</span><span class="ot">UEFA-2016</span><span class="co">](https://en.wikipedia.org/wiki/UEFA_Euro_2016)</span>).</span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-187"><a href="#cb20-187" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Paris with 5 matches at the <span class="co">[</span><span class="ot">*Parc des Princes*</span><span class="co">](https://en.wikipedia.org/wiki/Parc_des_Princes)</span> (capacity: 48712) and 7 matches at the <span class="co">[</span><span class="ot">*Stade de France*</span><span class="co">](https://en.wikipedia.org/wiki/Stade_de_France)</span> (capacity: 81338) =&gt; $5 \times 48712 + 7 \times 81338 = 812926$;</span>
<span id="cb20-188"><a href="#cb20-188" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Nice with 4 matches at the <span class="co">[</span><span class="ot">*Stade de Nice*</span><span class="co">](https://en.wikipedia.org/wiki/Allianz_Riviera)</span> (capacity: 35624) =&gt; $4 \times 35624 = 142496$;</span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Lyon with 3 matches at the <span class="co">[</span><span class="ot">*Parc Olympique Lyonnais*</span><span class="co">](https://en.wikipedia.org/wiki/Parc_Olympique_Lyonnais)</span> (capacity: 59186) =&gt; $3 \times 59186 = 177558$.</span>
<span id="cb20-190"><a href="#cb20-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-191"><a href="#cb20-191" aria-hidden="true" tabindex="-1"></a>For Paris, I also considered to include the *Stade de France* which is located in Saint-Denis, closed to Paris. As specified in the <span class="co">[</span><span class="ot">Few comments</span><span class="co">](#FC1)</span> section, this basically means that I made the following assumption:  </span>
<span id="cb20-192"><a href="#cb20-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-193"><a href="#cb20-193" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; 1 ticket = 1 attendee</span></span>
<span id="cb20-194"><a href="#cb20-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-195"><a href="#cb20-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-attendees}</span></span>
<span id="cb20-196"><a href="#cb20-196" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Expected number of attendees per city based on the capacity of each stadium."</span></span>
<span id="cb20-197"><a href="#cb20-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-198"><a href="#cb20-198" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data.table(</span></span>
<span id="cb20-199"><a href="#cb20-199" aria-hidden="true" tabindex="-1"></a><span class="in">  City = c("Paris", "Nice", "Lyon"),</span></span>
<span id="cb20-200"><a href="#cb20-200" aria-hidden="true" tabindex="-1"></a><span class="in">  Attendees = c(812926, 142496, 177558)</span></span>
<span id="cb20-201"><a href="#cb20-201" aria-hidden="true" tabindex="-1"></a><span class="in">), aes(City, Attendees)) +</span></span>
<span id="cb20-202"><a href="#cb20-202" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_col() +</span></span>
<span id="cb20-203"><a href="#cb20-203" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(y = "Expected number of attendees")</span></span>
<span id="cb20-204"><a href="#cb20-204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-205"><a href="#cb20-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-206"><a href="#cb20-206" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Number of rooms vs. number of attendees</span></span>
<span id="cb20-207"><a href="#cb20-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-208"><a href="#cb20-208" aria-hidden="true" tabindex="-1"></a>Considering that <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span> is able to offer a maximum of <span class="in">`r nb_room_paris`</span>, <span class="in">`r nb_room_nice`</span> and <span class="in">`r nb_room_lyon`</span> rooms, for respectively Paris, Nice and Lyon, a simple difference (@fig-diffNbRoomsNbAttendees) shows that <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span> needs to increase significantly the number of rooms available, and so of properties, to reach the demand and welcome all the attendees of the football championship.</span>
<span id="cb20-209"><a href="#cb20-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-210"><a href="#cb20-210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-diffNbRoomsNbAttendees}</span></span>
<span id="cb20-211"><a href="#cb20-211" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Histogram of the number of attendees per city with a colour code for the capacity of [Booking.com](https://www.booking.com) to provide them a room."</span></span>
<span id="cb20-212"><a href="#cb20-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-213"><a href="#cb20-213" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(</span></span>
<span id="cb20-214"><a href="#cb20-214" aria-hidden="true" tabindex="-1"></a><span class="in">  data.table(</span></span>
<span id="cb20-215"><a href="#cb20-215" aria-hidden="true" tabindex="-1"></a><span class="in">    City = rep(c("Paris", "Nice", "Lyon"), 2),</span></span>
<span id="cb20-216"><a href="#cb20-216" aria-hidden="true" tabindex="-1"></a><span class="in">    Attendees = c(</span></span>
<span id="cb20-217"><a href="#cb20-217" aria-hidden="true" tabindex="-1"></a><span class="in">      812926 - data.uefa.cities[city == "Paris", nb_rooms_available],</span></span>
<span id="cb20-218"><a href="#cb20-218" aria-hidden="true" tabindex="-1"></a><span class="in">      142496 - data.uefa.cities[city == "Nice", nb_rooms_available],</span></span>
<span id="cb20-219"><a href="#cb20-219" aria-hidden="true" tabindex="-1"></a><span class="in">      177558 - data.uefa.cities[city == "Lyon", nb_rooms_available],</span></span>
<span id="cb20-220"><a href="#cb20-220" aria-hidden="true" tabindex="-1"></a><span class="in">      data.uefa.cities[city == "Paris", nb_rooms_available],</span></span>
<span id="cb20-221"><a href="#cb20-221" aria-hidden="true" tabindex="-1"></a><span class="in">      data.uefa.cities[city == "Nice", nb_rooms_available],</span></span>
<span id="cb20-222"><a href="#cb20-222" aria-hidden="true" tabindex="-1"></a><span class="in">      data.uefa.cities[city == "Lyon", nb_rooms_available]</span></span>
<span id="cb20-223"><a href="#cb20-223" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb20-224"><a href="#cb20-224" aria-hidden="true" tabindex="-1"></a><span class="in">    Group = c("Other", "Other", "Other", "Booking", "Booking", "Booking")</span></span>
<span id="cb20-225"><a href="#cb20-225" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb20-226"><a href="#cb20-226" aria-hidden="true" tabindex="-1"></a><span class="in">  aes(City, Attendees)</span></span>
<span id="cb20-227"><a href="#cb20-227" aria-hidden="true" tabindex="-1"></a><span class="in">) +</span></span>
<span id="cb20-228"><a href="#cb20-228" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_col(aes(fill = Group)) +</span></span>
<span id="cb20-229"><a href="#cb20-229" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = guide_legend(</span></span>
<span id="cb20-230"><a href="#cb20-230" aria-hidden="true" tabindex="-1"></a><span class="in">    title.position = "top",</span></span>
<span id="cb20-231"><a href="#cb20-231" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "accommodation"</span></span>
<span id="cb20-232"><a href="#cb20-232" aria-hidden="true" tabindex="-1"></a><span class="in">  )) +</span></span>
<span id="cb20-233"><a href="#cb20-233" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(y = "Expected number of attendees") +</span></span>
<span id="cb20-234"><a href="#cb20-234" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top")</span></span>
<span id="cb20-235"><a href="#cb20-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-236"><a href="#cb20-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-237"><a href="#cb20-237" aria-hidden="true" tabindex="-1"></a>Fortunately for <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span>, this graph does not take into consideration two features:</span>
<span id="cb20-238"><a href="#cb20-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-239"><a href="#cb20-239" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>The real proportion of attendees behind our estimation of the number of attendees, *e.g* an attendee could buy two tickets, meaning that our estimation of the number of attendees is over-estimated;</span>
<span id="cb20-240"><a href="#cb20-240" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Not all the estimated attendees will book a room though Booking.com, in other words what is the market share of <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span> among those who will book a room through internet. </span>
<span id="cb20-241"><a href="#cb20-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-242"><a href="#cb20-242" aria-hidden="true" tabindex="-1"></a>Considering this, I propose an image plot (@fig-imgplot) where we can easily read if <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span> has enough rooms available considering (*i*) the real proportion of attendees based on our estimation, and (*ii*) the proportion of this people that will book a room through <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span>.</span>
<span id="cb20-243"><a href="#cb20-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-244"><a href="#cb20-244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-imgplot}</span></span>
<span id="cb20-245"><a href="#cb20-245" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Image plot for the three cities of the number of rooms vs. the real proportion of attendees based on our estimation and the proportion of this people that will book a room through [Booking.com](https://www.booking.com)."</span></span>
<span id="cb20-246"><a href="#cb20-246" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 10</span></span>
<span id="cb20-247"><a href="#cb20-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-248"><a href="#cb20-248" aria-hidden="true" tabindex="-1"></a><span class="in"># a function to create a 100x100 matrix of the number of rooms available in function of the proportion of real attendees and the proportion of these people that will book a room through Booking.com</span></span>
<span id="cb20-249"><a href="#cb20-249" aria-hidden="true" tabindex="-1"></a><span class="in">img.fct &lt;- function(nb_attendees, nb_rooms, city) {</span></span>
<span id="cb20-250"><a href="#cb20-250" aria-hidden="true" tabindex="-1"></a><span class="in">  nb_rooms &lt;- nb_rooms</span></span>
<span id="cb20-251"><a href="#cb20-251" aria-hidden="true" tabindex="-1"></a><span class="in">  A &lt;- matrix(seq(1, nb_attendees, length = 100), nrow = 100, ncol = 100)</span></span>
<span id="cb20-252"><a href="#cb20-252" aria-hidden="true" tabindex="-1"></a><span class="in">  B &lt;- t(matrix(seq(1 / 100, 100 / 100, length = 100), nrow = 100, ncol = 100))</span></span>
<span id="cb20-253"><a href="#cb20-253" aria-hidden="true" tabindex="-1"></a><span class="in">  C &lt;- (A * B) - nb_rooms</span></span>
<span id="cb20-254"><a href="#cb20-254" aria-hidden="true" tabindex="-1"></a><span class="in">  D &lt;- reshape2::melt(C)</span></span>
<span id="cb20-255"><a href="#cb20-255" aria-hidden="true" tabindex="-1"></a><span class="in">  D$City &lt;- city</span></span>
<span id="cb20-256"><a href="#cb20-256" aria-hidden="true" tabindex="-1"></a><span class="in">  D</span></span>
<span id="cb20-257"><a href="#cb20-257" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb20-258"><a href="#cb20-258" aria-hidden="true" tabindex="-1"></a><span class="in"># calculation of this matrix for each city</span></span>
<span id="cb20-259"><a href="#cb20-259" aria-hidden="true" tabindex="-1"></a><span class="in">img.data &lt;- rbind(</span></span>
<span id="cb20-260"><a href="#cb20-260" aria-hidden="true" tabindex="-1"></a><span class="in">  img.fct(812926, data.uefa.cities[city == "Paris", nb_rooms_available], "Paris"),</span></span>
<span id="cb20-261"><a href="#cb20-261" aria-hidden="true" tabindex="-1"></a><span class="in">  img.fct(142496, data.uefa.cities[city == "Nice", nb_rooms_available], "Nice"),</span></span>
<span id="cb20-262"><a href="#cb20-262" aria-hidden="true" tabindex="-1"></a><span class="in">  img.fct(177558, data.uefa.cities[city == "Lyon", nb_rooms_available], "Lyon")</span></span>
<span id="cb20-263"><a href="#cb20-263" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-264"><a href="#cb20-264" aria-hidden="true" tabindex="-1"></a><span class="in"># plot</span></span>
<span id="cb20-265"><a href="#cb20-265" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(img.data, aes(Var1, Var2)) +</span></span>
<span id="cb20-266"><a href="#cb20-266" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_raster(aes(fill = log(value)), interpolate = TRUE) +</span></span>
<span id="cb20-267"><a href="#cb20-267" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb20-268"><a href="#cb20-268" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Proportion of attendees that will book reservation through Booking.com (%)",</span></span>
<span id="cb20-269"><a href="#cb20-269" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Proportion of real attendees based on my estimation (%)"</span></span>
<span id="cb20-270"><a href="#cb20-270" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb20-271"><a href="#cb20-271" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_gradientn(</span></span>
<span id="cb20-272"><a href="#cb20-272" aria-hidden="true" tabindex="-1"></a><span class="in">    colours = rev(rainbow(7)),</span></span>
<span id="cb20-273"><a href="#cb20-273" aria-hidden="true" tabindex="-1"></a><span class="in">    na.value = "grey",</span></span>
<span id="cb20-274"><a href="#cb20-274" aria-hidden="true" tabindex="-1"></a><span class="in">    breaks = c(log(2), log(60), log(3000), log(160000)),</span></span>
<span id="cb20-275"><a href="#cb20-275" aria-hidden="true" tabindex="-1"></a><span class="in">    labels = c(2, 60, 3000, 160000)</span></span>
<span id="cb20-276"><a href="#cb20-276" aria-hidden="true" tabindex="-1"></a><span class="in">  ) +</span></span>
<span id="cb20-277"><a href="#cb20-277" aria-hidden="true" tabindex="-1"></a><span class="in">  guides(fill = guide_colorbar(</span></span>
<span id="cb20-278"><a href="#cb20-278" aria-hidden="true" tabindex="-1"></a><span class="in">    title.position = "top",</span></span>
<span id="cb20-279"><a href="#cb20-279" aria-hidden="true" tabindex="-1"></a><span class="in">    barwidth = 11,</span></span>
<span id="cb20-280"><a href="#cb20-280" aria-hidden="true" tabindex="-1"></a><span class="in">    title = "Additional nb of rooms to open"</span></span>
<span id="cb20-281"><a href="#cb20-281" aria-hidden="true" tabindex="-1"></a><span class="in">  )) +</span></span>
<span id="cb20-282"><a href="#cb20-282" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_grid("~ City") +</span></span>
<span id="cb20-283"><a href="#cb20-283" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top")</span></span>
<span id="cb20-284"><a href="#cb20-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-285"><a href="#cb20-285" aria-hidden="true" tabindex="-1"></a>In @fig-imgplot, the *grey* area represents the number of rooms <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span> is able to offer, considering a certain proportion of real attendees as well as a proportion of these people that will book a room through <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span>. </span>
<span id="cb20-286"><a href="#cb20-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-287"><a href="#cb20-287" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusions</span></span>
<span id="cb20-288"><a href="#cb20-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-291"><a href="#cb20-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-292"><a href="#cb20-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb20-293"><a href="#cb20-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-294"><a href="#cb20-294" aria-hidden="true" tabindex="-1"></a><span class="co"># trick to avoid crash when render using quarto</span></span>
<span id="cb20-295"><a href="#cb20-295" aria-hidden="true" tabindex="-1"></a>nice_room_to_open <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">ceiling</span>(((<span class="dv">142496</span> <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">/</span> <span class="dv">812926</span>) <span class="sc">*</span> <span class="dv">14686</span>) <span class="sc">-</span> <span class="dv">1282</span>), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-296"><a href="#cb20-296" aria-hidden="true" tabindex="-1"></a>lyon_room_to_open <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">ceiling</span>(((<span class="dv">177558</span> <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">*</span> (<span class="dv">100</span> <span class="sc">/</span> <span class="dv">812926</span>) <span class="sc">*</span> <span class="dv">14686</span>) <span class="sc">-</span> <span class="dv">1164</span>), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-297"><a href="#cb20-297" aria-hidden="true" tabindex="-1"></a>room_paris <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">floor</span>(img.data<span class="sc">$</span>value[img.data<span class="sc">$</span>City <span class="sc">==</span> <span class="st">"Paris"</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var1 <span class="sc">==</span> <span class="dv">25</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var2 <span class="sc">==</span> <span class="dv">20</span>]), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-298"><a href="#cb20-298" aria-hidden="true" tabindex="-1"></a>room_nice <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">floor</span>(img.data<span class="sc">$</span>value[img.data<span class="sc">$</span>City <span class="sc">==</span> <span class="st">"Nice"</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var1 <span class="sc">==</span> <span class="dv">25</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var2 <span class="sc">==</span> <span class="dv">20</span>]), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-299"><a href="#cb20-299" aria-hidden="true" tabindex="-1"></a>room_lyon <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">floor</span>(img.data<span class="sc">$</span>value[img.data<span class="sc">$</span>City <span class="sc">==</span> <span class="st">"Lyon"</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var1 <span class="sc">==</span> <span class="dv">25</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var2 <span class="sc">==</span> <span class="dv">20</span>]), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-300"><a href="#cb20-300" aria-hidden="true" tabindex="-1"></a>property_paris <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">ceiling</span>(img.data<span class="sc">$</span>value[img.data<span class="sc">$</span>City <span class="sc">==</span> <span class="st">"Paris"</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var1 <span class="sc">==</span> <span class="dv">25</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var2 <span class="sc">==</span> <span class="dv">20</span>] <span class="sc">/</span> <span class="fu">mean</span>(data[data<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Paris"</span>]<span class="sc">$</span>nr_rooms)), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-301"><a href="#cb20-301" aria-hidden="true" tabindex="-1"></a>property_nice <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">ceiling</span>(img.data<span class="sc">$</span>value[img.data<span class="sc">$</span>City <span class="sc">==</span> <span class="st">"Nice"</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var1 <span class="sc">==</span> <span class="dv">25</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var2 <span class="sc">==</span> <span class="dv">20</span>] <span class="sc">/</span> <span class="fu">mean</span>(data[data<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Nice"</span>]<span class="sc">$</span>nr_rooms)), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-302"><a href="#cb20-302" aria-hidden="true" tabindex="-1"></a>property_lyon <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">ceiling</span>(img.data<span class="sc">$</span>value[img.data<span class="sc">$</span>City <span class="sc">==</span> <span class="st">"Lyon"</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var1 <span class="sc">==</span> <span class="dv">25</span> <span class="sc">&amp;</span> img.data<span class="sc">$</span>Var2 <span class="sc">==</span> <span class="dv">20</span>] <span class="sc">/</span> <span class="fu">mean</span>(data[data<span class="sc">$</span>city <span class="sc">==</span> <span class="st">"Lyon"</span>]<span class="sc">$</span>nr_rooms)), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-303"><a href="#cb20-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-304"><a href="#cb20-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-305"><a href="#cb20-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-306"><a href="#cb20-306" aria-hidden="true" tabindex="-1"></a>Considering all the assumptions and results, Paris seems to have the best capacity to welcome attendees, compared to Nice or Lyon (in @fig-imgplot), the *grey* area is bigger for Paris than Nice and Lyon). Based on this results, I would recommend to increase the number of properties in both cities (Nice and Lyon) to make sure it reach the same level of capacity than Paris. In order to reach this same level of capacity, Nice has to open `r nice_room_to_open` rooms and Lyon `r lyon_room_to_open`. In addition, assuming that one ticket in four (the choice is totally arbitrary) will be sell to someone looking for an accommodation, *i.e.* 25 \% of the proportion of real attendees and that 20 \% (also an arbitrary choice) of these people will look for an accommodation through <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span>, it appears that <span class="in">`r room_paris`</span>, <span class="in">`r room_nice`</span> and <span class="in">`r room_lyon`</span> rooms needs to be available in Paris, Nice and Lyon, that is to say respectively <span class="in">`r property_paris`</span>, <span class="in">`r property_nice`</span> and <span class="in">`r property_lyon`</span> new properties to meet the demand.</span>
<span id="cb20-307"><a href="#cb20-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-308"><a href="#cb20-308" aria-hidden="true" tabindex="-1"></a><span class="fu"># Second question</span></span>
<span id="cb20-309"><a href="#cb20-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-310"><a href="#cb20-310" aria-hidden="true" tabindex="-1"></a><span class="fu">## Statement</span></span>
<span id="cb20-311"><a href="#cb20-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-312"><a href="#cb20-312" aria-hidden="true" tabindex="-1"></a>"*Dear Reporting Team,*</span>
<span id="cb20-313"><a href="#cb20-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-314"><a href="#cb20-314" aria-hidden="true" tabindex="-1"></a>*Lately I get the feeling that the properties we are opening in Southern Europe are getting more and more expensive, while our customers demand lower priced accommodations. I would like to present some data in our next account managers meetup, but of course I would like to have some validated insights to back this up. Can you help me out on this?*</span>
<span id="cb20-315"><a href="#cb20-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-316"><a href="#cb20-316" aria-hidden="true" tabindex="-1"></a>*Regards.*"</span>
<span id="cb20-317"><a href="#cb20-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-318"><a href="#cb20-318" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data mining</span></span>
<span id="cb20-319"><a href="#cb20-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-320"><a href="#cb20-320" aria-hidden="true" tabindex="-1"></a><span class="fu">### Few comments</span></span>
<span id="cb20-321"><a href="#cb20-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-324"><a href="#cb20-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-325"><a href="#cb20-325" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb20-326"><a href="#cb20-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-327"><a href="#cb20-327" aria-hidden="true" tabindex="-1"></a><span class="co"># trick to avoid crash when render using quarto</span></span>
<span id="cb20-328"><a href="#cb20-328" aria-hidden="true" tabindex="-1"></a>unique_city_it <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(data[cc1 <span class="sc">==</span> <span class="st">"it"</span>, <span class="fu">unique</span>(city)], <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-329"><a href="#cb20-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-330"><a href="#cb20-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-331"><a href="#cb20-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-332"><a href="#cb20-332" aria-hidden="true" tabindex="-1"></a>As I only get a snapshot of the situation for 10.000 properties randomly selected from April 2016, we will focus on the relationship between the minimal room rate for a single-night (<span class="in">`minrate`</span>) and the date that the property was available at <span class="co">[</span><span class="ot">Booking.com</span><span class="co">](https://www.booking.com)</span> for the first time (<span class="in">`first_opened`</span>). I will thus test the hypothesis of an increase in <span class="in">`minrate`</span> with <span class="in">`first_opened`</span>. As the question is focused on the Southern Europe, I only considered cities in Italy (<span class="in">`r unique_city_it`</span>) in the further analysis.</span>
<span id="cb20-333"><a href="#cb20-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-334"><a href="#cb20-334" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analysis &amp; Results</span></span>
<span id="cb20-335"><a href="#cb20-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-336"><a href="#cb20-336" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-histBox}</span></span>
<span id="cb20-337"><a href="#cb20-337" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Histogram and boxplot of the minimal room rate for a single night in several italian cities."</span></span>
<span id="cb20-338"><a href="#cb20-338" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 10</span></span>
<span id="cb20-339"><a href="#cb20-339" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 5</span></span>
<span id="cb20-340"><a href="#cb20-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-341"><a href="#cb20-341" aria-hidden="true" tabindex="-1"></a><span class="in"># new dataset for Italia</span></span>
<span id="cb20-342"><a href="#cb20-342" aria-hidden="true" tabindex="-1"></a><span class="in">data.it &lt;- data[cc1 == "it", ]</span></span>
<span id="cb20-343"><a href="#cb20-343" aria-hidden="true" tabindex="-1"></a><span class="in"># some exploratory graphs</span></span>
<span id="cb20-344"><a href="#cb20-344" aria-hidden="true" tabindex="-1"></a><span class="in">grid.arrange(</span></span>
<span id="cb20-345"><a href="#cb20-345" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data.it, aes(minrate)) +</span></span>
<span id="cb20-346"><a href="#cb20-346" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_histogram(aes(y = ..density..)) +</span></span>
<span id="cb20-347"><a href="#cb20-347" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_density() +</span></span>
<span id="cb20-348"><a href="#cb20-348" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(</span></span>
<span id="cb20-349"><a href="#cb20-349" aria-hidden="true" tabindex="-1"></a><span class="in">      x = "Minimal room rate for a single night",</span></span>
<span id="cb20-350"><a href="#cb20-350" aria-hidden="true" tabindex="-1"></a><span class="in">      y = "Density"</span></span>
<span id="cb20-351"><a href="#cb20-351" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb20-352"><a href="#cb20-352" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data.it, aes(y = minrate, x = city)) +</span></span>
<span id="cb20-353"><a href="#cb20-353" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_boxplot() +</span></span>
<span id="cb20-354"><a href="#cb20-354" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(</span></span>
<span id="cb20-355"><a href="#cb20-355" aria-hidden="true" tabindex="-1"></a><span class="in">      y = "Minimal room rate for a single night",</span></span>
<span id="cb20-356"><a href="#cb20-356" aria-hidden="true" tabindex="-1"></a><span class="in">      x = "City"</span></span>
<span id="cb20-357"><a href="#cb20-357" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb20-358"><a href="#cb20-358" aria-hidden="true" tabindex="-1"></a><span class="in">  ncol = 2</span></span>
<span id="cb20-359"><a href="#cb20-359" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-360"><a href="#cb20-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-361"><a href="#cb20-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-362"><a href="#cb20-362" aria-hidden="true" tabindex="-1"></a>It appears there are a lot of outliers and zeros in the dataset (@fig-histBox). I decided then to remove any rows with a minimal room rate for a single night of zero and other outliers using the IQR rule. </span>
<span id="cb20-363"><a href="#cb20-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-364"><a href="#cb20-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-histBoxOUT}</span></span>
<span id="cb20-365"><a href="#cb20-365" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Histogram and boxplot of the minimal room rate in several italian cities, without considering outliers."</span></span>
<span id="cb20-366"><a href="#cb20-366" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 10</span></span>
<span id="cb20-367"><a href="#cb20-367" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 5</span></span>
<span id="cb20-368"><a href="#cb20-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-369"><a href="#cb20-369" aria-hidden="true" tabindex="-1"></a><span class="in"># we removed zeros</span></span>
<span id="cb20-370"><a href="#cb20-370" aria-hidden="true" tabindex="-1"></a><span class="in">data.it &lt;- data.it[minrate != 0, ]</span></span>
<span id="cb20-371"><a href="#cb20-371" aria-hidden="true" tabindex="-1"></a><span class="in"># and other outliers</span></span>
<span id="cb20-372"><a href="#cb20-372" aria-hidden="true" tabindex="-1"></a><span class="in">outliers &lt;- function(out) {</span></span>
<span id="cb20-373"><a href="#cb20-373" aria-hidden="true" tabindex="-1"></a><span class="in">  q1 &lt;- quantile(out, 0.25)</span></span>
<span id="cb20-374"><a href="#cb20-374" aria-hidden="true" tabindex="-1"></a><span class="in">  q3 &lt;- quantile(out, 0.75)</span></span>
<span id="cb20-375"><a href="#cb20-375" aria-hidden="true" tabindex="-1"></a><span class="in">  iqr &lt;- q3 - q1</span></span>
<span id="cb20-376"><a href="#cb20-376" aria-hidden="true" tabindex="-1"></a><span class="in">  which(out &gt; q1 - 1.5 * iqr &amp; out &lt; q3 + 1.5 * iqr)</span></span>
<span id="cb20-377"><a href="#cb20-377" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb20-378"><a href="#cb20-378" aria-hidden="true" tabindex="-1"></a><span class="in">data.it.out &lt;- rbindlist(lapply(split(data.it, by = "city"), function(x) {</span></span>
<span id="cb20-379"><a href="#cb20-379" aria-hidden="true" tabindex="-1"></a><span class="in">  x &lt;- x[outliers(x$minrate), ]</span></span>
<span id="cb20-380"><a href="#cb20-380" aria-hidden="true" tabindex="-1"></a><span class="in">}))</span></span>
<span id="cb20-381"><a href="#cb20-381" aria-hidden="true" tabindex="-1"></a><span class="in"># new plot</span></span>
<span id="cb20-382"><a href="#cb20-382" aria-hidden="true" tabindex="-1"></a><span class="in">grid.arrange(</span></span>
<span id="cb20-383"><a href="#cb20-383" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data.it.out, aes(minrate)) +</span></span>
<span id="cb20-384"><a href="#cb20-384" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_histogram(aes(y = ..density..)) +</span></span>
<span id="cb20-385"><a href="#cb20-385" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_density() +</span></span>
<span id="cb20-386"><a href="#cb20-386" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(</span></span>
<span id="cb20-387"><a href="#cb20-387" aria-hidden="true" tabindex="-1"></a><span class="in">      x = "Minimal room rate for a single night",</span></span>
<span id="cb20-388"><a href="#cb20-388" aria-hidden="true" tabindex="-1"></a><span class="in">      y = "Density"</span></span>
<span id="cb20-389"><a href="#cb20-389" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb20-390"><a href="#cb20-390" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(data.it.out, aes(y = minrate, x = city)) +</span></span>
<span id="cb20-391"><a href="#cb20-391" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_boxplot() +</span></span>
<span id="cb20-392"><a href="#cb20-392" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(</span></span>
<span id="cb20-393"><a href="#cb20-393" aria-hidden="true" tabindex="-1"></a><span class="in">      y = "Minimal room rate for a single night",</span></span>
<span id="cb20-394"><a href="#cb20-394" aria-hidden="true" tabindex="-1"></a><span class="in">      x = "Cities"</span></span>
<span id="cb20-395"><a href="#cb20-395" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb20-396"><a href="#cb20-396" aria-hidden="true" tabindex="-1"></a><span class="in">  ncol = 2</span></span>
<span id="cb20-397"><a href="#cb20-397" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-398"><a href="#cb20-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-399"><a href="#cb20-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-400"><a href="#cb20-400" aria-hidden="true" tabindex="-1"></a>This is much better, now we are going to look at the trend over time (@fig-distriMRRGAM), by first using a <span class="co">[</span><span class="ot">generalized additive model</span><span class="co">](https://en.wikipedia.org/wiki/Generalized_additive_model)</span>. </span>
<span id="cb20-401"><a href="#cb20-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-402"><a href="#cb20-402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-distriMRRGAM}</span></span>
<span id="cb20-403"><a href="#cb20-403" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Distribution of minimal room rates for a single night with the date that the property  was available at [Booking.com](https://www.booking.com) for the first time. The blue line is for a generalized additive model automatically adjusted with data."</span></span>
<span id="cb20-404"><a href="#cb20-404" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data.it.out, aes(x = first_opened, y = minrate)) +</span></span>
<span id="cb20-405"><a href="#cb20-405" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb20-406"><a href="#cb20-406" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth() +</span></span>
<span id="cb20-407"><a href="#cb20-407" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb20-408"><a href="#cb20-408" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Minimal room rate for a single night",</span></span>
<span id="cb20-409"><a href="#cb20-409" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Date that the property was available at Booking.com for the first time"</span></span>
<span id="cb20-410"><a href="#cb20-410" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb20-411"><a href="#cb20-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-412"><a href="#cb20-412" aria-hidden="true" tabindex="-1"></a>Nothing really clear here, neither using a simple linear regression (@fig-distriMRRLM).</span>
<span id="cb20-413"><a href="#cb20-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-414"><a href="#cb20-414" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-distriMRRLM}</span></span>
<span id="cb20-415"><a href="#cb20-415" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Distribution of minimal room rates for a single night with the date that the property  was available at [Booking.com](https://www.booking.com) for the first time. The blue line is for a linear regression automatically adjusted with data."</span></span>
<span id="cb20-416"><a href="#cb20-416" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data.it.out, aes(x = first_opened, y = minrate)) +</span></span>
<span id="cb20-417"><a href="#cb20-417" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb20-418"><a href="#cb20-418" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_smooth(method = "lm") +</span></span>
<span id="cb20-419"><a href="#cb20-419" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb20-420"><a href="#cb20-420" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Minimal room rate for a single night",</span></span>
<span id="cb20-421"><a href="#cb20-421" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Date that the property was available at Booking.com for the first time"</span></span>
<span id="cb20-422"><a href="#cb20-422" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb20-423"><a href="#cb20-423" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-424"><a href="#cb20-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-425"><a href="#cb20-425" aria-hidden="true" tabindex="-1"></a>As the dataset is structured by city, it is better to include a random effect in our models, using a <span class="co">[</span><span class="ot">linear mixed effects models</span><span class="co">](https://en.wikipedia.org/wiki/Mixed_model)</span>.</span>
<span id="cb20-426"><a href="#cb20-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-427"><a href="#cb20-427" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tbl-summaryLME}</span></span>
<span id="cb20-428"><a href="#cb20-428" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Output for the linear mixed effect model: lme(minrate~first_opened,data=data.it.out,random=~1|city)"</span></span>
<span id="cb20-429"><a href="#cb20-429" aria-hidden="true" tabindex="-1"></a><span class="in"># na.action = na.omit)"}</span></span>
<span id="cb20-430"><a href="#cb20-430" aria-hidden="true" tabindex="-1"></a><span class="in"># building LME</span></span>
<span id="cb20-431"><a href="#cb20-431" aria-hidden="true" tabindex="-1"></a><span class="in">lme.1 &lt;- lme(minrate ~ first_opened, data = data.it.out, random = ~ 1 | city, na.action = na.omit)</span></span>
<span id="cb20-432"><a href="#cb20-432" aria-hidden="true" tabindex="-1"></a><span class="in"># results</span></span>
<span id="cb20-433"><a href="#cb20-433" aria-hidden="true" tabindex="-1"></a><span class="in">pander(summary(lme.1))</span></span>
<span id="cb20-434"><a href="#cb20-434" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-435"><a href="#cb20-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-436"><a href="#cb20-436" aria-hidden="true" tabindex="-1"></a>The ouput reveals there is no significant (<span class="in">`p-value`</span> for <span class="in">`first_opened`</span> &gt; 0.05) linear trend over time (defined as the date the property was available for the first time) of the minimal room rate for a single. Now, I take a look at the residual to know how trustful this result is.</span>
<span id="cb20-437"><a href="#cb20-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-438"><a href="#cb20-438" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-diagPlot}</span></span>
<span id="cb20-439"><a href="#cb20-439" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Some diagnostic plot of the linear mixed effect model lme.1."</span></span>
<span id="cb20-440"><a href="#cb20-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-441"><a href="#cb20-441" aria-hidden="true" tabindex="-1"></a><span class="in">par(mfrow = c(2, 2))</span></span>
<span id="cb20-442"><a href="#cb20-442" aria-hidden="true" tabindex="-1"></a><span class="in"># diagnostic plots</span></span>
<span id="cb20-443"><a href="#cb20-443" aria-hidden="true" tabindex="-1"></a><span class="in"># plot(lme.1)</span></span>
<span id="cb20-444"><a href="#cb20-444" aria-hidden="true" tabindex="-1"></a><span class="in">acf(residuals(lme.1, normalized = T))</span></span>
<span id="cb20-445"><a href="#cb20-445" aria-hidden="true" tabindex="-1"></a><span class="in">hist(residuals(lme.1, normalized = T))</span></span>
<span id="cb20-446"><a href="#cb20-446" aria-hidden="true" tabindex="-1"></a><span class="in">plot(residuals(lme.1, normalized = T))</span></span>
<span id="cb20-447"><a href="#cb20-447" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-448"><a href="#cb20-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-449"><a href="#cb20-449" aria-hidden="true" tabindex="-1"></a>The diagnostic plots (@fig-diagPlot) realized on the residuals of the linear mixed effect model <span class="in">`lme.1`</span> do not reveal any patterns, meaning the model is not missing any relevant variable. This also means that we can be confident in its results, regardless the city: there are no trend towards the minimal room rate for a single night with the date the property was available at Booking.com for the first time in this dataset.</span>
<span id="cb20-450"><a href="#cb20-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-451"><a href="#cb20-451" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusions</span></span>
<span id="cb20-452"><a href="#cb20-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-453"><a href="#cb20-453" aria-hidden="true" tabindex="-1"></a>No matter the city considered, there is no trend towards the minimal room rate for a single night with the date the property was available at Booking.com for the first time. Rather, there is a relative stability of the room rate with the date the property was available for the first time. While this analysis is interesting, it would probably be even more interesting to look at the relationship of the minimal room rate with time, and not only during the month of April 2016. This would may be highlight trends in agreement with your feeling.</span>
<span id="cb20-454"><a href="#cb20-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-455"><a href="#cb20-455" aria-hidden="true" tabindex="-1"></a><span class="fu"># Other insights</span></span>
<span id="cb20-456"><a href="#cb20-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-457"><a href="#cb20-457" aria-hidden="true" tabindex="-1"></a><span class="fu">## Few comments</span></span>
<span id="cb20-458"><a href="#cb20-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-459"><a href="#cb20-459" aria-hidden="true" tabindex="-1"></a>Given this dataset, there are a lot of questions that could be addressed, such as:</span>
<span id="cb20-460"><a href="#cb20-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-461"><a href="#cb20-461" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Which city has the center the most covered by properties?</span>
<span id="cb20-462"><a href="#cb20-462" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Is there any differences among cities and countries in terms of properties offering (<span class="in">`hotel_type`</span>, <span class="in">`nr_rooms`</span>, <span class="in">`payment_method`</span> or <span class="in">` star_rating`</span>)?</span>
<span id="cb20-463"><a href="#cb20-463" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Can we relate the type of properties to the distance from the city center?</span>
<span id="cb20-464"><a href="#cb20-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-465"><a href="#cb20-465" aria-hidden="true" tabindex="-1"></a>But here, I decided to focus on the minimal room rate for a single night, and I tried to model this variable considering other information present within the dataset.</span>
<span id="cb20-466"><a href="#cb20-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-467"><a href="#cb20-467" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analysis &amp; Results</span></span>
<span id="cb20-468"><a href="#cb20-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-469"><a href="#cb20-469" aria-hidden="true" tabindex="-1"></a>I basically used the same approach than before, I removed zeros and outliers:</span>
<span id="cb20-470"><a href="#cb20-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-473"><a href="#cb20-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-474"><a href="#cb20-474" aria-hidden="true" tabindex="-1"></a><span class="co"># I removed zeros</span></span>
<span id="cb20-475"><a href="#cb20-475" aria-hidden="true" tabindex="-1"></a>data.inter <span class="ot">&lt;-</span> data[minrate <span class="sc">!=</span> <span class="dv">0</span>, ]</span>
<span id="cb20-476"><a href="#cb20-476" aria-hidden="true" tabindex="-1"></a><span class="co"># and other outliers</span></span>
<span id="cb20-477"><a href="#cb20-477" aria-hidden="true" tabindex="-1"></a>data.inter <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(<span class="fu">split</span>(data.inter, <span class="at">by =</span> <span class="st">"city"</span>), <span class="cf">function</span>(x) {</span>
<span id="cb20-478"><a href="#cb20-478" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[<span class="fu">outliers</span>(x<span class="sc">$</span>minrate), ]</span>
<span id="cb20-479"><a href="#cb20-479" aria-hidden="true" tabindex="-1"></a>}))</span>
<span id="cb20-480"><a href="#cb20-480" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-481"><a href="#cb20-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-482"><a href="#cb20-482" aria-hidden="true" tabindex="-1"></a>Then I converted every qualitative variables as factor:</span>
<span id="cb20-483"><a href="#cb20-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-486"><a href="#cb20-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-487"><a href="#cb20-487" aria-hidden="true" tabindex="-1"></a>data.inter<span class="sc">$</span>city <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data.inter<span class="sc">$</span>city)</span>
<span id="cb20-488"><a href="#cb20-488" aria-hidden="true" tabindex="-1"></a>data.inter<span class="sc">$</span>cc1 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data.inter<span class="sc">$</span>cc1)</span>
<span id="cb20-489"><a href="#cb20-489" aria-hidden="true" tabindex="-1"></a>data.inter<span class="sc">$</span>star_rating <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data.inter<span class="sc">$</span>star_rating)</span>
<span id="cb20-490"><a href="#cb20-490" aria-hidden="true" tabindex="-1"></a>data.inter<span class="sc">$</span>hotel_type <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data.inter<span class="sc">$</span>hotel_type)</span>
<span id="cb20-491"><a href="#cb20-491" aria-hidden="true" tabindex="-1"></a>data.inter<span class="sc">$</span>payment_method <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data.inter<span class="sc">$</span>payment_method)</span>
<span id="cb20-492"><a href="#cb20-492" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-493"><a href="#cb20-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-494"><a href="#cb20-494" aria-hidden="true" tabindex="-1"></a>Finally I ran a set of <span class="co">[</span><span class="ot">generalized additive models</span><span class="co">](https://en.wikipedia.org/wiki/Generalized_additive_model)</span> using all the relevant information found in <span class="in">`data.inter`</span>.</span>
<span id="cb20-495"><a href="#cb20-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-496"><a href="#cb20-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r BAMSet}</span></span>
<span id="cb20-497"><a href="#cb20-497" aria-hidden="true" tabindex="-1"></a><span class="in">bam.list &lt;- list()</span></span>
<span id="cb20-498"><a href="#cb20-498" aria-hidden="true" tabindex="-1"></a><span class="in">bam.list$bam.1 &lt;- bam(</span></span>
<span id="cb20-499"><a href="#cb20-499" aria-hidden="true" tabindex="-1"></a><span class="in">  minrate ~ s(nr_rooms) +</span></span>
<span id="cb20-500"><a href="#cb20-500" aria-hidden="true" tabindex="-1"></a><span class="in">    s(km_from_city_center) +</span></span>
<span id="cb20-501"><a href="#cb20-501" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, city, bs = "fs", m = 1) +</span></span>
<span id="cb20-502"><a href="#cb20-502" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, payment_method, bs = "fs", m = 1) +</span></span>
<span id="cb20-503"><a href="#cb20-503" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, star_rating, bs = "fs", m = 1) +</span></span>
<span id="cb20-504"><a href="#cb20-504" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, hotel_type, bs = "fs", m = 1),</span></span>
<span id="cb20-505"><a href="#cb20-505" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data.inter,</span></span>
<span id="cb20-506"><a href="#cb20-506" aria-hidden="true" tabindex="-1"></a><span class="in">  na.action = na.omit</span></span>
<span id="cb20-507"><a href="#cb20-507" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-508"><a href="#cb20-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-509"><a href="#cb20-509" aria-hidden="true" tabindex="-1"></a><span class="in">bam.list$bam.2 &lt;- bam(</span></span>
<span id="cb20-510"><a href="#cb20-510" aria-hidden="true" tabindex="-1"></a><span class="in">  minrate ~ s(nr_rooms) +</span></span>
<span id="cb20-511"><a href="#cb20-511" aria-hidden="true" tabindex="-1"></a><span class="in">    s(km_from_city_center) +</span></span>
<span id="cb20-512"><a href="#cb20-512" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, city, bs = "fs", m = 1) +</span></span>
<span id="cb20-513"><a href="#cb20-513" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)+</span></span>
<span id="cb20-514"><a href="#cb20-514" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, star_rating, bs = "fs", m = 1) +</span></span>
<span id="cb20-515"><a href="#cb20-515" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, hotel_type, bs = "fs", m = 1),</span></span>
<span id="cb20-516"><a href="#cb20-516" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data.inter,</span></span>
<span id="cb20-517"><a href="#cb20-517" aria-hidden="true" tabindex="-1"></a><span class="in">  na.action = na.omit</span></span>
<span id="cb20-518"><a href="#cb20-518" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-519"><a href="#cb20-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-520"><a href="#cb20-520" aria-hidden="true" tabindex="-1"></a><span class="in">bam.list$bam.3 &lt;- bam(</span></span>
<span id="cb20-521"><a href="#cb20-521" aria-hidden="true" tabindex="-1"></a><span class="in">  minrate ~ s(nr_rooms) +</span></span>
<span id="cb20-522"><a href="#cb20-522" aria-hidden="true" tabindex="-1"></a><span class="in">    s(km_from_city_center) +</span></span>
<span id="cb20-523"><a href="#cb20-523" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, city, bs = "fs", m = 1) +</span></span>
<span id="cb20-524"><a href="#cb20-524" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)+</span></span>
<span id="cb20-525"><a href="#cb20-525" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(nr_rooms, km_from_city_center,star_rating, bs="fs",m=1)+</span></span>
<span id="cb20-526"><a href="#cb20-526" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, hotel_type, bs = "fs", m = 1),</span></span>
<span id="cb20-527"><a href="#cb20-527" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data.inter,</span></span>
<span id="cb20-528"><a href="#cb20-528" aria-hidden="true" tabindex="-1"></a><span class="in">  na.action = na.omit</span></span>
<span id="cb20-529"><a href="#cb20-529" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-530"><a href="#cb20-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-531"><a href="#cb20-531" aria-hidden="true" tabindex="-1"></a><span class="in">bam.list$bam.4 &lt;- bam(</span></span>
<span id="cb20-532"><a href="#cb20-532" aria-hidden="true" tabindex="-1"></a><span class="in">  minrate ~ s(nr_rooms) +</span></span>
<span id="cb20-533"><a href="#cb20-533" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(km_from_city_center)+</span></span>
<span id="cb20-534"><a href="#cb20-534" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, city, bs = "fs", m = 1) +</span></span>
<span id="cb20-535"><a href="#cb20-535" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)+</span></span>
<span id="cb20-536"><a href="#cb20-536" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(nr_rooms, km_from_city_center,star_rating, bs="fs",m=1)+</span></span>
<span id="cb20-537"><a href="#cb20-537" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, hotel_type, bs = "fs", m = 1),</span></span>
<span id="cb20-538"><a href="#cb20-538" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data.inter,</span></span>
<span id="cb20-539"><a href="#cb20-539" aria-hidden="true" tabindex="-1"></a><span class="in">  na.action = na.omit</span></span>
<span id="cb20-540"><a href="#cb20-540" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-541"><a href="#cb20-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-542"><a href="#cb20-542" aria-hidden="true" tabindex="-1"></a><span class="in">bam.list$bam.5 &lt;- bam(</span></span>
<span id="cb20-543"><a href="#cb20-543" aria-hidden="true" tabindex="-1"></a><span class="in">  minrate ~ # s(nr_rooms)+</span></span>
<span id="cb20-544"><a href="#cb20-544" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(km_from_city_center)+</span></span>
<span id="cb20-545"><a href="#cb20-545" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, city, bs = "fs", m = 1) +</span></span>
<span id="cb20-546"><a href="#cb20-546" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)+</span></span>
<span id="cb20-547"><a href="#cb20-547" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(nr_rooms, km_from_city_center,star_rating, bs="fs",m=1)+</span></span>
<span id="cb20-548"><a href="#cb20-548" aria-hidden="true" tabindex="-1"></a><span class="in">    s(nr_rooms, km_from_city_center, hotel_type, bs = "fs", m = 1),</span></span>
<span id="cb20-549"><a href="#cb20-549" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data.inter,</span></span>
<span id="cb20-550"><a href="#cb20-550" aria-hidden="true" tabindex="-1"></a><span class="in">  na.action = na.omit</span></span>
<span id="cb20-551"><a href="#cb20-551" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-552"><a href="#cb20-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-553"><a href="#cb20-553" aria-hidden="true" tabindex="-1"></a><span class="in">bam.list$bam.6 &lt;- bam(</span></span>
<span id="cb20-554"><a href="#cb20-554" aria-hidden="true" tabindex="-1"></a><span class="in">  minrate ~ # s(nr_rooms)+</span></span>
<span id="cb20-555"><a href="#cb20-555" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(km_from_city_center)+</span></span>
<span id="cb20-556"><a href="#cb20-556" aria-hidden="true" tabindex="-1"></a><span class="in">    s(city, bs = "re") +</span></span>
<span id="cb20-557"><a href="#cb20-557" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)+</span></span>
<span id="cb20-558"><a href="#cb20-558" aria-hidden="true" tabindex="-1"></a><span class="in">    # s(nr_rooms, km_from_city_center,star_rating, bs="fs",m=1)+</span></span>
<span id="cb20-559"><a href="#cb20-559" aria-hidden="true" tabindex="-1"></a><span class="in">    s(hotel_type, bs = "re"),</span></span>
<span id="cb20-560"><a href="#cb20-560" aria-hidden="true" tabindex="-1"></a><span class="in">  data = data.inter,</span></span>
<span id="cb20-561"><a href="#cb20-561" aria-hidden="true" tabindex="-1"></a><span class="in">  na.action = na.omit</span></span>
<span id="cb20-562"><a href="#cb20-562" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb20-563"><a href="#cb20-563" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-564"><a href="#cb20-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-565"><a href="#cb20-565" aria-hidden="true" tabindex="-1"></a>I based the model selection looking at the <span class="in">`p-value`</span> and the deviance explained. You can find in the <span class="co">[</span><span class="ot">Appendix</span><span class="co">]</span> section a summary of each model. Basically, I removed any non-significant part of the equation that was due to a random effect, *i.e*:</span>
<span id="cb20-566"><a href="#cb20-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-567"><a href="#cb20-567" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`s(nr_rooms, km_from_city_center,payment_method, bs="fs",m=1)`</span></span>
<span id="cb20-568"><a href="#cb20-568" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`s(nr_rooms, km_from_city_center,star_rating, bs="fs",m=1)`</span></span>
<span id="cb20-569"><a href="#cb20-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-570"><a href="#cb20-570" aria-hidden="true" tabindex="-1"></a>Then I removed any non-significant part of the equation that was due to a fixed effect, *i.e*:</span>
<span id="cb20-571"><a href="#cb20-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-572"><a href="#cb20-572" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`s(nr_rooms)`</span></span>
<span id="cb20-573"><a href="#cb20-573" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`s(km_from_city_center)`</span></span>
<span id="cb20-574"><a href="#cb20-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-575"><a href="#cb20-575" aria-hidden="true" tabindex="-1"></a>As it remained two random smooth (a random effect on the intercept and the slope) and no fixed terms, I transformed these random smooth effects by random intercept effects, *i.e*:</span>
<span id="cb20-576"><a href="#cb20-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-577"><a href="#cb20-577" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`s(city, bs="re")`</span></span>
<span id="cb20-578"><a href="#cb20-578" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`s(hotel_type, bs="re"`</span></span>
<span id="cb20-579"><a href="#cb20-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-582"><a href="#cb20-582" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-583"><a href="#cb20-583" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb20-584"><a href="#cb20-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-585"><a href="#cb20-585" aria-hidden="true" tabindex="-1"></a><span class="co"># trick to avoid crash when render using quarto</span></span>
<span id="cb20-586"><a href="#cb20-586" aria-hidden="true" tabindex="-1"></a>bam_1_dev <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">round</span>(<span class="fu">summary</span>(bam.list<span class="sc">$</span>bam<span class="fl">.6</span>)<span class="sc">$</span>dev.expl <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-587"><a href="#cb20-587" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-588"><a href="#cb20-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-589"><a href="#cb20-589" aria-hidden="true" tabindex="-1"></a>The deviance, that is to say the proportion of variation in <span class="in">`minrate`</span>, explained by the first full model <span class="in">`bam.1`</span> is nearly the same as the much more simplify model (<span class="in">`bam.6`</span>), around <span class="in">`r bam_1_dev`</span> \%.</span>
<span id="cb20-590"><a href="#cb20-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-591"><a href="#cb20-591" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-devModel}</span></span>
<span id="cb20-592"><a href="#cb20-592" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Deviance explained of the minimal room rate for a single night by each model."</span></span>
<span id="cb20-593"><a href="#cb20-593" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data.table(</span></span>
<span id="cb20-594"><a href="#cb20-594" aria-hidden="true" tabindex="-1"></a><span class="in">  deviance = sapply(bam.list, function(x) {</span></span>
<span id="cb20-595"><a href="#cb20-595" aria-hidden="true" tabindex="-1"></a><span class="in">    round(summary(x)$dev.expl * 100, 2)</span></span>
<span id="cb20-596"><a href="#cb20-596" aria-hidden="true" tabindex="-1"></a><span class="in">  }),</span></span>
<span id="cb20-597"><a href="#cb20-597" aria-hidden="true" tabindex="-1"></a><span class="in">  model = names(bam.list)</span></span>
<span id="cb20-598"><a href="#cb20-598" aria-hidden="true" tabindex="-1"></a><span class="in">), aes(x = model, y = deviance)) +</span></span>
<span id="cb20-599"><a href="#cb20-599" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point() +</span></span>
<span id="cb20-600"><a href="#cb20-600" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_y_continuous(labels = scales::percent_format(scale = 1)) +</span></span>
<span id="cb20-601"><a href="#cb20-601" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(</span></span>
<span id="cb20-602"><a href="#cb20-602" aria-hidden="true" tabindex="-1"></a><span class="in">    x = "Generalized additive models",</span></span>
<span id="cb20-603"><a href="#cb20-603" aria-hidden="true" tabindex="-1"></a><span class="in">    y = "Deviance explained"</span></span>
<span id="cb20-604"><a href="#cb20-604" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb20-605"><a href="#cb20-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-606"><a href="#cb20-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-607"><a href="#cb20-607" aria-hidden="true" tabindex="-1"></a>Based on this analysis and using the principle of parsimony, the best model to explain variation of the minimal room rate for a single night is composed of two random intercept effects, the city and the type of properties. </span>
<span id="cb20-608"><a href="#cb20-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-609"><a href="#cb20-609" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusions</span></span>
<span id="cb20-610"><a href="#cb20-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-613"><a href="#cb20-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-614"><a href="#cb20-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb20-615"><a href="#cb20-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-616"><a href="#cb20-616" aria-hidden="true" tabindex="-1"></a><span class="co"># trick to avoid crash when render using quarto</span></span>
<span id="cb20-617"><a href="#cb20-617" aria-hidden="true" tabindex="-1"></a>unique_city_inter <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">unique</span>(data.inter<span class="sc">$</span>city), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-618"><a href="#cb20-618" aria-hidden="true" tabindex="-1"></a>length_unique_city_inter <span class="ot">&lt;-</span> <span class="fu">prettyNum</span>(<span class="fu">unique</span>(data.inter<span class="sc">$</span>hotel_type), <span class="at">big.mark =</span> <span class="st">","</span>)</span>
<span id="cb20-619"><a href="#cb20-619" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-620"><a href="#cb20-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-621"><a href="#cb20-621" aria-hidden="true" tabindex="-1"></a>Without any fixed term in the model <span class="in">`bam.6`</span>, this analysis showed that minimal room rate for a single night is nearly constant no matter the number of rooms or the distance from the city center. It also showed that the only qualitative variables that matters when setting a price is the location and the type of property proposed. To go further in the analysis I could have look at the effect of each mode, *i.e.* <span class="in">`r unique_city_inter`</span> for the cities, and <span class="in">`r length_unique_city_inter`</span> for type of properties, within the model <span class="in">`bam.1`</span>, but a simple boxplot will higlight these differences in a more visual way @fig-boxplotBAM1 and @fig-boxplotBAM2.</span>
<span id="cb20-622"><a href="#cb20-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-623"><a href="#cb20-623" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-boxplotBAM1}</span></span>
<span id="cb20-624"><a href="#cb20-624" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Minimal room rate for a single night related to cities"</span></span>
<span id="cb20-625"><a href="#cb20-625" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 5</span></span>
<span id="cb20-626"><a href="#cb20-626" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data.inter, aes(x = city, y = minrate)) +</span></span>
<span id="cb20-627"><a href="#cb20-627" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot() +</span></span>
<span id="cb20-628"><a href="#cb20-628" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "City", y = "Minimal room rate for a single night")</span></span>
<span id="cb20-629"><a href="#cb20-629" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-630"><a href="#cb20-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-boxplotBAM2}</span></span>
<span id="cb20-631"><a href="#cb20-631" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Minimal room rate for a single night related to type of properties"</span></span>
<span id="cb20-632"><a href="#cb20-632" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-height: 5</span></span>
<span id="cb20-633"><a href="#cb20-633" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-width: 10</span></span>
<span id="cb20-634"><a href="#cb20-634" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(data.inter, aes(x = hotel_type, y = minrate)) +</span></span>
<span id="cb20-635"><a href="#cb20-635" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot() +</span></span>
<span id="cb20-636"><a href="#cb20-636" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Type of property", y = "Minimal rate for a single room")</span></span>
<span id="cb20-637"><a href="#cb20-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb20-638"><a href="#cb20-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-639"><a href="#cb20-639" aria-hidden="true" tabindex="-1"></a><span class="fu"># Appendix</span></span>
<span id="cb20-640"><a href="#cb20-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-641"><a href="#cb20-641" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-sumBAM}</span></span>
<span id="cb20-642"><a href="#cb20-642" aria-hidden="true" tabindex="-1"></a><span class="in">#| output: asis</span></span>
<span id="cb20-643"><a href="#cb20-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-644"><a href="#cb20-644" aria-hidden="true" tabindex="-1"></a><span class="in"># get the summary of each GAM</span></span>
<span id="cb20-645"><a href="#cb20-645" aria-hidden="true" tabindex="-1"></a><span class="in">invisible(lapply(bam.list, function(x) {</span></span>
<span id="cb20-646"><a href="#cb20-646" aria-hidden="true" tabindex="-1"></a><span class="in">  gamtabs(summary(x), type = "HTML")</span></span>
<span id="cb20-647"><a href="#cb20-647" aria-hidden="true" tabindex="-1"></a><span class="in">}))</span></span>
<span id="cb20-648"><a href="#cb20-648" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>