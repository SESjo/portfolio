<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Joffrey Joumaa">
<meta name="dcterms.date" content="2017-12-05">
<title>Dataiku Interview Project – Joffrey Joumaa | portfolio</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-2f8a1b2753634644d1dc90402284f863.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-c3132db34a2a42639c44de93e826e000.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="site_libs/quarto-contrib/iconify-2.1.0/iconify-icon.min.js"></script><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="site_libs/datatables-binding-0.33/datatables.js"></script><script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="site_libs/dt-ext-fixedcolumns-1.13.6/css/fixedColumns.dataTables.min.css" rel="stylesheet">
<script src="site_libs/dt-ext-fixedcolumns-1.13.6/js/dataTables.fixedColumns.min.js"></script><link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Joffrey Joumaa | portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-notebooks" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Notebooks</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-notebooks">
<li>
    <a class="dropdown-item" href="./dataiku_jjoumaa.html">
 <span class="dropdown-text">Dataiku Interview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./saegus_jjoumaa.html">
 <span class="dropdown-text">Saegus Interview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./booking_jjoumaa.html">
 <span class="dropdown-text">Booking Interview</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-webapps" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Webapps</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-webapps">
<li>
    <a class="dropdown-item" href="https://nestrack.duckdns.org/" target="_blank">
 <span class="dropdown-text">DiveMap (Python)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://dash-risk.onrender.com/" target="_blank">
 <span class="dropdown-text">CropRisk (Python)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://joffreyjoumaa.shinyapps.io/shiny_risk/" target="_blank">
 <span class="dropdown-text">CropRisk (R)</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-packages" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Packages</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-packages">
<li>
    <a class="dropdown-item" href="https://sesjo.github.io/ontodive/" target="_blank">
 <span class="dropdown-text">ontodive</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item">
    <a class="nav-link" href="./resume_jjoumaa.html"> 
<span class="menu-text">Resume</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link" href="https://www.researchgate.net/profile/Joffrey-Joumaa-2" target="_blank"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="simple-icons:researchgate" aria-label="Icon researchgate from simple-icons Iconify.design set." title="Icon researchgate from simple-icons Iconify.design set."></iconify-icon></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.com/citations?user=8x1xOj4AAAAJ&amp;hl" target="_blank"> <i class="bi bi-mortarboard-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://orcid.org/0000-0002-2862-0899" target="_blank"> <i class="bi bi-fingerprint" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/joffreyjoumaa/" target="_blank"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/SESjo" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#prepare-problem" id="toc-prepare-problem" class="nav-link active" data-scroll-target="#prepare-problem"><span class="header-section-number">1</span> Prepare Problem</a>
  <ul class="collapse">
<li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries"><span class="header-section-number">1.1</span> Load libraries</a></li>
  <li><a href="#load-dataset" id="toc-load-dataset" class="nav-link" data-scroll-target="#load-dataset"><span class="header-section-number">1.2</span> Load dataset</a></li>
  </ul>
</li>
  <li>
<a href="#summarize-data" id="toc-summarize-data" class="nav-link" data-scroll-target="#summarize-data"><span class="header-section-number">2</span> Summarize Data</a>
  <ul class="collapse">
<li><a href="#descriptive-statistics" id="toc-descriptive-statistics" class="nav-link" data-scroll-target="#descriptive-statistics"><span class="header-section-number">2.1</span> Descriptive statistics</a></li>
  <li><a href="#data-visualizations" id="toc-data-visualizations" class="nav-link" data-scroll-target="#data-visualizations"><span class="header-section-number">2.2</span> Data visualizations</a></li>
  </ul>
</li>
  <li>
<a href="#prepare-data" id="toc-prepare-data" class="nav-link" data-scroll-target="#prepare-data"><span class="header-section-number">3</span> Prepare Data</a>
  <ul class="collapse">
<li><a href="#dataCleaning" id="toc-dataCleaning" class="nav-link" data-scroll-target="#dataCleaning"><span class="header-section-number">3.1</span> Data Cleaning</a></li>
  <li><a href="#feature-selection" id="toc-feature-selection" class="nav-link" data-scroll-target="#feature-selection"><span class="header-section-number">3.2</span> Feature Selection</a></li>
  <li>
<a href="#data-transforms" id="toc-data-transforms" class="nav-link" data-scroll-target="#data-transforms"><span class="header-section-number">3.3</span> Data Transforms</a>
  <ul class="collapse">
<li><a href="#yeo-johnson-transform" id="toc-yeo-johnson-transform" class="nav-link" data-scroll-target="#yeo-johnson-transform"><span class="header-section-number">3.3.1</span> Yeo-Johnson transform</a></li>
  <li><a href="#one-hot-encoding" id="toc-one-hot-encoding" class="nav-link" data-scroll-target="#one-hot-encoding"><span class="header-section-number">3.3.2</span> One-Hot encoding</a></li>
  </ul>
</li>
  <li><a href="#split-out-validation-dataset" id="toc-split-out-validation-dataset" class="nav-link" data-scroll-target="#split-out-validation-dataset"><span class="header-section-number">3.4</span> Split-out validation dataset</a></li>
  </ul>
</li>
  <li>
<a href="#evaluate-algorithms" id="toc-evaluate-algorithms" class="nav-link" data-scroll-target="#evaluate-algorithms"><span class="header-section-number">4</span> Evaluate Algorithms</a>
  <ul class="collapse">
<li><a href="#test-options-and-evaluation-metric" id="toc-test-options-and-evaluation-metric" class="nav-link" data-scroll-target="#test-options-and-evaluation-metric"><span class="header-section-number">4.1</span> Test options and evaluation metric</a></li>
  <li><a href="#spot-check-algorithms" id="toc-spot-check-algorithms" class="nav-link" data-scroll-target="#spot-check-algorithms"><span class="header-section-number">4.2</span> Spot Check Algorithms</a></li>
  <li><a href="#CompareAlgorithm" id="toc-CompareAlgorithm" class="nav-link" data-scroll-target="#CompareAlgorithm"><span class="header-section-number">4.3</span> Compare Algorithms</a></li>
  </ul>
</li>
  <li>
<a href="#improve-accuracy" id="toc-improve-accuracy" class="nav-link" data-scroll-target="#improve-accuracy"><span class="header-section-number">5</span> Improve Accuracy</a>
  <ul class="collapse">
<li><a href="#algorithm-tuning" id="toc-algorithm-tuning" class="nav-link" data-scroll-target="#algorithm-tuning"><span class="header-section-number">5.1</span> Algorithm Tuning</a></li>
  <li>
<a href="#ensembles" id="toc-ensembles" class="nav-link" data-scroll-target="#ensembles"><span class="header-section-number">5.2</span> Ensembles</a>
  <ul class="collapse">
<li><a href="#stacking" id="toc-stacking" class="nav-link" data-scroll-target="#stacking"><span class="header-section-number">5.2.1</span> Stacking</a></li>
  <li><a href="#boosting" id="toc-boosting" class="nav-link" data-scroll-target="#boosting"><span class="header-section-number">5.2.2</span> Boosting</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#finalize-model" id="toc-finalize-model" class="nav-link" data-scroll-target="#finalize-model"><span class="header-section-number">6</span> Finalize Model</a>
  <ul class="collapse">
<li><a href="#prediction" id="toc-prediction" class="nav-link" data-scroll-target="#prediction"><span class="header-section-number">6.1</span> Predictions on validation dataset</a></li>
  <li>
<a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">6.2</span> Conclusion</a>
  <ul class="collapse">
<li><a href="#some-insights" id="toc-some-insights" class="nav-link" data-scroll-target="#some-insights"><span class="header-section-number">6.2.1</span> Some insights</a></li>
  <li><a href="#go-further" id="toc-go-further" class="nav-link" data-scroll-target="#go-further"><span class="header-section-number">6.2.2</span> Go further</a></li>
  </ul>
</li>
  </ul>
</li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Dataiku Interview Project</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joffrey Joumaa </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 5, 2017</p>
    </div>
  </div>
  
    
  </div>
  


</header><style>
body {
text-align: justify}
</style>
<p>Please find below my report about the dataset provided by Dataiku. This analysis has been realized using R (version 3.3.3) with all packages updated on 21/04/2025, under a UNIX/LINUX environment (Debian 9.2). The provided script (<code>code_jjoumaa.R</code>) runs in about an hour with an Intel i7 6600U based computer equipped with 32 Gb RAM (DDR4).</p>
<section id="prepare-problem" class="level1" data-number="1"><h1 data-number="1">
<span class="header-section-number">1</span> Prepare Problem</h1>
<section id="load-libraries" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="load-libraries">
<span class="header-section-number">1.1</span> Load libraries</h2>
<p>Most of the data manipulation was done using <code>data.table</code> package due to its ability to handle large datasets. Data visualization was mostly done using <code>ggplot2</code> package. For the modelling part, I’ve used <code>caret</code> package, which provides a lot of useful tools for data science.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># data visualization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/taiyun/corrplot">corrplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="co"># data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span>
<span><span class="co"># data modeling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://zachmayer.github.io/caretEnsemble/">caretEnsemble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jefferislab/RANN">RANN</a></span><span class="op">)</span></span>
<span><span class="co"># markdown table</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT">DT</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/">pander</a></span><span class="op">)</span></span>
<span><span class="co"># (optional) multithreading</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">doMC</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/doMC/man/registerDoMC.html">registerDoMC</a></span><span class="op">(</span>cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="load-dataset" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="load-dataset">
<span class="header-section-number">1.2</span> Load dataset</h2>
<p>As we’ll see in the next steps, both datasets (learning and validation one) present a lot of missing values in the form of <code>?</code> in raw files, converted then in <code>NA</code> values in R.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># learning dataset</span></span>
<span><span class="va">dataset</span> <span class="op">=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"./dataiku_data/census_income_learn.csv"</span>, </span>
<span>                na.strings <span class="op">=</span> <span class="st">"?"</span><span class="op">)</span></span>
<span><span class="co"># validation dataset</span></span>
<span><span class="va">validation</span> <span class="op">=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"./dataiku_data/census_income_test.csv"</span>, </span>
<span>                   na.strings <span class="op">=</span> <span class="st">"?"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Since neither dataset has column names, I’ve loaded the description file <code>census_income_metadata.txt</code>, and extracted rows mentioning column names.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># selection of the right rows containing colnames</span></span>
<span><span class="va">datasetNames</span> <span class="op">=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="st">"./dataiku_data/census_income_metadata.txt"</span>, </span>
<span>                     nrows <span class="op">=</span> <span class="op">(</span><span class="fl">68</span><span class="op">-</span><span class="fl">22</span><span class="op">)</span>, </span>
<span>                     skip <span class="op">=</span> <span class="fl">22</span>, </span>
<span>                     drop <span class="op">=</span> <span class="st">"V1"</span><span class="op">)</span></span>
<span><span class="co"># extraction of word in capital</span></span>
<span><span class="va">colInter</span> <span class="op">=</span> <span class="va">datasetNames</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">V2</span>, <span class="st">'\\b[A-Z]+[A-Z0-9]\\b'</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">colInter</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code> [1] "AAGE"     "ACLSWKR"  "ADTIND"   "ADTOCC"   "AGI"      "AHGA"    
 [7] "AHRSPAY"  "AHSCOL"   "AMARITL"  "AMJIND"   "AMJOCC"   "ARACE"   
[13] "AREORGN"  "ASEX"     "AUNMEM"   "AUNTYPE"  "AWKSTAT"  "CAPGAIN" 
[19] "CAPLOSS"  "DIVVAL"   "FEDTAX"   "FILESTAT" "GRINREG"  "GRINST"  
[25] "HHDFMX"   "HHDREL"   "MARSUPWT" "MIGMTR1"  "MIGMTR3"  "MIGMTR4" 
[31] "MIGSAME"  "MIGSUN"   "NOEMP"    "PARENT"   "PEARNVAL" "PEFNTVTY"
[37] "PEMNTVTY" "PENATVTY" "PRCITSHP" "PTOTVAL"  "SEOTR"    "TAXINC"  
[43] "VETQVA"   "VETYN"    "WKSWORK" </code></pre>
</div>
</div>
<p>The problem was that 45 columns were mentioned in the description files (<code>colInter</code>), whereas both datasets only have 42 columns. To solve this, I’ve matched each column with their respective names based on the number of unique “value” by columns and the one exposed in the description file. Using this method, I’ve found that AGI, FEDTAX, PEARNVAL, PTOTVAL and TAXINC attributes could be removed from the initial column names, and that the attributes YEARS and Y (the attributes to model, <em>i.e</em> the income level) should be added.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># number of instances for each attributes</span></span>
<span><span class="va">dataset</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   V1    V2    V3    V4    V5    V6    V7    V8    V9   V10   V11   V12   V13 
   91     9    52    47    17  1240     3     7    24    15     5    10     2 
  V14   V15   V16   V17   V18   V19   V20   V21   V22   V23   V24   V25   V26 
    3     6     8   132   113  1478     6     6    51    38     8 99800    10 
  V27   V28   V29   V30   V31   V32   V33   V34   V35   V36   V37   V38   V39 
    9    10     3     4     7     5    43    43    43     5     3     3     3 
  V40   V41   V42 
   53     2     2 </code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># remove unexpected column names</span></span>
<span><span class="va">colInter</span> <span class="op">=</span> <span class="va">colInter</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">colInter</span> <span class="op">==</span> <span class="st">"AGI"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">colInter</span> <span class="op">=</span> <span class="va">colInter</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">colInter</span> <span class="op">==</span> <span class="st">"FEDTAX"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">colInter</span> <span class="op">=</span> <span class="va">colInter</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">colInter</span> <span class="op">==</span> <span class="st">"PEARNVAL"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">colInter</span> <span class="op">=</span> <span class="va">colInter</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">colInter</span> <span class="op">==</span> <span class="st">"PTOTVAL"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">colInter</span> <span class="op">=</span> <span class="va">colInter</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">colInter</span> <span class="op">==</span> <span class="st">"TAXINC"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># add two more column names</span></span>
<span><span class="va">colInter</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">colInter</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"YEAR"</span>, <span class="st">"Y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span> <span class="op">=</span> <span class="va">colInter</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">42</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">validation</span><span class="op">)</span> <span class="op">=</span> <span class="va">colInter</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">42</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># dataset preview</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">validation</span>, <span class="fl">5</span><span class="op">)</span>,  </span>
<span>          extensions <span class="op">=</span> <span class="st">'FixedColumns'</span>, </span>
<span>          options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>            dom <span class="op">=</span> <span class="st">"t"</span>, </span>
<span>            scrollX <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            fixedColumns <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-right_colnames" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-right_colnames-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Preview of the dataset
</figcaption><div aria-describedby="tbl-right_colnames-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-c98b7b3b3b74c6311242" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c98b7b3b3b74c6311242">{"x":{"filter":"none","vertical":false,"extensions":["FixedColumns"],"data":[["1","2","3","4","5"],[38,44,2,35,49],["Private","Self-employed-not incorporated","Not in universe","Private","Private"],[6,37,0,29,4],[36,12,0,3,34],["1st 2nd 3rd or 4th grade","Associates degree-occup /vocational","Children","High school graduate","High school graduate"],[0,0,0,0,0],["Not in universe","Not in universe","Not in universe","Not in universe","Not in universe"],["Married-civilian spouse present","Married-civilian spouse present","Never married","Divorced","Divorced"],["Manufacturing-durable goods","Business and repair services","Not in universe or children","Transportation","Construction"],["Machine operators assmblrs &amp; inspctrs","Professional specialty","Not in universe","Executive admin and managerial","Precision production craft &amp; repair"],["White","White","White","White","White"],["Mexican (Mexicano)","All other","Mexican-American","All other","All other"],["Female","Female","Male","Female","Male"],["Not in universe","Not in universe","Not in universe","Not in universe","Not in universe"],["Not in universe","Not in universe","Not in universe","Not in universe","Not in universe"],["Full-time schedules","PT for econ reasons usually PT","Children or Armed Forces","Children or Armed Forces","Full-time schedules"],[0,0,0,0,0],[0,0,0,0,0],[0,2500,0,0,0],["Joint one under 65 &amp; one 65+","Joint both under 65","Nonfiler","Head of household","Single"],["Not in universe","Not in universe","Not in universe","Not in universe","Not in universe"],["Not in universe","Not in universe","Not in universe","Not in universe","Not in universe"],["Spouse of householder","Spouse of householder","Child &lt;18 never marr not in subfamily","Householder","Secondary individual"],["Spouse of householder","Spouse of householder","Child under 18 never married","Householder","Nonrelative of householder"],[1032.38,1462.33,1601.75,1866.88,1394.54],[null,null,null,"Nonmover",null],[null,null,null,"Nonmover",null],[null,null,null,"Nonmover",null],["Not in universe under 1 year old","Not in universe under 1 year old","Not in universe under 1 year old","Yes","Not in universe under 1 year old"],[null,null,null,"Not in universe",null],[4,1,0,5,4],["Not in universe","Not in universe","Both parents present","Not in universe","Not in universe"],["Mexico","United-States","United-States","United-States","United-States"],["Mexico","United-States","United-States","United-States","United-States"],["Mexico","United-States","United-States","United-States","United-States"],["Foreign born- Not a citizen of U S","Native- Born in the United States","Native- Born in the United States","Native- Born in the United States","Native- Born in the United States"],[0,0,0,2,0],["Not in universe","Not in universe","Not in universe","Not in universe","Not in universe"],[2,2,0,2,2],[12,26,0,52,50],[95,95,95,94,95],["- 50000.","- 50000.","- 50000.","- 50000.","- 50000."]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>AAGE<\/th>\n      <th>ACLSWKR<\/th>\n      <th>ADTIND<\/th>\n      <th>ADTOCC<\/th>\n      <th>AHGA<\/th>\n      <th>AHRSPAY<\/th>\n      <th>AHSCOL<\/th>\n      <th>AMARITL<\/th>\n      <th>AMJIND<\/th>\n      <th>AMJOCC<\/th>\n      <th>ARACE<\/th>\n      <th>AREORGN<\/th>\n      <th>ASEX<\/th>\n      <th>AUNMEM<\/th>\n      <th>AUNTYPE<\/th>\n      <th>AWKSTAT<\/th>\n      <th>CAPGAIN<\/th>\n      <th>CAPLOSS<\/th>\n      <th>DIVVAL<\/th>\n      <th>FILESTAT<\/th>\n      <th>GRINREG<\/th>\n      <th>GRINST<\/th>\n      <th>HHDFMX<\/th>\n      <th>HHDREL<\/th>\n      <th>MARSUPWT<\/th>\n      <th>MIGMTR1<\/th>\n      <th>MIGMTR3<\/th>\n      <th>MIGMTR4<\/th>\n      <th>MIGSAME<\/th>\n      <th>MIGSUN<\/th>\n      <th>NOEMP<\/th>\n      <th>PARENT<\/th>\n      <th>PEFNTVTY<\/th>\n      <th>PEMNTVTY<\/th>\n      <th>PENATVTY<\/th>\n      <th>PRCITSHP<\/th>\n      <th>SEOTR<\/th>\n      <th>VETQVA<\/th>\n      <th>VETYN<\/th>\n      <th>WKSWORK<\/th>\n      <th>YEAR<\/th>\n      <th>Y<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","scrollX":true,"fixedColumns":false,"columnDefs":[{"className":"dt-right","targets":[1,3,4,6,17,18,19,25,31,37,39,40,41]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"AAGE","targets":1},{"name":"ACLSWKR","targets":2},{"name":"ADTIND","targets":3},{"name":"ADTOCC","targets":4},{"name":"AHGA","targets":5},{"name":"AHRSPAY","targets":6},{"name":"AHSCOL","targets":7},{"name":"AMARITL","targets":8},{"name":"AMJIND","targets":9},{"name":"AMJOCC","targets":10},{"name":"ARACE","targets":11},{"name":"AREORGN","targets":12},{"name":"ASEX","targets":13},{"name":"AUNMEM","targets":14},{"name":"AUNTYPE","targets":15},{"name":"AWKSTAT","targets":16},{"name":"CAPGAIN","targets":17},{"name":"CAPLOSS","targets":18},{"name":"DIVVAL","targets":19},{"name":"FILESTAT","targets":20},{"name":"GRINREG","targets":21},{"name":"GRINST","targets":22},{"name":"HHDFMX","targets":23},{"name":"HHDREL","targets":24},{"name":"MARSUPWT","targets":25},{"name":"MIGMTR1","targets":26},{"name":"MIGMTR3","targets":27},{"name":"MIGMTR4","targets":28},{"name":"MIGSAME","targets":29},{"name":"MIGSUN","targets":30},{"name":"NOEMP","targets":31},{"name":"PARENT","targets":32},{"name":"PEFNTVTY","targets":33},{"name":"PEMNTVTY","targets":34},{"name":"PENATVTY","targets":35},{"name":"PRCITSHP","targets":36},{"name":"SEOTR","targets":37},{"name":"VETQVA","targets":38},{"name":"VETYN","targets":39},{"name":"WKSWORK","targets":40},{"name":"YEAR","targets":41},{"name":"Y","targets":42}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</figure>
</div>
</div>
</section></section><section id="summarize-data" class="level1" data-number="2"><h1 data-number="2">
<span class="header-section-number">2</span> Summarize Data</h1>
<section id="descriptive-statistics" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="descriptive-statistics">
<span class="header-section-number">2.1</span> Descriptive statistics</h2>
<p>It is difficult to present all attributes, but a quick summary provides a good overview of the structure.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># index of column with characters</span></span>
<span><span class="va">ncolCha</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">class</span><span class="op">)</span> <span class="op">==</span> <span class="st">"character"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># conversion of characters in factors</span></span>
<span><span class="va">dataset</span><span class="op">[</span>, <span class="op">(</span><span class="va">ncolCha</span><span class="op">)</span><span class="op">:=</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">as.factor</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">ncolCha</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># structure of the dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span>, </span>
<span>                 classe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">class</span><span class="op">)</span>, </span>
<span>                 first_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>, </span>
<span>                 row.names <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-descriptive_stat" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-descriptive_stat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Structure of the dataset
</figcaption><div aria-describedby="tbl-descriptive_stat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 92%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: left;">classe</th>
<th style="text-align: left;">first_values</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">AAGE</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">73, 58, 18, 9, 10, 48</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACLSWKR</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in universe, Self-employed-not incorporated, Not in universe, Not in universe, Not in universe, Private</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ADTIND</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">0, 4, 0, 0, 0, 40</td>
</tr>
<tr class="even">
<td style="text-align: left;">ADTOCC</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">0, 34, 0, 0, 0, 10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AHGA</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">High school graduate, Some college but no degree, 10th grade, Children, Children, Some college but no degree</td>
</tr>
<tr class="even">
<td style="text-align: left;">AHRSPAY</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">0, 0, 0, 0, 0, 1200</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AHSCOL</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in universe, Not in universe, High school, Not in universe, Not in universe, Not in universe</td>
</tr>
<tr class="even">
<td style="text-align: left;">AMARITL</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Widowed, Divorced, Never married, Never married, Never married, Married-civilian spouse present</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AMJIND</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in universe or children, Construction, Not in universe or children, Not in universe or children, Not in universe or children, Entertainment</td>
</tr>
<tr class="even">
<td style="text-align: left;">AMJOCC</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in universe, Precision production craft &amp; repair, Not in universe, Not in universe, Not in universe, Professional specialty</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ARACE</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">White, White, Asian or Pacific Islander, White, White, Amer Indian Aleut or Eskimo</td>
</tr>
<tr class="even">
<td style="text-align: left;">AREORGN</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">All other, All other, All other, All other, All other, All other</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ASEX</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Female, Male, Female, Female, Female, Female</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUNMEM</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in universe, Not in universe, Not in universe, Not in universe, Not in universe, No</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AUNTYPE</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in universe, Not in universe, Not in universe, Not in universe, Not in universe, Not in universe</td>
</tr>
<tr class="even">
<td style="text-align: left;">AWKSTAT</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in labor force, Children or Armed Forces, Not in labor force, Children or Armed Forces, Children or Armed Forces, Full-time schedules</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CAPGAIN</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">0, 0, 0, 0, 0, 0</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAPLOSS</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">0, 0, 0, 0, 0, 0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">DIVVAL</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">0, 0, 0, 0, 0, 0</td>
</tr>
<tr class="even">
<td style="text-align: left;">FILESTAT</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Nonfiler, Head of household, Nonfiler, Nonfiler, Nonfiler, Joint both under 65</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GRINREG</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in universe, South, Not in universe, Not in universe, Not in universe, Not in universe</td>
</tr>
<tr class="even">
<td style="text-align: left;">GRINST</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in universe, Arkansas, Not in universe, Not in universe, Not in universe, Not in universe</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HHDFMX</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Other Rel 18+ ever marr not in subfamily, Householder, Child 18+ never marr Not in a subfamily, Child &lt;18 never marr not in subfamily, Child &lt;18 never marr not in subfamily, Spouse of householder</td>
</tr>
<tr class="even">
<td style="text-align: left;">HHDREL</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Other relative of householder, Householder, Child 18 or older, Child under 18 never married, Child under 18 never married, Spouse of householder</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MARSUPWT</td>
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">1700.09, 1053.55, 991.95, 1758.14, 1069.16, 162.61</td>
</tr>
<tr class="even">
<td style="text-align: left;">MIGMTR1</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">NA, MSA to MSA, NA, Nonmover, Nonmover, NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MIGMTR3</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">NA, Same county, NA, Nonmover, Nonmover, NA</td>
</tr>
<tr class="even">
<td style="text-align: left;">MIGMTR4</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">NA, Same county, NA, Nonmover, Nonmover, NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MIGSAME</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in universe under 1 year old, No, Not in universe under 1 year old, Yes, Yes, Not in universe under 1 year old</td>
</tr>
<tr class="even">
<td style="text-align: left;">MIGSUN</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">NA, Yes, NA, Not in universe, Not in universe, NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">NOEMP</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">0, 1, 0, 0, 0, 1</td>
</tr>
<tr class="even">
<td style="text-align: left;">PARENT</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in universe, Not in universe, Not in universe, Both parents present, Both parents present, Not in universe</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PEFNTVTY</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">United-States, United-States, Vietnam, United-States, United-States, Philippines</td>
</tr>
<tr class="even">
<td style="text-align: left;">PEMNTVTY</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">United-States, United-States, Vietnam, United-States, United-States, United-States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PENATVTY</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">United-States, United-States, Vietnam, United-States, United-States, United-States</td>
</tr>
<tr class="even">
<td style="text-align: left;">PRCITSHP</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Native- Born in the United States, Native- Born in the United States, Foreign born- Not a citizen of U S, Native- Born in the United States, Native- Born in the United States, Native- Born in the United States</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SEOTR</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">0, 0, 0, 0, 0, 2</td>
</tr>
<tr class="even">
<td style="text-align: left;">VETQVA</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">Not in universe, Not in universe, Not in universe, Not in universe, Not in universe, Not in universe</td>
</tr>
<tr class="odd">
<td style="text-align: left;">VETYN</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">2, 2, 2, 0, 0, 2</td>
</tr>
<tr class="even">
<td style="text-align: left;">WKSWORK</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">0, 52, 0, 0, 0, 52</td>
</tr>
<tr class="odd">
<td style="text-align: left;">YEAR</td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">95, 94, 95, 94, 94, 95</td>
</tr>
<tr class="even">
<td style="text-align: left;">Y</td>
<td style="text-align: left;">factor</td>
<td style="text-align: left;">- 50000., - 50000., - 50000., - 50000., - 50000., - 50000.</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># summary of the dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/pander.html">pander</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-summary-data" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-summary-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Summary of the dataset
</figcaption><div aria-describedby="tbl-summary-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 20%">
<col style="width: 39%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">AAGE</th>
<th style="text-align: center;">ACLSWKR</th>
<th style="text-align: center;">ADTIND</th>
<th style="text-align: center;">ADTOCC</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Min. : 0.00</td>
<td style="text-align: center;">Not in universe :100245</td>
<td style="text-align: center;">Min. : 0.00</td>
<td style="text-align: center;">Min. : 0.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">1st Qu.:15.00</td>
<td style="text-align: center;">Private : 72028</td>
<td style="text-align: center;">1st Qu.: 0.00</td>
<td style="text-align: center;">1st Qu.: 0.00</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Median :33.00</td>
<td style="text-align: center;">Self-employed-not incorporated: 8445</td>
<td style="text-align: center;">Median : 0.00</td>
<td style="text-align: center;">Median : 0.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mean :34.49</td>
<td style="text-align: center;">Local government : 7784</td>
<td style="text-align: center;">Mean :15.35</td>
<td style="text-align: center;">Mean :11.31</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3rd Qu.:50.00</td>
<td style="text-align: center;">State government : 4227</td>
<td style="text-align: center;">3rd Qu.:33.00</td>
<td style="text-align: center;">3rd Qu.:26.00</td>
</tr>
<tr class="even">
<td style="text-align: center;">Max. :90.00</td>
<td style="text-align: center;">Self-employed-incorporated : 3265</td>
<td style="text-align: center;">Max. :51.00</td>
<td style="text-align: center;">Max. :46.00</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NA</td>
<td style="text-align: center;">(Other) : 3529</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 38%">
<col style="width: 22%">
<col style="width: 38%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">AHGA</th>
<th style="text-align: center;">AHRSPAY</th>
<th style="text-align: center;">AHSCOL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">High school graduate :48407</td>
<td style="text-align: center;">Min. : 0.00</td>
<td style="text-align: center;">College or university: 5688</td>
</tr>
<tr class="even">
<td style="text-align: center;">Children :47422</td>
<td style="text-align: center;">1st Qu.: 0.00</td>
<td style="text-align: center;">High school : 6892</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Some college but no degree:27820</td>
<td style="text-align: center;">Median : 0.00</td>
<td style="text-align: center;">Not in universe :186943</td>
</tr>
<tr class="even">
<td style="text-align: center;">Bachelors degree(BA AB BS):19865</td>
<td style="text-align: center;">Mean : 55.43</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">7th and 8th grade : 8007</td>
<td style="text-align: center;">3rd Qu.: 0.00</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">10th grade : 7557</td>
<td style="text-align: center;">Max. :9999.00</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(Other) :40445</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 43%">
<col style="width: 45%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">AMARITL</th>
<th style="text-align: center;">AMJIND</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Divorced :12710</td>
<td style="text-align: center;">Not in universe or children :100684</td>
</tr>
<tr class="even">
<td style="text-align: center;">Married-A F spouse present : 665</td>
<td style="text-align: center;">Retail trade : 17070</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Married-civilian spouse present:84222</td>
<td style="text-align: center;">Manufacturing-durable goods : 9015</td>
</tr>
<tr class="even">
<td style="text-align: center;">Married-spouse absent : 1518</td>
<td style="text-align: center;">Education : 8283</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Never married :86485</td>
<td style="text-align: center;">Manufacturing-nondurable goods : 6897</td>
</tr>
<tr class="even">
<td style="text-align: center;">Separated : 3460</td>
<td style="text-align: center;">Finance insurance and real estate: 6145</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Widowed :10463</td>
<td style="text-align: center;">(Other) : 51429</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 45%">
<col style="width: 45%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">AMJOCC</th>
<th style="text-align: center;">ARACE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Not in universe :100684</td>
<td style="text-align: center;">Amer Indian Aleut or Eskimo: 2251</td>
</tr>
<tr class="even">
<td style="text-align: center;">Adm support including clerical: 14837</td>
<td style="text-align: center;">Asian or Pacific Islander : 5835</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Professional specialty : 13940</td>
<td style="text-align: center;">Black : 20415</td>
</tr>
<tr class="even">
<td style="text-align: center;">Executive admin and managerial: 12495</td>
<td style="text-align: center;">Other : 3657</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Other service : 12099</td>
<td style="text-align: center;">White :167365</td>
</tr>
<tr class="even">
<td style="text-align: center;">Sales : 11783</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(Other) : 33685</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 40%">
<col style="width: 22%">
<col style="width: 34%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">AREORGN</th>
<th style="text-align: center;">ASEX</th>
<th style="text-align: center;">AUNMEM</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">All other :171907</td>
<td style="text-align: center;">Female:103984</td>
<td style="text-align: center;">No : 16034</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mexican-American : 8079</td>
<td style="text-align: center;">Male : 95539</td>
<td style="text-align: center;">Not in universe:180459</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Mexican (Mexicano) : 7234</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">Yes : 3030</td>
</tr>
<tr class="even">
<td style="text-align: center;">Central or South American: 3895</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Puerto Rican : 3313</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">Other Spanish : 2485</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(Other) : 2610</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 36%">
<col style="width: 41%">
<col style="width: 21%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">AUNTYPE</th>
<th style="text-align: center;">AWKSTAT</th>
<th style="text-align: center;">CAPGAIN</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Job leaver : 598</td>
<td style="text-align: center;">Children or Armed Forces :123769</td>
<td style="text-align: center;">Min. : 0.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Job loser - on layoff: 976</td>
<td style="text-align: center;">Full-time schedules : 40736</td>
<td style="text-align: center;">1st Qu.: 0.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">New entrant : 439</td>
<td style="text-align: center;">Not in labor force : 26808</td>
<td style="text-align: center;">Median : 0.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Not in universe :193453</td>
<td style="text-align: center;">PT for non-econ reasons usually FT: 3322</td>
<td style="text-align: center;">Mean : 434.7</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Other job loser : 2038</td>
<td style="text-align: center;">Unemployed full-time : 2311</td>
<td style="text-align: center;">3rd Qu.: 0.0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Re-entrant : 2019</td>
<td style="text-align: center;">PT for econ reasons usually PT : 1209</td>
<td style="text-align: center;">Max. :99999.0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NA</td>
<td style="text-align: center;">(Other) : 1368</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 44%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">CAPLOSS</th>
<th style="text-align: center;">DIVVAL</th>
<th style="text-align: center;">FILESTAT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Min. : 0.00</td>
<td style="text-align: center;">Min. : 0.0</td>
<td style="text-align: center;">Head of household : 7426</td>
</tr>
<tr class="even">
<td style="text-align: center;">1st Qu.: 0.00</td>
<td style="text-align: center;">1st Qu.: 0.0</td>
<td style="text-align: center;">Joint both 65+ : 8332</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Median : 0.00</td>
<td style="text-align: center;">Median : 0.0</td>
<td style="text-align: center;">Joint both under 65 :67383</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mean : 37.31</td>
<td style="text-align: center;">Mean : 197.5</td>
<td style="text-align: center;">Joint one under 65 &amp; one 65+: 3867</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3rd Qu.: 0.00</td>
<td style="text-align: center;">3rd Qu.: 0.0</td>
<td style="text-align: center;">Nonfiler :75094</td>
</tr>
<tr class="even">
<td style="text-align: center;">Max. :4608.00</td>
<td style="text-align: center;">Max. :99999.0</td>
<td style="text-align: center;">Single :37421</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">GRINREG</th>
<th style="text-align: center;">GRINST</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Abroad : 530</td>
<td style="text-align: center;">Not in universe:183750</td>
</tr>
<tr class="even">
<td style="text-align: center;">Midwest : 3575</td>
<td style="text-align: center;">California : 1714</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Northeast : 2705</td>
<td style="text-align: center;">Utah : 1063</td>
</tr>
<tr class="even">
<td style="text-align: center;">Not in universe:183750</td>
<td style="text-align: center;">Florida : 849</td>
</tr>
<tr class="odd">
<td style="text-align: center;">South : 4889</td>
<td style="text-align: center;">North Carolina : 812</td>
</tr>
<tr class="even">
<td style="text-align: center;">West : 4074</td>
<td style="text-align: center;">(Other) : 10627</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA’s : 708</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 44%">
<col style="width: 45%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">HHDFMX</th>
<th style="text-align: center;">HHDREL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Householder :53248</td>
<td style="text-align: center;">Householder :75475</td>
</tr>
<tr class="even">
<td style="text-align: center;">Child &lt;18 never marr not in subfamily :50326</td>
<td style="text-align: center;">Child under 18 never married :50426</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Spouse of householder :41695</td>
<td style="text-align: center;">Spouse of householder :41709</td>
</tr>
<tr class="even">
<td style="text-align: center;">Nonfamily householder :22213</td>
<td style="text-align: center;">Child 18 or older :14430</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Child 18+ never marr Not in a subfamily:12030</td>
<td style="text-align: center;">Other relative of householder: 9703</td>
</tr>
<tr class="even">
<td style="text-align: center;">Secondary individual : 6122</td>
<td style="text-align: center;">Nonrelative of householder : 7601</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(Other) :13889</td>
<td style="text-align: center;">(Other) : 179</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 33%">
<col style="width: 41%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">MARSUPWT</th>
<th style="text-align: center;">MIGMTR1</th>
<th style="text-align: center;">MIGMTR3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Min. : 37.87</td>
<td style="text-align: center;">Nonmover :82538</td>
<td style="text-align: center;">Nonmover :82538</td>
</tr>
<tr class="even">
<td style="text-align: center;">1st Qu.: 1061.62</td>
<td style="text-align: center;">MSA to MSA :10601</td>
<td style="text-align: center;">Same county : 9812</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Median : 1618.31</td>
<td style="text-align: center;">NonMSA to nonMSA: 2811</td>
<td style="text-align: center;">Different county same state: 2797</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mean : 1740.38</td>
<td style="text-align: center;">Not in universe : 1516</td>
<td style="text-align: center;">Not in universe : 1516</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3rd Qu.: 2188.61</td>
<td style="text-align: center;">MSA to nonMSA : 790</td>
<td style="text-align: center;">Different region : 1178</td>
</tr>
<tr class="even">
<td style="text-align: center;">Max. :18656.30</td>
<td style="text-align: center;">(Other) : 1571</td>
<td style="text-align: center;">(Other) : 1986</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA’s :99696</td>
<td style="text-align: center;">NA’s :99696</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 45%">
<col style="width: 45%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">MIGMTR4</th>
<th style="text-align: center;">MIGSAME</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Nonmover :82538</td>
<td style="text-align: center;">No : 15773</td>
</tr>
<tr class="even">
<td style="text-align: center;">Same county : 9812</td>
<td style="text-align: center;">Not in universe under 1 year old:101212</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Different county same state: 2797</td>
<td style="text-align: center;">Yes : 82538</td>
</tr>
<tr class="even">
<td style="text-align: center;">Not in universe : 1516</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Different state in South : 973</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">(Other) : 2191</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NA’s :99696</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 33%">
<col style="width: 22%">
<col style="width: 43%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">MIGSUN</th>
<th style="text-align: center;">NOEMP</th>
<th style="text-align: center;">PARENT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">No : 9987</td>
<td style="text-align: center;">Min. :0.000</td>
<td style="text-align: center;">Both parents present : 38983</td>
</tr>
<tr class="even">
<td style="text-align: center;">Not in universe:84054</td>
<td style="text-align: center;">1st Qu.:0.000</td>
<td style="text-align: center;">Father only present : 1883</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Yes : 5786</td>
<td style="text-align: center;">Median :1.000</td>
<td style="text-align: center;">Mother only present : 12772</td>
</tr>
<tr class="even">
<td style="text-align: center;">NA’s :99696</td>
<td style="text-align: center;">Mean :1.956</td>
<td style="text-align: center;">Neither parent present: 1653</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NA</td>
<td style="text-align: center;">3rd Qu.:4.000</td>
<td style="text-align: center;">Not in universe :144232</td>
</tr>
<tr class="even">
<td style="text-align: center;">NA</td>
<td style="text-align: center;">Max. :6.000</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 31%">
<col style="width: 31%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">PEFNTVTY</th>
<th style="text-align: center;">PEMNTVTY</th>
<th style="text-align: center;">PENATVTY</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">United-States:159163</td>
<td style="text-align: center;">United-States:160479</td>
<td style="text-align: center;">United-States:176989</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mexico : 10008</td>
<td style="text-align: center;">Mexico : 9781</td>
<td style="text-align: center;">Mexico : 5767</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Puerto-Rico : 2680</td>
<td style="text-align: center;">Puerto-Rico : 2473</td>
<td style="text-align: center;">Puerto-Rico : 1400</td>
</tr>
<tr class="even">
<td style="text-align: center;">Italy : 2212</td>
<td style="text-align: center;">Italy : 1844</td>
<td style="text-align: center;">Germany : 851</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Canada : 1380</td>
<td style="text-align: center;">Canada : 1451</td>
<td style="text-align: center;">Philippines : 845</td>
</tr>
<tr class="even">
<td style="text-align: center;">(Other) : 17367</td>
<td style="text-align: center;">(Other) : 17376</td>
<td style="text-align: center;">(Other) : 10278</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NA’s : 6713</td>
<td style="text-align: center;">NA’s : 6119</td>
<td style="text-align: center;">NA’s : 3393</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Table continues below</caption>
<colgroup>
<col style="width: 44%">
<col style="width: 22%">
<col style="width: 33%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">PRCITSHP</th>
<th style="text-align: center;">SEOTR</th>
<th style="text-align: center;">VETQVA</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Foreign born- Not a citizen of U S : 13401</td>
<td style="text-align: center;">Min. :0.0000</td>
<td style="text-align: center;">No : 1593</td>
</tr>
<tr class="even">
<td style="text-align: center;">Foreign born- U S citizen by naturalization: 5855</td>
<td style="text-align: center;">1st Qu.:0.0000</td>
<td style="text-align: center;">Not in universe:197539</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Native- Born abroad of American Parent(s) : 1756</td>
<td style="text-align: center;">Median :0.0000</td>
<td style="text-align: center;">Yes : 391</td>
</tr>
<tr class="even">
<td style="text-align: center;">Native- Born in Puerto Rico or U S Outlying: 1519</td>
<td style="text-align: center;">Mean :0.1754</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Native- Born in the United States :176992</td>
<td style="text-align: center;">3rd Qu.:0.0000</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">NA</td>
<td style="text-align: center;">Max. :2.0000</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 22%">
<col style="width: 20%">
<col style="width: 25%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">VETYN</th>
<th style="text-align: center;">WKSWORK</th>
<th style="text-align: center;">YEAR</th>
<th style="text-align: center;">Y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Min. :0.000</td>
<td style="text-align: center;">Min. : 0.00</td>
<td style="text-align: center;">Min. :94.0</td>
<td style="text-align: center;">- 50000.:187141</td>
</tr>
<tr class="even">
<td style="text-align: center;">1st Qu.:2.000</td>
<td style="text-align: center;">1st Qu.: 0.00</td>
<td style="text-align: center;">1st Qu.:94.0</td>
<td style="text-align: center;">50000+. : 12382</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Median :2.000</td>
<td style="text-align: center;">Median : 8.00</td>
<td style="text-align: center;">Median :94.0</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mean :1.515</td>
<td style="text-align: center;">Mean :23.17</td>
<td style="text-align: center;">Mean :94.5</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">3rd Qu.:2.000</td>
<td style="text-align: center;">3rd Qu.:52.00</td>
<td style="text-align: center;">3rd Qu.:95.0</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="even">
<td style="text-align: center;">Max. :2.000</td>
<td style="text-align: center;">Max. :52.00</td>
<td style="text-align: center;">Max. :95.0</td>
<td style="text-align: center;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">NA</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>As mentioned above, a lot of missing values occurred in this dataset, especially for the attributes MIGMTR1, MIGMTR3, MIGMTR4 and MIGSUN.</p>
</section><section id="data-visualizations" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="data-visualizations">
<span class="header-section-number">2.2</span> Data visualizations</h2>
<p>Another way to have an idea of the occurrence of missing values is to used data visualization.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># build dataPlot</span></span>
<span><span class="va">dataPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span><span class="op">(</span><span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># subsample</span></span>
<span><span class="va">dataPlot</span> <span class="op">&lt;-</span> <span class="va">dataPlot</span><span class="op">[</span>, <span class="va">.SD</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span><span class="op">]</span>, by <span class="op">=</span> <span class="va">Var2</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="va">.</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span><span class="va">id_row</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">.N</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Var2"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># missing values</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dataPlot</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Var2</span>, y <span class="op">=</span> <span class="va">id_row</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Attributes"</span>, y <span class="op">=</span> <span class="st">"Rows"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Real"</span>, <span class="st">"Missing"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    legend.key <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-missingValue" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-missingValue-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="dataiku_jjoumaa_files/figure-html/fig-missingValue-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-missingValue-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Representation of missing values within the learning dataset
</figcaption></figure>
</div>
</div>
</div>
<p>It also helps for the representation of numerical attributes.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># numerical attributes index</span></span>
<span><span class="va">ncolInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">class</span><span class="op">)</span> <span class="op">==</span> <span class="st">"integer"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot for each numerical attributes</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">[</span>, <span class="va">.SD</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ncolInt</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, id.vars <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, col <span class="op">=</span> <span class="va">Y</span>, fill <span class="op">=</span> <span class="va">Y</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">..density..</span><span class="op">)</span>,</span>
<span>    bins <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"white"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-densityHistogram" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-densityHistogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="dataiku_jjoumaa_files/figure-html/fig-densityHistogram-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-densityHistogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Histogram and density for each of the numerical attributes.
</figcaption></figure>
</div>
</div>
</div>
<p>Nothing particularly clear here, except that some attributes do not seem to contain a lot of information (AHRSPAY, CAPGAIN, CAPLOSS, DIVVAL, SEOTR, VETYN, WKSWORK or YEAR). We can also note the attribute “AAGE” has a Gaussian-like distribution a bit shifted, especially for <code>Y = "- 50000.</code>, which may require to be transformed. Let’s have a look at another representation of this data.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">[</span>, <span class="va">.SD</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ncolInt</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, id.vars <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="va">value</span>, col <span class="op">=</span> <span class="va">Y</span>, fill <span class="op">=</span> <span class="va">Y</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">variable</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-boxplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="dataiku_jjoumaa_files/figure-html/fig-boxplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Boxplot for each of the numerical attributes.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># nominal attributes names</span></span>
<span><span class="va">ncolFac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="va">class</span><span class="op">)</span> <span class="op">==</span> <span class="st">"factor"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot for each nominal attributes</span></span>
<span><span class="va">dataPlot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">ncolFac</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ncolFac</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">A</span> <span class="op">&lt;-</span> <span class="va">dataset</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">Y</span><span class="op">]</span></span>
<span>  <span class="va">B</span> <span class="op">&lt;-</span> <span class="va">dataset</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">Y</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="va">.</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span></span>
<span>      V1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="va">V1</span><span class="op">)</span>,</span>
<span>      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">A</span><span class="op">$</span><span class="va">V1</span><span class="op">)</span></span>
<span>    <span class="op">)</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">B</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">levels</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">V1</span>, fill <span class="op">=</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span></span>
<span>      stat <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>      position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Count"</span>, x <span class="op">=</span> <span class="st">""</span>, title <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>      legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># print of the two first plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">dataPlot</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="va">dataPlot</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-nominalAttributes" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-nominalAttributes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="dataiku_jjoumaa_files/figure-html/fig-nominalAttributes-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nominalAttributes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Barplot for each of the nominal attributes.
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># another way to it, which appears not working using Rmarkdown document</span></span>
<span><span class="co"># grid.arrange(grobs=dataPlot, ncol=2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="prepare-data" class="level1" data-number="3"><h1 data-number="3">
<span class="header-section-number">3</span> Prepare Data</h1>
<section id="dataCleaning" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="dataCleaning">
<span class="header-section-number">3.1</span> Data Cleaning</h2>
<p>When looking at <a href="#fig-missingValue" class="quarto-xref">Figure&nbsp;1</a>, it appears that a lot of missing values occurred within the learning dataset. Here, I’ve taken the liberty to “simply” removed these values. Another way to deal with missing values would have been to use an imputation method, such as the <a href="https://topepo.github.io/caret/pre-processing.html#imputation">K-nearest neighbors method</a> <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> provided by the package <code>caret</code> (code commented below). Because this method requires high computational costs, I’ve preferred to stick to the first method, even if, as we’ll see in the next steps, it means the final model won’t be able to predict <code>Y</code> in some cases.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># removal of missing values</span></span>
<span><span class="va">datasetNa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">dataset</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## or we could have done something like this:</span></span>
<span><span class="co"># preProcValues = preProcess(dataset, method = c("knnImpute"))</span></span>
<span><span class="co"># dataset.imp = predict(preProcValues, dataset)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="feature-selection" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="feature-selection">
<span class="header-section-number">3.2</span> Feature Selection</h2>
<p>As a first step to feature selection, I’ve decided to remove any attributes with a zero or near zero variance. For many models, this may cause the model to crash or the fit to be unstable.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># identification of near zero variance attributes</span></span>
<span><span class="va">nzv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/nearZeroVar.html">nearZeroVar</a></span><span class="op">(</span><span class="va">datasetNa</span>, saveMetrics <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="va">nzv</span><span class="op">[</span><span class="va">nzv</span><span class="op">$</span><span class="va">nzv</span>, <span class="op">]</span>,</span>
<span>  caption <span class="op">=</span> <span class="st">"Information relative to zero and near zero variance predictors."</span>,</span>
<span>  option <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dom <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-7a65bf809d5014fed1f6" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7a65bf809d5014fed1f6">{"x":{"filter":"none","vertical":false,"caption":"<caption>Information relative to zero and near zero variance predictors.<\/caption>","data":[["AHRSPAY","AHSCOL","AREORGN","AUNTYPE","AWKSTAT","CAPGAIN","CAPLOSS","DIVVAL","GRINST","PENATVTY","VETQVA","YEAR"],[230.4858611825193,27.14472882388787,20.10184049079755,83.88422971741112,0,263.7844827586207,464.0398009950248,157.7523105360444,49.76728395061728,31.00684438040346,125.9291443850267,0],[0.9187427730474088,0.00315357931251971,0.01051193104173237,0.00630715862503942,0.001051193104173237,0.1335015242300011,0.1114264690423631,0.9797119730894566,0.05255965520866183,0.04204772416692946,0.00315357931251971,0.001051193104173237],[false,false,false,false,true,false,false,false,false,false,false,true],[true,true,true,true,true,true,true,true,true,true,true,true]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>freqRatio<\/th>\n      <th>percentUnique<\/th>\n      <th>zeroVar<\/th>\n      <th>nzv<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-right","targets":[1,2]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"freqRatio","targets":1},{"name":"percentUnique","targets":2},{"name":"zeroVar","targets":3},{"name":"nzv","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># removal of these predictors</span></span>
<span><span class="va">datasetNaNzv</span> <span class="op">&lt;-</span> <span class="va">datasetNa</span><span class="op">[</span>, <span class="va">.SD</span>, .SDcols <span class="op">=</span> <span class="op">!</span><span class="va">nzv</span><span class="op">$</span><span class="va">nzv</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The second step was to remove any attributes with a correlation higher than 0.75. This is a basic method, which could be improved by combining correlogram with significance test.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># matrix correlation</span></span>
<span><span class="va">ncolInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">datasetNaNzv</span>, <span class="va">class</span><span class="op">)</span> <span class="op">==</span> <span class="st">"integer"</span><span class="op">)</span></span>
<span><span class="va">descrCor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">datasetNaNzv</span><span class="op">[</span>, <span class="va">.SD</span>, .SDcols <span class="op">=</span> <span class="va">ncolInt</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># which attributes will be removed based on matrix correlation</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span><span class="op">(</span><span class="va">descrCor</span>, method <span class="op">=</span> <span class="st">"pie"</span><span class="op">)</span></span>
<span><span class="va">highlyCorDescr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/findCorrelation.html">findCorrelation</a></span><span class="op">(</span><span class="va">descrCor</span>, cutoff <span class="op">=</span> <span class="fl">.75</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ncolInt</span><span class="op">[</span><span class="va">highlyCorDescr</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "WKSWORK"</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># attribute "WKSWORK" removed</span></span>
<span><span class="va">datasetNaNzv</span><span class="op">[</span>, <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ncolInt</span><span class="op">[</span><span class="va">highlyCorDescr</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">:=</span> <span class="cn">NULL</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-correlation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-correlation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="dataiku_jjoumaa_files/figure-html/fig-correlation-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-correlation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Correlogram of dataset.
</figcaption></figure>
</div>
</div>
</div>
<p>Here, I’ve only removed the attribute “WKSWORK”. At the end of the “Feature selection” step, the current dataset includes 30 attributes instead of 42 in the original one.</p>
</section><section id="data-transforms" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="data-transforms">
<span class="header-section-number">3.3</span> Data Transforms</h2>
<section id="yeo-johnson-transform" class="level3" data-number="3.3.1"><h3 data-number="3.3.1" class="anchored" data-anchor-id="yeo-johnson-transform">
<span class="header-section-number">3.3.1</span> Yeo-Johnson transform</h3>
<p>I’ve used the Yeo-Johnson transform, since the attributes “AAGE”, <em>i.e</em> the age of the people in this dataset, has a Gaussian-like distribution with a skew (<a href="#fig-densityHistogram" class="quarto-xref">Figure&nbsp;2</a>). To make it “more Gaussian”, I’ve simply performed a <code>YeoJohnson</code> transform; I would have normally performed a <code>BoxCox</code> transform, but it does not support raw values that are equal to zero.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># calculate the pre-process parameters from the dataset</span></span>
<span><span class="va">preprocessParams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/preProcess.html">preProcess</a></span><span class="op">(</span><span class="va">datasetNaNzv</span><span class="op">[</span>, <span class="st">"AAGE"</span><span class="op">]</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"YeoJohnson"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># transform the dataset using the parameters</span></span>
<span><span class="va">datasetNaNzv</span><span class="op">$</span><span class="va">AAGE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">preprocessParams</span>, <span class="va">datasetNaNzv</span><span class="op">[</span>, <span class="st">"AAGE"</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="one-hot-encoding" class="level3" data-number="3.3.2"><h3 data-number="3.3.2" class="anchored" data-anchor-id="one-hot-encoding">
<span class="header-section-number">3.3.2</span> One-Hot encoding</h3>
<p>As we’ll see in <a href="#CompareAlgorithm">the next steps</a>, one-hot encoding was not really necessary for both algorithms tested hereafter. However, it may be a good way to improve computational costs for many algorithms that do not perform well, when dealing with nominal attributes.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># one-hot encoding</span></span>
<span><span class="va">dummies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/dummyVars.html">dummyVars</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">datasetNaNzv</span><span class="op">)</span></span>
<span><span class="va">matDummies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">dummies</span>, newdata <span class="op">=</span> <span class="va">datasetNaNzv</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As a consequence, some columns might appear to be a linear combination of others. To ensure the non-redundancy of information, I’ve removed these rows.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># remove linear combination</span></span>
<span><span class="va">comboInfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/findLinearCombos.html">findLinearCombos</a></span><span class="op">(</span><span class="va">matDummies</span><span class="op">)</span></span>
<span><span class="va">datasetNaNzvQr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">matDummies</span><span class="op">[</span>, <span class="op">-</span><span class="va">comboInfo</span><span class="op">$</span><span class="va">remove</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">datasetNaNzvQr</span><span class="op">[</span>, <span class="va">Y</span> <span class="op">:=</span> <span class="va">datasetNaNzv</span><span class="op">[</span>, <span class="va">Y</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="split-out-validation-dataset" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="split-out-validation-dataset">
<span class="header-section-number">3.4</span> Split-out validation dataset</h2>
<p>I know you provided a “test file”, but the learning dataset is large enough to be split in a learning dataset and a validation dataset by itself. Moreover, my computer is not powerful enough to run models on the whole learning dataset, so I’ve split the learning dataset with 10% of the data for the training process and the other 90% for testing (with a powerful enough computers, I would split the dataset using 80% of the data for the learning step and the other 20% for the evaluation). In the <a href="#prediction">last step</a>, I’ll evaluate the chosen model on the provided “test file”.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># identification of indexes for splitting</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">trainIndex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html">createDataPartition</a></span><span class="op">(</span><span class="va">datasetNaNzvQr</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>  p <span class="op">=</span> <span class="fl">.1</span>,</span>
<span>  list <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  times <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># split</span></span>
<span><span class="va">datasetNaNzvQr</span><span class="op">[</span>, <span class="va">Y</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">dataTrain</span> <span class="op">&lt;-</span> <span class="va">datasetNaNzvQr</span><span class="op">[</span><span class="va">trainIndex</span>, <span class="op">]</span></span>
<span><span class="va">dataTest</span> <span class="op">&lt;-</span> <span class="va">datasetNaNzvQr</span><span class="op">[</span><span class="op">-</span><span class="va">trainIndex</span>, <span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="evaluate-algorithms" class="level1" data-number="4"><h1 data-number="4">
<span class="header-section-number">4</span> Evaluate Algorithms</h1>
<section id="test-options-and-evaluation-metric" class="level2" data-number="4.1"><h2 data-number="4.1" class="anchored" data-anchor-id="test-options-and-evaluation-metric">
<span class="header-section-number">4.1</span> Test options and evaluation metric</h2>
<p>Here I’ve chosen to cross-validate the model using 5 folds repeated twice. As explained before, with a powerful enough computer I would encourage increasing these values. Because the problem to solve is a classification problem, the metric used to select the optimal model is the “Accuracy”, except for the <a href="#stacking">“Stacking”</a> part, where the area under the ROC curve was used.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># cross-validation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">trainControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="st">"repeatedcv"</span>,</span>
<span>  number <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  repeats <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  savePredictions <span class="op">=</span> <span class="st">"final"</span>, <span class="co"># required for stacking</span></span>
<span>  classProbs <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="co"># required for stacking</span></span>
<span></span>
<span><span class="co"># metric evaluation</span></span>
<span><span class="va">metric</span> <span class="op">&lt;-</span> <span class="st">"Accuracy"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="spot-check-algorithms" class="level2" data-number="4.2"><h2 data-number="4.2" class="anchored" data-anchor-id="spot-check-algorithms">
<span class="header-section-number">4.2</span> Spot Check Algorithms</h2>
<p>Because the dataset is strongly imbalance…</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># proportion of each levels of Y</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html">data.table</a></span><span class="op">(</span></span>
<span>    freq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">datasetNaNzvQr</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>,</span>
<span>    percentage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">datasetNaNzvQr</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  option <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>dom <span class="op">=</span> <span class="st">"t"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-propImbalance" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-propImbalance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Proportion of each levels of the explaining variable.
</figcaption><div aria-describedby="tbl-propImbalance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-56323dfc43fcbae7e7be" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-56323dfc43fcbae7e7be">{"x":{"filter":"none","vertical":false,"data":[["1","2"],["X..50000.","X50000.."],[89651,5479],["X..50000.","X50000.."],[94.23999999999999,5.76]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>freq.V1<\/th>\n      <th>freq.N<\/th>\n      <th>percentage.V1<\/th>\n      <th>percentage.N<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"dom":"t","columnDefs":[{"className":"dt-right","targets":[2,4]},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"freq.V1","targets":1},{"name":"freq.N","targets":2},{"name":"percentage.V1","targets":3},{"name":"percentage.N","targets":4}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</figure>
</div>
</div>
<p>… it can have significant negative impact on model fitting (by the way, it seems consistent that a large proportion of these people earn less than 50 000$ pear annum). Here I’ve explored two different ways to deal with it:</p>
<ul>
<li>
<em>down-sampling</em>: randomly subset all the classes in the training set so that their class frequencies match the least prevalent class.</li>
<li>
<em>up-sampling</em>: randomly sample (with replacement) the minority class to be the same size as the majority class.</li>
</ul>
<p>In addition, I’ve tested two different algorithms, the <strong>Logistic Regression</strong>, and <strong>k-Nearest Neighbors</strong>.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># down-sampling</span></span>
<span><span class="va">trainControl</span><span class="op">$</span><span class="va">sampling</span> <span class="op">&lt;-</span> <span class="st">"down"</span></span>
<span></span>
<span><span class="co"># logistic regression</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">fitLogDown</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dataTrain</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  metric <span class="op">=</span> <span class="va">metric</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">trainControl</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># KNN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">fitKnnDown</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dataTrain</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"knn"</span>,</span>
<span>  metric <span class="op">=</span> <span class="va">metric</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">trainControl</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># up-sampling</span></span>
<span><span class="va">trainControl</span><span class="op">$</span><span class="va">sampling</span> <span class="op">&lt;-</span> <span class="st">"up"</span></span>
<span></span>
<span><span class="co"># logistic regression</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">fitLogUp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dataTrain</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  metric <span class="op">=</span> <span class="va">metric</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">trainControl</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># KNN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">fitKnnUp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dataTrain</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"knn"</span>,</span>
<span>  metric <span class="op">=</span> <span class="va">metric</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">trainControl</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="CompareAlgorithm" class="level2" data-number="4.3"><h2 data-number="4.3" class="anchored" data-anchor-id="CompareAlgorithm">
<span class="header-section-number">4.3</span> Compare Algorithms</h2>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># resample</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/resamples.html">resamples</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  KNN_UP <span class="op">=</span> <span class="va">fitKnnUp</span>,</span>
<span>  LOG_UP <span class="op">=</span> <span class="va">fitLogUp</span>,</span>
<span>  KNN_DOWN <span class="op">=</span> <span class="va">fitKnnDown</span>,</span>
<span>  LOG_DOWN <span class="op">=</span> <span class="va">fitLogDown</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
summary.resamples(object = results)

Models: KNN_UP, LOG_UP, KNN_DOWN, LOG_DOWN 
Number of resamples: 10 

Accuracy 
              Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA's
KNN_UP   0.7861272 0.7933030 0.8021026 0.7996639 0.8063584 0.8113505    0
LOG_UP   0.3608193 0.8272871 0.8399895 0.7953308 0.8436472 0.8949028    0
KNN_DOWN 0.6006306 0.6115127 0.6203388 0.6213483 0.6330793 0.6405675    0
LOG_DOWN 0.6263794 0.7792086 0.7866527 0.7728101 0.7977917 0.8128286    0

Kappa 
               Min.    1st Qu.     Median       Mean   3rd Qu.       Max. NA's
KNN_UP   0.12070882 0.13707161 0.14558179 0.14449985 0.1528234 0.16022824    0
LOG_UP   0.04003155 0.26565309 0.29853090 0.27619801 0.3223886 0.34684118    0
KNN_DOWN 0.06257470 0.06846597 0.07426959 0.07606744 0.0841786 0.09147037    0
LOG_DOWN 0.08160797 0.21929935 0.22963676 0.22159830 0.2422348 0.27955925    0</code></pre>
</div>
</div>
<p>It appears the <em>up-sampling</em> method performs better than the <em>down-sampling</em>. In addition, the <strong>k-Nearest Neighbors</strong> algorithm provides better results than the <strong>Logistic Regression</strong> one. Let’s now compare both algorithms using the <em>up-sampling</em> method with a dataset including nominal attributes (<em>i.e.</em> not using one-hot encoding).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># new data split based on the dataset without hot encoding</span></span>
<span><span class="va">datasetNaNzv</span><span class="op">[</span>, <span class="va">Y</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">dataTrainVar</span> <span class="op">&lt;-</span> <span class="va">datasetNaNzv</span><span class="op">[</span><span class="va">trainIndex</span>, <span class="op">]</span></span>
<span><span class="va">dataTestVar</span> <span class="op">&lt;-</span> <span class="va">datasetNaNzv</span><span class="op">[</span><span class="op">-</span><span class="va">trainIndex</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># logistic regression</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">fitLogUpVar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dataTrainVar</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  metric <span class="op">=</span> <span class="va">metric</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">trainControl</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># KNN</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">fitKnnUpVar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dataTrainVar</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"knn"</span>,</span>
<span>  metric <span class="op">=</span> <span class="va">metric</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">trainControl</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># resample</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/resamples.html">resamples</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  KNN_UP <span class="op">=</span> <span class="va">fitKnnUp</span>,</span>
<span>  LOG_UP <span class="op">=</span> <span class="va">fitLogUp</span>,</span>
<span>  KNN_DOWN <span class="op">=</span> <span class="va">fitKnnDown</span>,</span>
<span>  LOG_DOWN <span class="op">=</span> <span class="va">fitLogDown</span>,</span>
<span>  KNN_UP_VAR <span class="op">=</span> <span class="va">fitKnnUpVar</span>,</span>
<span>  LOG_UP_VAR <span class="op">=</span> <span class="va">fitLogUpVar</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
summary.resamples(object = results)

Models: KNN_UP, LOG_UP, KNN_DOWN, LOG_DOWN, KNN_UP_VAR, LOG_UP_VAR 
Number of resamples: 10 

Accuracy 
                Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA's
KNN_UP     0.7861272 0.7933030 0.8021026 0.7996639 0.8063584 0.8113505    0
LOG_UP     0.3608193 0.8272871 0.8399895 0.7953308 0.8436472 0.8949028    0
KNN_DOWN   0.6006306 0.6115127 0.6203388 0.6213483 0.6330793 0.6405675    0
LOG_DOWN   0.6263794 0.7792086 0.7866527 0.7728101 0.7977917 0.8128286    0
KNN_UP_VAR 0.7854890 0.7935655 0.8015769 0.7989281 0.8043878 0.8108250    0
LOG_UP_VAR 0.1514196 0.7926957 0.8392013 0.7488078 0.8494482 0.8533123    0

Kappa 
                  Min.    1st Qu.     Median       Mean   3rd Qu.       Max.
KNN_UP      0.12070882 0.13707161 0.14558179 0.14449985 0.1528234 0.16022824
LOG_UP      0.04003155 0.26565309 0.29853090 0.27619801 0.3223886 0.34684118
KNN_DOWN    0.06257470 0.06846597 0.07426959 0.07606744 0.0841786 0.09147037
LOG_DOWN    0.08160797 0.21929935 0.22963676 0.22159830 0.2422348 0.27955925
KNN_UP_VAR  0.12022934 0.13740228 0.14592863 0.14439255 0.1535522 0.15962758
LOG_UP_VAR -0.05243764 0.24262988 0.27824470 0.22688123 0.3000925 0.33037603
           NA's
KNN_UP        0
LOG_UP        0
KNN_DOWN      0
LOG_DOWN      0
KNN_UP_VAR    0
LOG_UP_VAR    0</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html">dotplot</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-dotplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-dotplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="dataiku_jjoumaa_files/figure-html/fig-dotplot-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dotplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Models comparison.
</figcaption></figure>
</div>
</div>
</div>
<p>Using direct nominal attributes instead of one-hot encoding provides better results (<em>i.e.</em> higher accuracy) for the <strong>Logistic Regression</strong>, which is not the case for <strong>k-Nearest Neighbors</strong> algorithm, which provides the same accuracy.</p>
</section></section><section id="improve-accuracy" class="level1" data-number="5"><h1 data-number="5">
<span class="header-section-number">5</span> Improve Accuracy</h1>
<section id="algorithm-tuning" class="level2" data-number="5.1"><h2 data-number="5.1" class="anchored" data-anchor-id="algorithm-tuning">
<span class="header-section-number">5.1</span> Algorithm Tuning</h2>
<p>Depending on the algorithm to chose, we can improve the accuracy by choosing the appropriate set of parameters. Below, you’ll find a recipe to find the optimal number of neighbors to set when using a <strong>k-Nearest Neighbors</strong> algorithm. Due to high computational cost, I did not run this code.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># search for the optimal number of neighbors K (did not run)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>.k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">20</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fitKnnUpVar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dataTrainVar</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"knn"</span>,</span>
<span>  metric <span class="op">=</span> <span class="va">metric</span>,</span>
<span>  tuneGrid <span class="op">=</span> <span class="va">grid</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">trainControl</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tuning kNN parameter</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fitKnnUpVar</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="ensembles" class="level2" data-number="5.2"><h2 data-number="5.2" class="anchored" data-anchor-id="ensembles">
<span class="header-section-number">5.2</span> Ensembles</h2>
<section id="stacking" class="level3" data-number="5.2.1"><h3 data-number="5.2.1" class="anchored" data-anchor-id="stacking">
<span class="header-section-number">5.2.1</span> Stacking</h3>
<p>Another way to improve the accuracy is to combine the predictions of several models into ensemble predictions. To do this, we first have to make sure predictions from sub-models have a low correlation.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># correlation of models pairs of predictions</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/corrplot/man/corrplot.html">corrplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/resamples.html">modelCor</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"pie"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-correlogramPrediction" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-correlogramPrediction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="dataiku_jjoumaa_files/figure-html/fig-correlogramPrediction-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-correlogramPrediction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Correlogram of the predictions by models.
</figcaption></figure>
</div>
</div>
</div>
<p>Here, that seems to be the case, since no one has a high correlation (<em>i.e</em> &gt; 0.75). I’ve decided to use both algorithms using nominal attributes and the <em>up-sampling</em> method to build a <em>meta</em>-model (<code>multiFit</code>).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># cross-validation</span></span>
<span><span class="va">stackControl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="st">"repeatedcv"</span>,</span>
<span>  number <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  repeats <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  savePredictions <span class="op">=</span> <span class="st">"final"</span>,</span>
<span>  classProbs <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># list of models</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">multiModels</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://zachmayer.github.io/caretEnsemble/reference/caretList.html">caretList</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dataTrainVar</span>,</span>
<span>  methodList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"glm"</span>, <span class="st">"knn"</span><span class="op">)</span>,</span>
<span>  tuneList <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    glm <span class="op">=</span> <span class="fu"><a href="http://zachmayer.github.io/caretEnsemble/reference/caretModelSpec.html">caretModelSpec</a></span><span class="op">(</span></span>
<span>      method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>      family <span class="op">=</span> <span class="st">"binomial"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    knn <span class="op">=</span> <span class="fu"><a href="http://zachmayer.github.io/caretEnsemble/reference/caretModelSpec.html">caretModelSpec</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"knn"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">trainControl</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># stacking</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">multiFits</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://zachmayer.github.io/caretEnsemble/reference/caretEnsemble.html">caretEnsemble</a></span><span class="op">(</span><span class="va">multiModels</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">stackControl</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">multiFits</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>The following models were ensembled: glm, knn, glm.1, knn.1  

caret::train model:
Greedy Mean Squared Error Optimizer 

9514 samples
   8 predictor
   2 classes: 'X..50000.', 'X50000..' 

No pre-processing
Resampling: Cross-Validated (5 fold, repeated 2 times) 
Summary of sample sizes: 7611, 7612, 7611, 7612, 7610, 7611, ... 
Resampling results:

  Accuracy   Kappa    
  0.8332439  0.2084181

Tuning parameter 'max_iter' was held constant at a value of 100

Final model:
Greedy MSE
RMSE:  0.3381455 
Weights:
                X..50000. X50000..
glm_X..50000.        0.35     0.00
glm_X50000..         0.00     0.35
knn_X..50000.        0.29     0.00
knn_X50000..         0.00     0.29
glm.1_X..50000.      0.10     0.01
glm.1_X50000..       0.01     0.10
knn.1_X..50000.      0.25     0.00
knn.1_X50000..       0.00     0.25</code></pre>
</div>
</div>
<p>The accuracy seems to be better than both algorithms alone (<code>Log</code>: 0.75 and <code>kNN</code>: 0.8, 0.75, 0.71, whereas <code>stacking</code>: 0.83). However, the Kappa value of 0 is symptomatic of a problem that we’re going to clarify when looking at the <a href="#prediction">predictions</a>.</p>
</section><section id="boosting" class="level3" data-number="5.2.2"><h3 data-number="5.2.2" class="anchored" data-anchor-id="boosting">
<span class="header-section-number">5.2.2</span> Boosting</h3>
<p>Another way to used ensemble predictions is to use an algorithm based on boosting method. The idea here is to build multiple models where each of which learns to fix the prediction errors of a prior model in the chain. Let’s test one of the most popular boosting machine learning algorithms, the <strong>C5.0</strong> classification based on a set of rules.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># C5.0 classification</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="va">fitC5UpVar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dataTrainVar</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"C5.0Rules"</span>,</span>
<span>  metric <span class="op">=</span> <span class="va">metric</span>,</span>
<span>  trControl <span class="op">=</span> <span class="va">trainControl</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fitC5UpVar</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Single C5.0 Ruleset 

9514 samples
  28 predictor
   2 classes: 'X..50000.', 'X50000..' 

No pre-processing
Resampling: Cross-Validated (5 fold, repeated 2 times) 
Summary of sample sizes: 7611, 7612, 7611, 7612, 7610, 7611, ... 
Addtional sampling using up-sampling

Resampling results:

  Accuracy   Kappa    
  0.9191195  0.3461387</code></pre>
</div>
</div>
</section></section></section><section id="finalize-model" class="level1" data-number="6"><h1 data-number="6">
<span class="header-section-number">6</span> Finalize Model</h1>
<section id="prediction" class="level2" data-number="6.1"><h2 data-number="6.1" class="anchored" data-anchor-id="prediction">
<span class="header-section-number">6.1</span> Predictions on validation dataset</h2>
<p>Here comes the part where I’ve tested the two ensemble models (stacking and boosting) predictions on your validation dataset. But first, I have to pre-process this dataset to make sure both models will correctly run.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># remove missing value</span></span>
<span><span class="va">validationNa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">validation</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># keep the same attributes used in the learning dataset</span></span>
<span><span class="va">validationNa</span> <span class="op">&lt;-</span> <span class="va">validationNa</span><span class="op">[</span>, <span class="va">.SD</span>, .SDcols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dataTrainVar</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># suitable name for R (i.e. the same as the learning dataset)</span></span>
<span><span class="va">validationNa</span><span class="op">[</span>, <span class="va">Y</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/make.names.html">make.names</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Yeo-Johnson transform of the attribute AAGE</span></span>
<span><span class="va">validationNa</span><span class="op">$</span><span class="va">AAGE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">preprocessParams</span>, <span class="va">validationNa</span><span class="op">[</span>, <span class="st">"AAGE"</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert characters to factors</span></span>
<span><span class="va">ncolCha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">validationNa</span>, <span class="va">class</span><span class="op">)</span> <span class="op">==</span> <span class="st">"character"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">validationNa</span><span class="op">[</span>, <span class="op">(</span><span class="va">ncolCha</span><span class="op">)</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">as.factor</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">ncolCha</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Because I removed a lot of rows during the <a href="#dataCleaning">data cleaning</a> step, it removed some levels of nominal attributes in the learning dataset. This implies that neither model can make prediction for this levels. To avoid errors when predicting on the validation dataset, I’ve removed any rows that do not match levels of the training dataset.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># only keep levels of factors in the validation datatset that match those in the learning one</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">dataTrainVar</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">class</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="op">-</span><span class="st">"Y"</span><span class="op">]</span> <span class="op">==</span> <span class="st">"factor"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">validationNa</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">unique</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">dataTrainVar</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">.SD</span>, <span class="va">unique</span><span class="op">)</span>, .SDcols <span class="op">=</span> <span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">y</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">delNrow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">delNrow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">delNrow</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">validationNa</span><span class="op">[</span>, <span class="va">i</span>, with <span class="op">=</span> <span class="cn">F</span><span class="op">]</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">validationNa</span> <span class="op">&lt;-</span> <span class="va">validationNa</span><span class="op">[</span><span class="op">-</span><span class="va">delNrow</span>, <span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now that we have a validation dataset that matches the same column names and levels of nominal attributes from the learning one, we can make predictions and compare them to the real values.</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># make prediction</span></span>
<span><span class="va">predictionsStack</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">multiFits</span>,</span>
<span>                           <span class="va">validationNa</span><span class="op">[</span>, <span class="va">.SD</span>, .SDcols <span class="op">=</span> <span class="op">-</span><span class="st">"Y"</span><span class="op">]</span>,</span>
<span>                           type<span class="op">=</span><span class="st">"raw"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">predictionsC5</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fitC5UpVar</span>,</span>
<span>                        <span class="va">validationNa</span><span class="op">[</span>, <span class="va">.SD</span>, .SDcols <span class="op">=</span> <span class="op">-</span><span class="st">"Y"</span><span class="op">]</span>,</span>
<span>                        type<span class="op">=</span><span class="st">"raw"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># confusion matrix calculation</span></span>
<span><span class="va">confStack</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="va">predictionsStack</span>, <span class="va">validationNa</span><span class="op">[</span>, <span class="va">Y</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">confC5</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/confusionMatrix.html">confusionMatrix</a></span><span class="op">(</span><span class="va">predictionsC5</span>, <span class="va">validationNa</span><span class="op">[</span>, <span class="va">Y</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">confStack</span></span>
<span><span class="va">confC5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can see that the stacking model (<em>i.e</em> <code>Log</code> + <code>kNN</code>) has, indeed, an accuracy of 0.83 which is higher than the boosting model (<em>i.e</em> <code>C5.0</code>) with “only” 0.92. However, the confusion matrix shows the stacking model simply predicts the same value (the one from the prevalent class), which results in a misleading accuracy (<em>i.e</em> accuracy = proportion of the majority class).</p>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># accuracy &amp; proportion of the majority class</span></span>
<span><span class="va">accuracyStack</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">confStack</span><span class="op">$</span><span class="va">overall</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>                     <span class="co"># accuracy of stack model</span></span>
<span><span class="va">propMajorClass</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">validationNa</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>  <span class="co"># prop of prevalent class</span></span>
<span></span>
<span><span class="co"># accuracy = proportion of the majority class?</span></span>
<span><span class="va">accuracyStack</span> <span class="op">==</span> <span class="va">propMajorClass</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="conclusion" class="level2" data-number="6.2"><h2 data-number="6.2" class="anchored" data-anchor-id="conclusion">
<span class="header-section-number">6.2</span> Conclusion</h2>
<section id="some-insights" class="level3" data-number="6.2.1"><h3 data-number="6.2.1" class="anchored" data-anchor-id="some-insights">
<span class="header-section-number">6.2.1</span> Some insights</h3>
<p>Based on the calculation of variable importance in the <code>fitC5UpVar</code> model, the three variables that, in order of importance, are the most important when estimating if the income level will be more than 50 000$ per annum seems to be:</p>
<ul>
<li>the tax filer status (levels: Nonfiler)</li>
<li>the age</li>
<li>the number of persons that worked for employer</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># variable importance for the fitC5UpVar model</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/caret/man/varImp.html">varImp</a></span><span class="op">(</span><span class="va">fitC5UpVar</span>, scale <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>C5.0Rules variable importance

  only 20 most important variables shown (out of 307)

                                       Overall
FILESTATNonfiler                        100.00
MARSUPWT                                 41.39
NOEMP                                    40.76
AAGE                                     39.66
ASEXMale                                 39.10
ADTOCC                                   26.51
ACLSWKRSelf-employed-incorporated        25.32
AMJINDMedicalexcepthospital              23.53
AHGAMastersdegree(MAMSMEngMEdMSWMBA)     23.32
AHGASomecollegebutnodegree               20.93
AHGAHighschoolgraduate                   20.49
AMJOCCSales                              19.13
HHDFMXSpouseofhouseholder                16.87
HHDFMXChild18+nevermarrNotinasubfamily   16.74
ACLSWKRNotinuniverse                     14.07
AMJOCCProtectiveservices                 13.38
AMARITLSeparated                         13.29
AHGAAssociatesdegree-occup/vocational    12.90
ADTIND                                   10.77
MIGMTR4DifferentstateinWest              10.52</code></pre>
</div>
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># some plot to illustrate</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">FILESTAT</span>, fill<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">AAGE</span>, fill <span class="op">=</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dataset</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">NOEMP</span>, fill <span class="op">=</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html">position_dodge</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">3</span>, heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-varImportance" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-varImportance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="dataiku_jjoumaa_files/figure-html/fig-varImportance-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-varImportance-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Distribution and barplot of the three most important variables when predicting the income level of the person represented by the record.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="go-further" class="level3" data-number="6.2.2"><h3 data-number="6.2.2" class="anchored" data-anchor-id="go-further">
<span class="header-section-number">6.2.2</span> Go further</h3>
<p>Here are few ideas to improve this analysis:</p>
<ul>
<li>Data Preparation
<ul>
<li>Data cleaning
<ul>
<li>Try to impute missing value using k nearest neighbors or bagged tree algorithm. It should allow the selected model to predict the income level for all people, regardless of the different levels of a factor in any nominal attributes.</li>
<li>Look closer for outliers and maybe try some methods like PCA to remove noises.</li>
</ul>
</li>
<li>Data transform
<ul>
<li>Try normalized numerical variables.</li>
<li>Consider Box-Cox transform on other numerical attributes.</li>
</ul>
</li>
<li>Data split
<ul>
<li>Simply use the whole learning dataset and not 10 % of it.</li>
</ul>
</li>
</ul>
</li>
<li>Evaluate algorithms
<ul>
<li>Spot Check Algorithm: test more linear and non-linear algorithms.</li>
</ul>
</li>
<li>Improve accuracy
<ul>
<li>Ensembles
<ul>
<li>For boosting, it’s the same, let’s take a look at several boosting machine learning algorithms which seems to be very promising.</li>
<li>For stacking, same as above, test different combinations of models, and then combine predictions using several different algorithms (<em>i.e</em> not just a simple linear model, like I did here).</li>
</ul>
</li>
</ul>
</li>
</ul>


<!-- -->

</section></section></section><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>Another method is implemented based on bagged trees but at higher computational costs.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb46" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Dataiku Interview Project"</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">  - name: "Joffrey Joumaa"</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "December 5, 2017"</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-location: left</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-link: true</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-align: "center"</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="co">  cache: true</span></span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk:</span></span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a><span class="co">    message: false</span></span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a><span class="co">    tidy: styler</span></span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup}</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a><span class="in">#| include: false</span></span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a><span class="in">#| eval: false</span></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(</span></span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a><span class="in">  echo = TRUE, </span></span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a><span class="in">  message = FALSE, </span></span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a><span class="in">  warning = FALSE, </span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a><span class="in">  comment = NA, </span></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a><span class="in">  cache = TRUE,</span></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a><span class="in">  fig.align = "center"</span></span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a><span class="in">body {</span></span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a><span class="in">text-align: justify}</span></span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb46-46"><a href="#cb46-46" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-47"><a href="#cb46-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-48"><a href="#cb46-48" aria-hidden="true" tabindex="-1"></a>Please find below my report about the dataset provided by Dataiku. This analysis has been realized using R (version 3.3.3) with all packages updated on <span class="in">`r format(Sys.Date(), "%d/%m/%Y")`</span>, under a UNIX/LINUX environment (Debian 9.2). The provided script (<span class="in">`code_jjoumaa.R`</span>) runs in about an hour with an Intel i7 6600U based computer equipped with 32 Gb RAM (DDR4).</span>
<span id="cb46-49"><a href="#cb46-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-50"><a href="#cb46-50" aria-hidden="true" tabindex="-1"></a><span class="fu"># Prepare Problem</span></span>
<span id="cb46-51"><a href="#cb46-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-52"><a href="#cb46-52" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load libraries</span></span>
<span id="cb46-53"><a href="#cb46-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-54"><a href="#cb46-54" aria-hidden="true" tabindex="-1"></a>Most of the data manipulation was done using <span class="in">`data.table`</span> package due to its ability to handle large datasets. Data visualization was mostly done using <span class="in">`ggplot2`</span> package. For the modelling part, I've used <span class="in">`caret`</span> package, which provides a lot of useful tools for data science.</span>
<span id="cb46-55"><a href="#cb46-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-56"><a href="#cb46-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load_libraries}</span></span>
<span id="cb46-57"><a href="#cb46-57" aria-hidden="true" tabindex="-1"></a><span class="in"># data visualization</span></span>
<span id="cb46-58"><a href="#cb46-58" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb46-59"><a href="#cb46-59" aria-hidden="true" tabindex="-1"></a><span class="in">library(corrplot)</span></span>
<span id="cb46-60"><a href="#cb46-60" aria-hidden="true" tabindex="-1"></a><span class="in">library(gridExtra)</span></span>
<span id="cb46-61"><a href="#cb46-61" aria-hidden="true" tabindex="-1"></a><span class="in"># data manipulation</span></span>
<span id="cb46-62"><a href="#cb46-62" aria-hidden="true" tabindex="-1"></a><span class="in">library(data.table)</span></span>
<span id="cb46-63"><a href="#cb46-63" aria-hidden="true" tabindex="-1"></a><span class="in">library(stringr)</span></span>
<span id="cb46-64"><a href="#cb46-64" aria-hidden="true" tabindex="-1"></a><span class="in">library(magrittr)</span></span>
<span id="cb46-65"><a href="#cb46-65" aria-hidden="true" tabindex="-1"></a><span class="in"># data modeling</span></span>
<span id="cb46-66"><a href="#cb46-66" aria-hidden="true" tabindex="-1"></a><span class="in">library(caret)</span></span>
<span id="cb46-67"><a href="#cb46-67" aria-hidden="true" tabindex="-1"></a><span class="in">library(caretEnsemble)</span></span>
<span id="cb46-68"><a href="#cb46-68" aria-hidden="true" tabindex="-1"></a><span class="in">library(RANN)</span></span>
<span id="cb46-69"><a href="#cb46-69" aria-hidden="true" tabindex="-1"></a><span class="in"># markdown table</span></span>
<span id="cb46-70"><a href="#cb46-70" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb46-71"><a href="#cb46-71" aria-hidden="true" tabindex="-1"></a><span class="in">library(DT)</span></span>
<span id="cb46-72"><a href="#cb46-72" aria-hidden="true" tabindex="-1"></a><span class="in">library(pander)</span></span>
<span id="cb46-73"><a href="#cb46-73" aria-hidden="true" tabindex="-1"></a><span class="in"># (optional) multithreading</span></span>
<span id="cb46-74"><a href="#cb46-74" aria-hidden="true" tabindex="-1"></a><span class="in">library(doMC)</span></span>
<span id="cb46-75"><a href="#cb46-75" aria-hidden="true" tabindex="-1"></a><span class="in">registerDoMC(cores = 4)</span></span>
<span id="cb46-76"><a href="#cb46-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-77"><a href="#cb46-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-78"><a href="#cb46-78" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load dataset</span></span>
<span id="cb46-79"><a href="#cb46-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-80"><a href="#cb46-80" aria-hidden="true" tabindex="-1"></a>As we'll see in the next steps, both datasets (learning and validation one) present a lot of missing values in the form of <span class="in">`?`</span> in raw files, converted then in <span class="in">`NA`</span> values in R.</span>
<span id="cb46-81"><a href="#cb46-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-82"><a href="#cb46-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load_dataset}</span></span>
<span id="cb46-83"><a href="#cb46-83" aria-hidden="true" tabindex="-1"></a><span class="in"># learning dataset</span></span>
<span id="cb46-84"><a href="#cb46-84" aria-hidden="true" tabindex="-1"></a><span class="in">dataset = fread("./dataiku_data/census_income_learn.csv", </span></span>
<span id="cb46-85"><a href="#cb46-85" aria-hidden="true" tabindex="-1"></a><span class="in">                na.strings = "?")</span></span>
<span id="cb46-86"><a href="#cb46-86" aria-hidden="true" tabindex="-1"></a><span class="in"># validation dataset</span></span>
<span id="cb46-87"><a href="#cb46-87" aria-hidden="true" tabindex="-1"></a><span class="in">validation = fread("./dataiku_data/census_income_test.csv", </span></span>
<span id="cb46-88"><a href="#cb46-88" aria-hidden="true" tabindex="-1"></a><span class="in">                   na.strings = "?")</span></span>
<span id="cb46-89"><a href="#cb46-89" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-90"><a href="#cb46-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-91"><a href="#cb46-91" aria-hidden="true" tabindex="-1"></a>Since neither dataset has column names, I've loaded the description file <span class="in">`census_income_metadata.txt`</span>, and extracted rows mentioning column names.</span>
<span id="cb46-92"><a href="#cb46-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-93"><a href="#cb46-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load_colnames}</span></span>
<span id="cb46-94"><a href="#cb46-94" aria-hidden="true" tabindex="-1"></a><span class="in"># selection of the right rows containing colnames</span></span>
<span id="cb46-95"><a href="#cb46-95" aria-hidden="true" tabindex="-1"></a><span class="in">datasetNames = fread("./dataiku_data/census_income_metadata.txt", </span></span>
<span id="cb46-96"><a href="#cb46-96" aria-hidden="true" tabindex="-1"></a><span class="in">                     nrows = (68-22), </span></span>
<span id="cb46-97"><a href="#cb46-97" aria-hidden="true" tabindex="-1"></a><span class="in">                     skip = 22, </span></span>
<span id="cb46-98"><a href="#cb46-98" aria-hidden="true" tabindex="-1"></a><span class="in">                     drop = "V1")</span></span>
<span id="cb46-99"><a href="#cb46-99" aria-hidden="true" tabindex="-1"></a><span class="in"># extraction of word in capital</span></span>
<span id="cb46-100"><a href="#cb46-100" aria-hidden="true" tabindex="-1"></a><span class="in">colInter = datasetNames[, unlist(str_extract_all(V2, '\\b[A-Z]+[A-Z0-9]\\b'))]</span></span>
<span id="cb46-101"><a href="#cb46-101" aria-hidden="true" tabindex="-1"></a><span class="in">colInter</span></span>
<span id="cb46-102"><a href="#cb46-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-103"><a href="#cb46-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-104"><a href="#cb46-104" aria-hidden="true" tabindex="-1"></a>The problem was that 45 columns were mentioned in the description files (<span class="in">`colInter`</span>), whereas both datasets only have 42 columns. To solve this, I've matched each column with their respective names based on the number of unique "value" by columns and the one exposed in the description file. Using this method, I've found that AGI, FEDTAX, PEARNVAL, PTOTVAL and TAXINC attributes could be removed from the initial column names, and that the attributes YEARS and Y (the attributes to model, *i.e* the income level) should be added.</span>
<span id="cb46-105"><a href="#cb46-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-106"><a href="#cb46-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tbl-right_colnames}</span></span>
<span id="cb46-107"><a href="#cb46-107" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Preview of the dataset"</span></span>
<span id="cb46-108"><a href="#cb46-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-109"><a href="#cb46-109" aria-hidden="true" tabindex="-1"></a><span class="in"># number of instances for each attributes</span></span>
<span id="cb46-110"><a href="#cb46-110" aria-hidden="true" tabindex="-1"></a><span class="in">dataset[, sapply(.SD, function(x){length(unique(x))})]</span></span>
<span id="cb46-111"><a href="#cb46-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-112"><a href="#cb46-112" aria-hidden="true" tabindex="-1"></a><span class="in"># remove unexpected column names</span></span>
<span id="cb46-113"><a href="#cb46-113" aria-hidden="true" tabindex="-1"></a><span class="in">colInter = colInter[-c(which(colInter == "AGI"))]</span></span>
<span id="cb46-114"><a href="#cb46-114" aria-hidden="true" tabindex="-1"></a><span class="in">colInter = colInter[-c(which(colInter == "FEDTAX"))]</span></span>
<span id="cb46-115"><a href="#cb46-115" aria-hidden="true" tabindex="-1"></a><span class="in">colInter = colInter[-c(which(colInter == "PEARNVAL"))]</span></span>
<span id="cb46-116"><a href="#cb46-116" aria-hidden="true" tabindex="-1"></a><span class="in">colInter = colInter[-c(which(colInter == "PTOTVAL"))]</span></span>
<span id="cb46-117"><a href="#cb46-117" aria-hidden="true" tabindex="-1"></a><span class="in">colInter = colInter[-c(which(colInter == "TAXINC"))]</span></span>
<span id="cb46-118"><a href="#cb46-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-119"><a href="#cb46-119" aria-hidden="true" tabindex="-1"></a><span class="in"># add two more column names</span></span>
<span id="cb46-120"><a href="#cb46-120" aria-hidden="true" tabindex="-1"></a><span class="in">colInter = c(colInter, c("YEAR", "Y"))</span></span>
<span id="cb46-121"><a href="#cb46-121" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(dataset) = colInter[1:42]</span></span>
<span id="cb46-122"><a href="#cb46-122" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(validation) = colInter[1:42]</span></span>
<span id="cb46-123"><a href="#cb46-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-124"><a href="#cb46-124" aria-hidden="true" tabindex="-1"></a><span class="in"># dataset preview</span></span>
<span id="cb46-125"><a href="#cb46-125" aria-hidden="true" tabindex="-1"></a><span class="in">datatable(head(validation, 5),  </span></span>
<span id="cb46-126"><a href="#cb46-126" aria-hidden="true" tabindex="-1"></a><span class="in">          extensions = 'FixedColumns', </span></span>
<span id="cb46-127"><a href="#cb46-127" aria-hidden="true" tabindex="-1"></a><span class="in">          options = list(</span></span>
<span id="cb46-128"><a href="#cb46-128" aria-hidden="true" tabindex="-1"></a><span class="in">            dom = "t", </span></span>
<span id="cb46-129"><a href="#cb46-129" aria-hidden="true" tabindex="-1"></a><span class="in">            scrollX = TRUE, </span></span>
<span id="cb46-130"><a href="#cb46-130" aria-hidden="true" tabindex="-1"></a><span class="in">            fixedColumns = FALSE))</span></span>
<span id="cb46-131"><a href="#cb46-131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-132"><a href="#cb46-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-133"><a href="#cb46-133" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summarize Data</span></span>
<span id="cb46-134"><a href="#cb46-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-135"><a href="#cb46-135" aria-hidden="true" tabindex="-1"></a><span class="fu">## Descriptive statistics</span></span>
<span id="cb46-136"><a href="#cb46-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-137"><a href="#cb46-137" aria-hidden="true" tabindex="-1"></a>It is difficult to present all attributes, but a quick summary provides a good overview of the structure.</span>
<span id="cb46-138"><a href="#cb46-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-139"><a href="#cb46-139" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tbl-descriptive_stat}</span></span>
<span id="cb46-140"><a href="#cb46-140" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Structure of the dataset"</span></span>
<span id="cb46-141"><a href="#cb46-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-142"><a href="#cb46-142" aria-hidden="true" tabindex="-1"></a><span class="in"># index of column with characters</span></span>
<span id="cb46-143"><a href="#cb46-143" aria-hidden="true" tabindex="-1"></a><span class="in">ncolCha = which(sapply(dataset, class) == "character")</span></span>
<span id="cb46-144"><a href="#cb46-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-145"><a href="#cb46-145" aria-hidden="true" tabindex="-1"></a><span class="in"># conversion of characters in factors</span></span>
<span id="cb46-146"><a href="#cb46-146" aria-hidden="true" tabindex="-1"></a><span class="in">dataset[, (ncolCha):=lapply(.SD, as.factor), .SDcols = ncolCha]</span></span>
<span id="cb46-147"><a href="#cb46-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-148"><a href="#cb46-148" aria-hidden="true" tabindex="-1"></a><span class="in"># structure of the dataset</span></span>
<span id="cb46-149"><a href="#cb46-149" aria-hidden="true" tabindex="-1"></a><span class="in">kable(data.frame(variable = names(dataset), </span></span>
<span id="cb46-150"><a href="#cb46-150" aria-hidden="true" tabindex="-1"></a><span class="in">                 classe = sapply(dataset, class), </span></span>
<span id="cb46-151"><a href="#cb46-151" aria-hidden="true" tabindex="-1"></a><span class="in">                 first_values = sapply(dataset, function(x) {</span></span>
<span id="cb46-152"><a href="#cb46-152" aria-hidden="true" tabindex="-1"></a><span class="in">                   paste0(head(x), collapse = ", ")}), </span></span>
<span id="cb46-153"><a href="#cb46-153" aria-hidden="true" tabindex="-1"></a><span class="in">                 row.names = NULL))</span></span>
<span id="cb46-154"><a href="#cb46-154" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-155"><a href="#cb46-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-156"><a href="#cb46-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tbl-summary-data}</span></span>
<span id="cb46-157"><a href="#cb46-157" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Summary of the dataset"</span></span>
<span id="cb46-158"><a href="#cb46-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-159"><a href="#cb46-159" aria-hidden="true" tabindex="-1"></a><span class="in"># summary of the dataset</span></span>
<span id="cb46-160"><a href="#cb46-160" aria-hidden="true" tabindex="-1"></a><span class="in">pander(summary(dataset))</span></span>
<span id="cb46-161"><a href="#cb46-161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-162"><a href="#cb46-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-163"><a href="#cb46-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-164"><a href="#cb46-164" aria-hidden="true" tabindex="-1"></a>As mentioned above, a lot of missing values occurred in this dataset, especially for the attributes MIGMTR1, MIGMTR3, MIGMTR4 and MIGSUN.</span>
<span id="cb46-165"><a href="#cb46-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-166"><a href="#cb46-166" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data visualizations</span></span>
<span id="cb46-167"><a href="#cb46-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-168"><a href="#cb46-168" aria-hidden="true" tabindex="-1"></a>Another way to have an idea of the occurrence of missing values is to used data visualization.</span>
<span id="cb46-169"><a href="#cb46-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-170"><a href="#cb46-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-missingValue}</span></span>
<span id="cb46-171"><a href="#cb46-171" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap="Representation of missing values within the learning dataset"</span></span>
<span id="cb46-172"><a href="#cb46-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-173"><a href="#cb46-173" aria-hidden="true" tabindex="-1"></a><span class="in"># build dataPlot</span></span>
<span id="cb46-174"><a href="#cb46-174" aria-hidden="true" tabindex="-1"></a><span class="in">dataPlot = setDT(reshape2::melt(is.na(dataset)))</span></span>
<span id="cb46-175"><a href="#cb46-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-176"><a href="#cb46-176" aria-hidden="true" tabindex="-1"></a><span class="in"># subsample</span></span>
<span id="cb46-177"><a href="#cb46-177" aria-hidden="true" tabindex="-1"></a><span class="in">dataPlot = dataPlot[,.SD[sample(nrow(dataset), 1000)], by=Var2] %&gt;% </span></span>
<span id="cb46-178"><a href="#cb46-178" aria-hidden="true" tabindex="-1"></a><span class="in">  .[, `:=`(id_row, c(1:.N)), by = c("Var2")]</span></span>
<span id="cb46-179"><a href="#cb46-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-180"><a href="#cb46-180" aria-hidden="true" tabindex="-1"></a><span class="in"># missing values</span></span>
<span id="cb46-181"><a href="#cb46-181" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(dataPlot, aes(x = Var2, y = id_row))+</span></span>
<span id="cb46-182"><a href="#cb46-182" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_tile(aes(fill = value))+</span></span>
<span id="cb46-183"><a href="#cb46-183" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(x = "Attributes", y = "Rows")+</span></span>
<span id="cb46-184"><a href="#cb46-184" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c("white", "black"), </span></span>
<span id="cb46-185"><a href="#cb46-185" aria-hidden="true" tabindex="-1"></a><span class="in">                    labels = c("Real", "Missing")) +</span></span>
<span id="cb46-186"><a href="#cb46-186" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top", </span></span>
<span id="cb46-187"><a href="#cb46-187" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_text(angle = 45, hjust = 1), </span></span>
<span id="cb46-188"><a href="#cb46-188" aria-hidden="true" tabindex="-1"></a><span class="in">        legend.key = element_rect(colour = "black"))</span></span>
<span id="cb46-189"><a href="#cb46-189" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-190"><a href="#cb46-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-191"><a href="#cb46-191" aria-hidden="true" tabindex="-1"></a>It also helps for the representation of numerical attributes.</span>
<span id="cb46-192"><a href="#cb46-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-193"><a href="#cb46-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-densityHistogram}</span></span>
<span id="cb46-194"><a href="#cb46-194" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Histogram and density for each of the numerical attributes."</span></span>
<span id="cb46-195"><a href="#cb46-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-196"><a href="#cb46-196" aria-hidden="true" tabindex="-1"></a><span class="in"># numerical attributes index</span></span>
<span id="cb46-197"><a href="#cb46-197" aria-hidden="true" tabindex="-1"></a><span class="in">ncolInt = which(sapply(dataset, class) == "integer")</span></span>
<span id="cb46-198"><a href="#cb46-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-199"><a href="#cb46-199" aria-hidden="true" tabindex="-1"></a><span class="in"># plot for each numerical attributes</span></span>
<span id="cb46-200"><a href="#cb46-200" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(reshape2::melt(dataset[, .SD, .SDcols = c(ncolInt, ncol(dataset))], id.vars = "Y"), </span></span>
<span id="cb46-201"><a href="#cb46-201" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = value, col = Y, fill = Y))+ </span></span>
<span id="cb46-202"><a href="#cb46-202" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(aes(y = ..density..), </span></span>
<span id="cb46-203"><a href="#cb46-203" aria-hidden="true" tabindex="-1"></a><span class="in">                 bins = 10, </span></span>
<span id="cb46-204"><a href="#cb46-204" aria-hidden="true" tabindex="-1"></a><span class="in">                 fill = "white")+</span></span>
<span id="cb46-205"><a href="#cb46-205" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_density(alpha = .2)+</span></span>
<span id="cb46-206"><a href="#cb46-206" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top")+</span></span>
<span id="cb46-207"><a href="#cb46-207" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~variable, scales = "free")</span></span>
<span id="cb46-208"><a href="#cb46-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-209"><a href="#cb46-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-210"><a href="#cb46-210" aria-hidden="true" tabindex="-1"></a>Nothing particularly clear here, except that some attributes do not seem to contain a lot of information (AHRSPAY, CAPGAIN, CAPLOSS, DIVVAL, SEOTR, VETYN, WKSWORK or YEAR). We can also note the attribute "AAGE" has a Gaussian-like distribution a bit shifted, especially for <span class="in">`Y = "- 50000.`</span>, which may require to be transformed. Let's have a look at another representation of this data.</span>
<span id="cb46-211"><a href="#cb46-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-212"><a href="#cb46-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-boxplot}</span></span>
<span id="cb46-213"><a href="#cb46-213" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Boxplot for each of the numerical attributes."</span></span>
<span id="cb46-214"><a href="#cb46-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-215"><a href="#cb46-215" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(reshape2::melt(dataset[, .SD, .SDcols = c(ncolInt, ncol(dataset))], id.vars = "Y"), </span></span>
<span id="cb46-216"><a href="#cb46-216" aria-hidden="true" tabindex="-1"></a><span class="in">       aes(x = "", y = value, col = Y, fill = Y)) + </span></span>
<span id="cb46-217"><a href="#cb46-217" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_boxplot(alpha = .2)+</span></span>
<span id="cb46-218"><a href="#cb46-218" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "top", </span></span>
<span id="cb46-219"><a href="#cb46-219" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.title.x = element_blank(), </span></span>
<span id="cb46-220"><a href="#cb46-220" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.text.x = element_blank(), </span></span>
<span id="cb46-221"><a href="#cb46-221" aria-hidden="true" tabindex="-1"></a><span class="in">        axis.ticks.x = element_blank())+</span></span>
<span id="cb46-222"><a href="#cb46-222" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~variable, scales = "free")</span></span>
<span id="cb46-223"><a href="#cb46-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-224"><a href="#cb46-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-227"><a href="#cb46-227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb46-228"><a href="#cb46-228" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb46-229"><a href="#cb46-229" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb46-230"><a href="#cb46-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-231"><a href="#cb46-231" aria-hidden="true" tabindex="-1"></a><span class="co"># nominal attributes names</span></span>
<span id="cb46-232"><a href="#cb46-232" aria-hidden="true" tabindex="-1"></a>ncolFac <span class="ot">=</span> <span class="fu">names</span>(<span class="fu">which</span>(<span class="fu">sapply</span>(dataset, class) <span class="sc">==</span> <span class="st">"factor"</span>))</span>
<span id="cb46-233"><a href="#cb46-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-234"><a href="#cb46-234" aria-hidden="true" tabindex="-1"></a><span class="co"># plot for each nominal attributes</span></span>
<span id="cb46-235"><a href="#cb46-235" aria-hidden="true" tabindex="-1"></a>dataPlot<span class="ot">=</span><span class="fu">lapply</span>(ncolFac[<span class="sc">-</span><span class="fu">c</span>(<span class="fu">length</span>(ncolFac))], <span class="cf">function</span>(x){</span>
<span id="cb46-236"><a href="#cb46-236" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">=</span> dataset[, <span class="fu">levels</span>(<span class="fu">get</span>(x)), by <span class="ot">=</span> Y]</span>
<span id="cb46-237"><a href="#cb46-237" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">=</span> dataset[, <span class="fu">table</span>(<span class="fu">get</span>(x)), by <span class="ot">=</span> Y] <span class="sc">%&gt;%</span> </span>
<span id="cb46-238"><a href="#cb46-238" aria-hidden="true" tabindex="-1"></a>    .[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">V1 =</span> <span class="fu">as.integer</span>(V1), </span>
<span id="cb46-239"><a href="#cb46-239" aria-hidden="true" tabindex="-1"></a>             <span class="at">levels =</span> <span class="fu">as.factor</span>(A<span class="sc">$</span>V1))]</span>
<span id="cb46-240"><a href="#cb46-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(B, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(levels), <span class="at">y =</span> V1, <span class="at">fill =</span> Y))<span class="sc">+</span></span>
<span id="cb46-241"><a href="#cb46-241" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>, </span>
<span id="cb46-242"><a href="#cb46-242" aria-hidden="true" tabindex="-1"></a>             <span class="at">position=</span><span class="fu">position_dodge</span>())<span class="sc">+</span></span>
<span id="cb46-243"><a href="#cb46-243" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">x =</span> <span class="st">""</span>, <span class="at">title =</span> x)<span class="sc">+</span></span>
<span id="cb46-244"><a href="#cb46-244" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb46-245"><a href="#cb46-245" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb46-246"><a href="#cb46-246" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb46-247"><a href="#cb46-247" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb46-248"><a href="#cb46-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-249"><a href="#cb46-249" aria-hidden="true" tabindex="-1"></a><span class="co"># print of the two first plot</span></span>
<span id="cb46-250"><a href="#cb46-250" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(<span class="at">grobs=</span><span class="fu">list</span>(dataPlot[[<span class="dv">1</span>]], dataPlot[[<span class="dv">2</span>]]), <span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb46-251"><a href="#cb46-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-252"><a href="#cb46-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-253"><a href="#cb46-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-nominalAttributes}</span></span>
<span id="cb46-254"><a href="#cb46-254" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb46-255"><a href="#cb46-255" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Barplot for each of the nominal attributes."</span></span>
<span id="cb46-256"><a href="#cb46-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-257"><a href="#cb46-257" aria-hidden="true" tabindex="-1"></a><span class="in">dataset[, (ncolCha):=lapply(.SD, as.factor), .SDcols=ncolCha]</span></span>
<span id="cb46-258"><a href="#cb46-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-259"><a href="#cb46-259" aria-hidden="true" tabindex="-1"></a><span class="in"># nominal attributes names</span></span>
<span id="cb46-260"><a href="#cb46-260" aria-hidden="true" tabindex="-1"></a><span class="in">ncolFac = names(which(sapply(dataset, class) == "factor"))</span></span>
<span id="cb46-261"><a href="#cb46-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-262"><a href="#cb46-262" aria-hidden="true" tabindex="-1"></a><span class="in"># plot for each attributes</span></span>
<span id="cb46-263"><a href="#cb46-263" aria-hidden="true" tabindex="-1"></a><span class="in">dataPlot=lapply(ncolFac[-c(length(ncolFac))], function(x){</span></span>
<span id="cb46-264"><a href="#cb46-264" aria-hidden="true" tabindex="-1"></a><span class="in">  A = dataset[, levels(get(x)), by=Y]</span></span>
<span id="cb46-265"><a href="#cb46-265" aria-hidden="true" tabindex="-1"></a><span class="in">  B = dataset[, table(get(x)), by=Y] %&gt;% </span></span>
<span id="cb46-266"><a href="#cb46-266" aria-hidden="true" tabindex="-1"></a><span class="in">    .[, `:=`(V1 = as.integer(V1), </span></span>
<span id="cb46-267"><a href="#cb46-267" aria-hidden="true" tabindex="-1"></a><span class="in">             levels = as.factor(A$V1))]</span></span>
<span id="cb46-268"><a href="#cb46-268" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(B, aes(x = as.factor(levels), y = V1, fill=Y))+</span></span>
<span id="cb46-269"><a href="#cb46-269" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(stat="identity", </span></span>
<span id="cb46-270"><a href="#cb46-270" aria-hidden="true" tabindex="-1"></a><span class="in">             position=position_dodge())+</span></span>
<span id="cb46-271"><a href="#cb46-271" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(y = "Count", x = "", title = x)+</span></span>
<span id="cb46-272"><a href="#cb46-272" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.justification = c(0, 1), </span></span>
<span id="cb46-273"><a href="#cb46-273" aria-hidden="true" tabindex="-1"></a><span class="in">          legend.position = c(0, 1), </span></span>
<span id="cb46-274"><a href="#cb46-274" aria-hidden="true" tabindex="-1"></a><span class="in">          axis.text.x = element_text(angle = 45, hjust = 1))</span></span>
<span id="cb46-275"><a href="#cb46-275" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb46-276"><a href="#cb46-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-277"><a href="#cb46-277" aria-hidden="true" tabindex="-1"></a><span class="in"># print of the two first plot</span></span>
<span id="cb46-278"><a href="#cb46-278" aria-hidden="true" tabindex="-1"></a><span class="in">grid.arrange(grobs=list(dataPlot[[1]], dataPlot[[2]]), ncol=2)</span></span>
<span id="cb46-279"><a href="#cb46-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-280"><a href="#cb46-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-281"><a href="#cb46-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r just_comment}</span></span>
<span id="cb46-282"><a href="#cb46-282" aria-hidden="true" tabindex="-1"></a><span class="in"># another way to it, which appears not working using Rmarkdown document</span></span>
<span id="cb46-283"><a href="#cb46-283" aria-hidden="true" tabindex="-1"></a><span class="in"># grid.arrange(grobs=dataPlot, ncol=2)</span></span>
<span id="cb46-284"><a href="#cb46-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-285"><a href="#cb46-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-286"><a href="#cb46-286" aria-hidden="true" tabindex="-1"></a><span class="fu"># Prepare Data</span></span>
<span id="cb46-287"><a href="#cb46-287" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Cleaning {#dataCleaning}</span></span>
<span id="cb46-288"><a href="#cb46-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-289"><a href="#cb46-289" aria-hidden="true" tabindex="-1"></a>When looking at @fig-missingValue, it appears that a lot of missing values occurred within the learning dataset. Here, I've taken the liberty to "simply" removed these values. Another way to deal with missing values would have been to use an imputation method, such as the <span class="co">[</span><span class="ot">K-nearest neighbors method</span><span class="co">](https://topepo.github.io/caret/pre-processing.html#imputation)</span> <span class="ot">[^1]</span> provided by the package <span class="in">`caret`</span> (code commented below). Because this method requires high computational costs, I've preferred to stick to the first method, even if, as we'll see in the next steps, it means the final model won't be able to predict <span class="in">`Y`</span> in some cases.</span>
<span id="cb46-290"><a href="#cb46-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-291"><a href="#cb46-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r removal_NA}</span></span>
<span id="cb46-292"><a href="#cb46-292" aria-hidden="true" tabindex="-1"></a><span class="in"># removal of missing values</span></span>
<span id="cb46-293"><a href="#cb46-293" aria-hidden="true" tabindex="-1"></a><span class="in">datasetNa = na.omit(dataset)</span></span>
<span id="cb46-294"><a href="#cb46-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-295"><a href="#cb46-295" aria-hidden="true" tabindex="-1"></a><span class="in">## or we could have done something like this:</span></span>
<span id="cb46-296"><a href="#cb46-296" aria-hidden="true" tabindex="-1"></a><span class="in"># preProcValues = preProcess(dataset, method = c("knnImpute"))</span></span>
<span id="cb46-297"><a href="#cb46-297" aria-hidden="true" tabindex="-1"></a><span class="in"># dataset.imp = predict(preProcValues, dataset)</span></span>
<span id="cb46-298"><a href="#cb46-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-299"><a href="#cb46-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-300"><a href="#cb46-300" aria-hidden="true" tabindex="-1"></a><span class="ot">[^1]: </span>Another method is implemented based on bagged trees but at higher computational costs.</span>
<span id="cb46-301"><a href="#cb46-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-302"><a href="#cb46-302" aria-hidden="true" tabindex="-1"></a><span class="fu">## Feature Selection</span></span>
<span id="cb46-303"><a href="#cb46-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-304"><a href="#cb46-304" aria-hidden="true" tabindex="-1"></a>As a first step to feature selection, I've decided to remove any attributes with a zero or near zero variance. For many models, this may cause the model to crash or the fit to be unstable.</span>
<span id="cb46-305"><a href="#cb46-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-306"><a href="#cb46-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r nzv}</span></span>
<span id="cb46-307"><a href="#cb46-307" aria-hidden="true" tabindex="-1"></a><span class="in"># identification of near zero variance attributes</span></span>
<span id="cb46-308"><a href="#cb46-308" aria-hidden="true" tabindex="-1"></a><span class="in">nzv = nearZeroVar(datasetNa, saveMetrics = TRUE)</span></span>
<span id="cb46-309"><a href="#cb46-309" aria-hidden="true" tabindex="-1"></a><span class="in">datatable(nzv[nzv$nzv, ],</span></span>
<span id="cb46-310"><a href="#cb46-310" aria-hidden="true" tabindex="-1"></a><span class="in">          caption = "Information relative to zero and near zero variance predictors.",</span></span>
<span id="cb46-311"><a href="#cb46-311" aria-hidden="true" tabindex="-1"></a><span class="in">          option = list(dom = "t"))</span></span>
<span id="cb46-312"><a href="#cb46-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-313"><a href="#cb46-313" aria-hidden="true" tabindex="-1"></a><span class="in"># removal of these predictors</span></span>
<span id="cb46-314"><a href="#cb46-314" aria-hidden="true" tabindex="-1"></a><span class="in">datasetNaNzv = datasetNa[, .SD, .SDcols = !nzv$nzv]</span></span>
<span id="cb46-315"><a href="#cb46-315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-316"><a href="#cb46-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-317"><a href="#cb46-317" aria-hidden="true" tabindex="-1"></a>The second step was to remove any attributes with a correlation higher than 0.75. This is a basic method, which could be improved by combining correlogram with significance test.</span>
<span id="cb46-318"><a href="#cb46-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-319"><a href="#cb46-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-correlation}</span></span>
<span id="cb46-320"><a href="#cb46-320" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Correlogram of dataset."</span></span>
<span id="cb46-321"><a href="#cb46-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-322"><a href="#cb46-322" aria-hidden="true" tabindex="-1"></a><span class="in"># matrix correlation</span></span>
<span id="cb46-323"><a href="#cb46-323" aria-hidden="true" tabindex="-1"></a><span class="in">ncolInt = which(sapply(datasetNaNzv, class) == "integer")</span></span>
<span id="cb46-324"><a href="#cb46-324" aria-hidden="true" tabindex="-1"></a><span class="in">descrCor = cor(datasetNaNzv[, .SD, .SDcols = ncolInt])</span></span>
<span id="cb46-325"><a href="#cb46-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-326"><a href="#cb46-326" aria-hidden="true" tabindex="-1"></a><span class="in"># which attributes will be removed based on matrix correlation</span></span>
<span id="cb46-327"><a href="#cb46-327" aria-hidden="true" tabindex="-1"></a><span class="in">corrplot(descrCor, method = "pie")</span></span>
<span id="cb46-328"><a href="#cb46-328" aria-hidden="true" tabindex="-1"></a><span class="in">highlyCorDescr = findCorrelation(descrCor, cutoff = .75)</span></span>
<span id="cb46-329"><a href="#cb46-329" aria-hidden="true" tabindex="-1"></a><span class="in">names(ncolInt[highlyCorDescr])</span></span>
<span id="cb46-330"><a href="#cb46-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-331"><a href="#cb46-331" aria-hidden="true" tabindex="-1"></a><span class="in"># attribute "WKSWORK" removed</span></span>
<span id="cb46-332"><a href="#cb46-332" aria-hidden="true" tabindex="-1"></a><span class="in">datasetNaNzv[, (names(ncolInt[highlyCorDescr])):= NULL]</span></span>
<span id="cb46-333"><a href="#cb46-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-334"><a href="#cb46-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-335"><a href="#cb46-335" aria-hidden="true" tabindex="-1"></a>Here, I've only removed the attribute "WKSWORK". At the end of the "Feature selection" step, the current dataset includes <span class="in">`r dim(datasetNaNzv)[2]`</span> attributes instead of <span class="in">`r dim(dataset)[2]`</span> in the original one.</span>
<span id="cb46-336"><a href="#cb46-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-337"><a href="#cb46-337" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Transforms</span></span>
<span id="cb46-338"><a href="#cb46-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-339"><a href="#cb46-339" aria-hidden="true" tabindex="-1"></a><span class="fu">### Yeo-Johnson transform</span></span>
<span id="cb46-340"><a href="#cb46-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-341"><a href="#cb46-341" aria-hidden="true" tabindex="-1"></a>I've used the Yeo-Johnson transform, since the attributes "AAGE", *i.e* the age of the people in this dataset, has a Gaussian-like distribution with a skew (@fig-densityHistogram). To make it "more Gaussian", I've simply performed a <span class="in">`YeoJohnson`</span> transform; I would have normally performed a <span class="in">`BoxCox`</span> transform, but it does not support raw values that are equal to zero.</span>
<span id="cb46-342"><a href="#cb46-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-343"><a href="#cb46-343" aria-hidden="true" tabindex="-1"></a><span class="in">```{r yeojohnson}</span></span>
<span id="cb46-344"><a href="#cb46-344" aria-hidden="true" tabindex="-1"></a><span class="in"># calculate the pre-process parameters from the dataset</span></span>
<span id="cb46-345"><a href="#cb46-345" aria-hidden="true" tabindex="-1"></a><span class="in">preprocessParams = preProcess(datasetNaNzv[, "AAGE"], method=c("YeoJohnson"))</span></span>
<span id="cb46-346"><a href="#cb46-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-347"><a href="#cb46-347" aria-hidden="true" tabindex="-1"></a><span class="in"># transform the dataset using the parameters</span></span>
<span id="cb46-348"><a href="#cb46-348" aria-hidden="true" tabindex="-1"></a><span class="in">datasetNaNzv$AAGE=predict(preprocessParams, datasetNaNzv[, "AAGE"])</span></span>
<span id="cb46-349"><a href="#cb46-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-350"><a href="#cb46-350" aria-hidden="true" tabindex="-1"></a><span class="fu">### One-Hot encoding</span></span>
<span id="cb46-351"><a href="#cb46-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-352"><a href="#cb46-352" aria-hidden="true" tabindex="-1"></a>As we'll see in <span class="co">[</span><span class="ot">the next steps</span><span class="co">](#CompareAlgorithm)</span>, one-hot encoding was not really necessary for both algorithms tested hereafter. However, it may be a good way to improve computational costs for many algorithms that do not perform well, when dealing with nominal attributes.</span>
<span id="cb46-353"><a href="#cb46-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-354"><a href="#cb46-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r hot_encoding}</span></span>
<span id="cb46-355"><a href="#cb46-355" aria-hidden="true" tabindex="-1"></a><span class="in"># one-hot encoding</span></span>
<span id="cb46-356"><a href="#cb46-356" aria-hidden="true" tabindex="-1"></a><span class="in">dummies = dummyVars(Y~., data = datasetNaNzv)</span></span>
<span id="cb46-357"><a href="#cb46-357" aria-hidden="true" tabindex="-1"></a><span class="in">matDummies = predict(dummies, newdata = datasetNaNzv)</span></span>
<span id="cb46-358"><a href="#cb46-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-359"><a href="#cb46-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-360"><a href="#cb46-360" aria-hidden="true" tabindex="-1"></a>As a consequence, some columns might appear to be a linear combination of others. To ensure the non-redundancy of information, I've removed these rows.</span>
<span id="cb46-361"><a href="#cb46-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-362"><a href="#cb46-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r linear_combination}</span></span>
<span id="cb46-363"><a href="#cb46-363" aria-hidden="true" tabindex="-1"></a><span class="in"># remove linear combination</span></span>
<span id="cb46-364"><a href="#cb46-364" aria-hidden="true" tabindex="-1"></a><span class="in">comboInfo = findLinearCombos(matDummies)</span></span>
<span id="cb46-365"><a href="#cb46-365" aria-hidden="true" tabindex="-1"></a><span class="in">datasetNaNzvQr = as.data.table(matDummies[, -comboInfo$remove])</span></span>
<span id="cb46-366"><a href="#cb46-366" aria-hidden="true" tabindex="-1"></a><span class="in">datasetNaNzvQr[, Y:=datasetNaNzv[, Y]]</span></span>
<span id="cb46-367"><a href="#cb46-367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-368"><a href="#cb46-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-369"><a href="#cb46-369" aria-hidden="true" tabindex="-1"></a><span class="fu">## Split-out validation dataset</span></span>
<span id="cb46-370"><a href="#cb46-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-371"><a href="#cb46-371" aria-hidden="true" tabindex="-1"></a>I know you provided a "test file", but the learning dataset is large enough to be split in a learning dataset and a validation dataset by itself. Moreover, my computer is not powerful enough to run models on the whole learning dataset, so I've split the learning dataset with 10\% of the data for the training process and the other 90\% for testing (with a powerful enough computers, I would split the dataset using 80\% of the data for the learning step and the other 20\% for the evaluation). In the <span class="co">[</span><span class="ot">last step</span><span class="co">](#prediction)</span>, I'll evaluate the chosen model on the provided "test file".</span>
<span id="cb46-372"><a href="#cb46-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-373"><a href="#cb46-373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r split_out}</span></span>
<span id="cb46-374"><a href="#cb46-374" aria-hidden="true" tabindex="-1"></a><span class="in"># identification of indexes for splitting</span></span>
<span id="cb46-375"><a href="#cb46-375" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-376"><a href="#cb46-376" aria-hidden="true" tabindex="-1"></a><span class="in">trainIndex = createDataPartition(datasetNaNzvQr$Y,</span></span>
<span id="cb46-377"><a href="#cb46-377" aria-hidden="true" tabindex="-1"></a><span class="in">                                 p = .1,</span></span>
<span id="cb46-378"><a href="#cb46-378" aria-hidden="true" tabindex="-1"></a><span class="in">                                 list = FALSE,</span></span>
<span id="cb46-379"><a href="#cb46-379" aria-hidden="true" tabindex="-1"></a><span class="in">                                 times = 1)</span></span>
<span id="cb46-380"><a href="#cb46-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-381"><a href="#cb46-381" aria-hidden="true" tabindex="-1"></a><span class="in"># split</span></span>
<span id="cb46-382"><a href="#cb46-382" aria-hidden="true" tabindex="-1"></a><span class="in">datasetNaNzvQr[, Y:=as.factor(make.names(Y))]</span></span>
<span id="cb46-383"><a href="#cb46-383" aria-hidden="true" tabindex="-1"></a><span class="in">dataTrain = datasetNaNzvQr[trainIndex, ]</span></span>
<span id="cb46-384"><a href="#cb46-384" aria-hidden="true" tabindex="-1"></a><span class="in">dataTest = datasetNaNzvQr[-trainIndex, ]</span></span>
<span id="cb46-385"><a href="#cb46-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-386"><a href="#cb46-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-387"><a href="#cb46-387" aria-hidden="true" tabindex="-1"></a><span class="fu"># Evaluate Algorithms</span></span>
<span id="cb46-388"><a href="#cb46-388" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test options and evaluation metric</span></span>
<span id="cb46-389"><a href="#cb46-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-390"><a href="#cb46-390" aria-hidden="true" tabindex="-1"></a>Here I've chosen to cross-validate the model using 5 folds repeated twice. As explained before, with a powerful enough computer I would encourage increasing these values. Because the problem to solve is a classification problem, the metric used to select the optimal model is the "Accuracy", except for the <span class="co">[</span><span class="ot">"Stacking"</span><span class="co">](#stacking)</span> part, where the area under the ROC curve was used.</span>
<span id="cb46-391"><a href="#cb46-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-392"><a href="#cb46-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r options}</span></span>
<span id="cb46-393"><a href="#cb46-393" aria-hidden="true" tabindex="-1"></a><span class="in"># cross-validation</span></span>
<span id="cb46-394"><a href="#cb46-394" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-395"><a href="#cb46-395" aria-hidden="true" tabindex="-1"></a><span class="in">trainControl = trainControl(method = "repeatedcv",</span></span>
<span id="cb46-396"><a href="#cb46-396" aria-hidden="true" tabindex="-1"></a><span class="in">                            number = 5,</span></span>
<span id="cb46-397"><a href="#cb46-397" aria-hidden="true" tabindex="-1"></a><span class="in">                            repeats = 2,</span></span>
<span id="cb46-398"><a href="#cb46-398" aria-hidden="true" tabindex="-1"></a><span class="in">                            savePredictions = "final", # required for stacking</span></span>
<span id="cb46-399"><a href="#cb46-399" aria-hidden="true" tabindex="-1"></a><span class="in">                            classProbs = TRUE)         # required for stacking</span></span>
<span id="cb46-400"><a href="#cb46-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-401"><a href="#cb46-401" aria-hidden="true" tabindex="-1"></a><span class="in"># metric evaluation</span></span>
<span id="cb46-402"><a href="#cb46-402" aria-hidden="true" tabindex="-1"></a><span class="in">metric = "Accuracy"</span></span>
<span id="cb46-403"><a href="#cb46-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-404"><a href="#cb46-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-405"><a href="#cb46-405" aria-hidden="true" tabindex="-1"></a><span class="fu">## Spot Check Algorithms</span></span>
<span id="cb46-406"><a href="#cb46-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-407"><a href="#cb46-407" aria-hidden="true" tabindex="-1"></a>Because the dataset is strongly imbalance...</span>
<span id="cb46-408"><a href="#cb46-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-409"><a href="#cb46-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tbl-propImbalance}</span></span>
<span id="cb46-410"><a href="#cb46-410" aria-hidden="true" tabindex="-1"></a><span class="in">#| tbl-cap: "Proportion of each levels of the explaining variable."</span></span>
<span id="cb46-411"><a href="#cb46-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-412"><a href="#cb46-412" aria-hidden="true" tabindex="-1"></a><span class="in"># proportion of each levels of Y</span></span>
<span id="cb46-413"><a href="#cb46-413" aria-hidden="true" tabindex="-1"></a><span class="in">datatable(data.table(</span></span>
<span id="cb46-414"><a href="#cb46-414" aria-hidden="true" tabindex="-1"></a><span class="in">  freq = table(datasetNaNzvQr$Y),</span></span>
<span id="cb46-415"><a href="#cb46-415" aria-hidden="true" tabindex="-1"></a><span class="in">  percentage = round(prop.table(table(datasetNaNzvQr$Y))*100, 2)),</span></span>
<span id="cb46-416"><a href="#cb46-416" aria-hidden="true" tabindex="-1"></a><span class="in">  option = list(dom = "t"))</span></span>
<span id="cb46-417"><a href="#cb46-417" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-418"><a href="#cb46-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-419"><a href="#cb46-419" aria-hidden="true" tabindex="-1"></a>... it can have significant negative impact on model fitting (by the way, it seems consistent that a large proportion of these people earn less than 50 000$ pear annum). Here I've explored two different ways to deal with it:</span>
<span id="cb46-420"><a href="#cb46-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-421"><a href="#cb46-421" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>*down-sampling*: randomly subset all the classes in the training set so that their class frequencies match the least prevalent class.</span>
<span id="cb46-422"><a href="#cb46-422" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>*up-sampling*: randomly sample (with replacement) the minority class to be the same size as the majority class.</span>
<span id="cb46-423"><a href="#cb46-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-424"><a href="#cb46-424" aria-hidden="true" tabindex="-1"></a>In addition, I've tested two different algorithms, the **Logistic Regression**, and **k-Nearest Neighbors**.</span>
<span id="cb46-425"><a href="#cb46-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-426"><a href="#cb46-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r modelDownUp}</span></span>
<span id="cb46-427"><a href="#cb46-427" aria-hidden="true" tabindex="-1"></a><span class="in"># down-sampling</span></span>
<span id="cb46-428"><a href="#cb46-428" aria-hidden="true" tabindex="-1"></a><span class="in">trainControl$sampling = "down"</span></span>
<span id="cb46-429"><a href="#cb46-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-430"><a href="#cb46-430" aria-hidden="true" tabindex="-1"></a><span class="in"># logistic regression</span></span>
<span id="cb46-431"><a href="#cb46-431" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-432"><a href="#cb46-432" aria-hidden="true" tabindex="-1"></a><span class="in">fitLogDown = train(Y~., data = dataTrain,</span></span>
<span id="cb46-433"><a href="#cb46-433" aria-hidden="true" tabindex="-1"></a><span class="in">                   method = "glm",</span></span>
<span id="cb46-434"><a href="#cb46-434" aria-hidden="true" tabindex="-1"></a><span class="in">                   family = "binomial",</span></span>
<span id="cb46-435"><a href="#cb46-435" aria-hidden="true" tabindex="-1"></a><span class="in">                   metric = metric,</span></span>
<span id="cb46-436"><a href="#cb46-436" aria-hidden="true" tabindex="-1"></a><span class="in">                   trControl = trainControl)</span></span>
<span id="cb46-437"><a href="#cb46-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-438"><a href="#cb46-438" aria-hidden="true" tabindex="-1"></a><span class="in"># KNN</span></span>
<span id="cb46-439"><a href="#cb46-439" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-440"><a href="#cb46-440" aria-hidden="true" tabindex="-1"></a><span class="in">fitKnnDown = train(Y~., data = dataTrain,</span></span>
<span id="cb46-441"><a href="#cb46-441" aria-hidden="true" tabindex="-1"></a><span class="in">                   method = "knn",</span></span>
<span id="cb46-442"><a href="#cb46-442" aria-hidden="true" tabindex="-1"></a><span class="in">                   metric = metric,</span></span>
<span id="cb46-443"><a href="#cb46-443" aria-hidden="true" tabindex="-1"></a><span class="in">                   trControl = trainControl)</span></span>
<span id="cb46-444"><a href="#cb46-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-445"><a href="#cb46-445" aria-hidden="true" tabindex="-1"></a><span class="in"># up-sampling</span></span>
<span id="cb46-446"><a href="#cb46-446" aria-hidden="true" tabindex="-1"></a><span class="in">trainControl$sampling = "up"</span></span>
<span id="cb46-447"><a href="#cb46-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-448"><a href="#cb46-448" aria-hidden="true" tabindex="-1"></a><span class="in"># logistic regression</span></span>
<span id="cb46-449"><a href="#cb46-449" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-450"><a href="#cb46-450" aria-hidden="true" tabindex="-1"></a><span class="in">fitLogUp = train(Y~., data = dataTrain,</span></span>
<span id="cb46-451"><a href="#cb46-451" aria-hidden="true" tabindex="-1"></a><span class="in">                 method = "glm",</span></span>
<span id="cb46-452"><a href="#cb46-452" aria-hidden="true" tabindex="-1"></a><span class="in">                 family = "binomial",</span></span>
<span id="cb46-453"><a href="#cb46-453" aria-hidden="true" tabindex="-1"></a><span class="in">                 metric = metric,</span></span>
<span id="cb46-454"><a href="#cb46-454" aria-hidden="true" tabindex="-1"></a><span class="in">                 trControl = trainControl)</span></span>
<span id="cb46-455"><a href="#cb46-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-456"><a href="#cb46-456" aria-hidden="true" tabindex="-1"></a><span class="in"># KNN</span></span>
<span id="cb46-457"><a href="#cb46-457" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-458"><a href="#cb46-458" aria-hidden="true" tabindex="-1"></a><span class="in">fitKnnUp = train(Y~., data = dataTrain,</span></span>
<span id="cb46-459"><a href="#cb46-459" aria-hidden="true" tabindex="-1"></a><span class="in">                 method = "knn",</span></span>
<span id="cb46-460"><a href="#cb46-460" aria-hidden="true" tabindex="-1"></a><span class="in">                 metric = metric,</span></span>
<span id="cb46-461"><a href="#cb46-461" aria-hidden="true" tabindex="-1"></a><span class="in">                 trControl = trainControl)</span></span>
<span id="cb46-462"><a href="#cb46-462" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-463"><a href="#cb46-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-464"><a href="#cb46-464" aria-hidden="true" tabindex="-1"></a><span class="fu">## Compare Algorithms {#CompareAlgorithm}</span></span>
<span id="cb46-465"><a href="#cb46-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-466"><a href="#cb46-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r compare1_models}</span></span>
<span id="cb46-467"><a href="#cb46-467" aria-hidden="true" tabindex="-1"></a><span class="in"># resample</span></span>
<span id="cb46-468"><a href="#cb46-468" aria-hidden="true" tabindex="-1"></a><span class="in">results = resamples(list(KNN_UP = fitKnnUp,</span></span>
<span id="cb46-469"><a href="#cb46-469" aria-hidden="true" tabindex="-1"></a><span class="in">                         LOG_UP = fitLogUp,</span></span>
<span id="cb46-470"><a href="#cb46-470" aria-hidden="true" tabindex="-1"></a><span class="in">                         KNN_DOWN = fitKnnDown,</span></span>
<span id="cb46-471"><a href="#cb46-471" aria-hidden="true" tabindex="-1"></a><span class="in">                         LOG_DOWN = fitLogDown))</span></span>
<span id="cb46-472"><a href="#cb46-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-473"><a href="#cb46-473" aria-hidden="true" tabindex="-1"></a><span class="in"># summary</span></span>
<span id="cb46-474"><a href="#cb46-474" aria-hidden="true" tabindex="-1"></a><span class="in">summary(results)</span></span>
<span id="cb46-475"><a href="#cb46-475" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-476"><a href="#cb46-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-477"><a href="#cb46-477" aria-hidden="true" tabindex="-1"></a>It appears the *up-sampling* method performs better than the *down-sampling*. In addition, the **k-Nearest Neighbors** algorithm provides better results than the **Logistic Regression** one. Let's now compare both algorithms using the *up-sampling* method with a dataset including nominal attributes (*i.e.* not using one-hot encoding).</span>
<span id="cb46-478"><a href="#cb46-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-479"><a href="#cb46-479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model_var}</span></span>
<span id="cb46-480"><a href="#cb46-480" aria-hidden="true" tabindex="-1"></a><span class="in"># new data split based on the dataset without hot encoding</span></span>
<span id="cb46-481"><a href="#cb46-481" aria-hidden="true" tabindex="-1"></a><span class="in">datasetNaNzv[, Y:=as.factor(make.names(Y))]</span></span>
<span id="cb46-482"><a href="#cb46-482" aria-hidden="true" tabindex="-1"></a><span class="in">dataTrainVar = datasetNaNzv[trainIndex, ]</span></span>
<span id="cb46-483"><a href="#cb46-483" aria-hidden="true" tabindex="-1"></a><span class="in">dataTestVar = datasetNaNzv[-trainIndex, ]</span></span>
<span id="cb46-484"><a href="#cb46-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-485"><a href="#cb46-485" aria-hidden="true" tabindex="-1"></a><span class="in"># logistic regression</span></span>
<span id="cb46-486"><a href="#cb46-486" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-487"><a href="#cb46-487" aria-hidden="true" tabindex="-1"></a><span class="in">fitLogUpVar = train(Y~., data = dataTrainVar,</span></span>
<span id="cb46-488"><a href="#cb46-488" aria-hidden="true" tabindex="-1"></a><span class="in">                    method = "glm",</span></span>
<span id="cb46-489"><a href="#cb46-489" aria-hidden="true" tabindex="-1"></a><span class="in">                    family = "binomial",</span></span>
<span id="cb46-490"><a href="#cb46-490" aria-hidden="true" tabindex="-1"></a><span class="in">                    metric = metric,</span></span>
<span id="cb46-491"><a href="#cb46-491" aria-hidden="true" tabindex="-1"></a><span class="in">                    trControl = trainControl)</span></span>
<span id="cb46-492"><a href="#cb46-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-493"><a href="#cb46-493" aria-hidden="true" tabindex="-1"></a><span class="in"># KNN</span></span>
<span id="cb46-494"><a href="#cb46-494" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-495"><a href="#cb46-495" aria-hidden="true" tabindex="-1"></a><span class="in">fitKnnUpVar = train(Y~., data = dataTrainVar,</span></span>
<span id="cb46-496"><a href="#cb46-496" aria-hidden="true" tabindex="-1"></a><span class="in">                    method = "knn",</span></span>
<span id="cb46-497"><a href="#cb46-497" aria-hidden="true" tabindex="-1"></a><span class="in">                    metric = metric,</span></span>
<span id="cb46-498"><a href="#cb46-498" aria-hidden="true" tabindex="-1"></a><span class="in">                    trControl = trainControl)</span></span>
<span id="cb46-499"><a href="#cb46-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-500"><a href="#cb46-500" aria-hidden="true" tabindex="-1"></a><span class="in"># resample</span></span>
<span id="cb46-501"><a href="#cb46-501" aria-hidden="true" tabindex="-1"></a><span class="in">results = resamples(list(KNN_UP = fitKnnUp,</span></span>
<span id="cb46-502"><a href="#cb46-502" aria-hidden="true" tabindex="-1"></a><span class="in">                         LOG_UP = fitLogUp,</span></span>
<span id="cb46-503"><a href="#cb46-503" aria-hidden="true" tabindex="-1"></a><span class="in">                         KNN_DOWN = fitKnnDown,</span></span>
<span id="cb46-504"><a href="#cb46-504" aria-hidden="true" tabindex="-1"></a><span class="in">                         LOG_DOWN = fitLogDown,</span></span>
<span id="cb46-505"><a href="#cb46-505" aria-hidden="true" tabindex="-1"></a><span class="in">                         KNN_UP_VAR = fitKnnUpVar,</span></span>
<span id="cb46-506"><a href="#cb46-506" aria-hidden="true" tabindex="-1"></a><span class="in">                         LOG_UP_VAR = fitLogUpVar))</span></span>
<span id="cb46-507"><a href="#cb46-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-508"><a href="#cb46-508" aria-hidden="true" tabindex="-1"></a><span class="in"># summary</span></span>
<span id="cb46-509"><a href="#cb46-509" aria-hidden="true" tabindex="-1"></a><span class="in">summary(results)</span></span>
<span id="cb46-510"><a href="#cb46-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-511"><a href="#cb46-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-512"><a href="#cb46-512" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-dotplot}</span></span>
<span id="cb46-513"><a href="#cb46-513" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Models comparison."</span></span>
<span id="cb46-514"><a href="#cb46-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-515"><a href="#cb46-515" aria-hidden="true" tabindex="-1"></a><span class="in">dotplot(results)</span></span>
<span id="cb46-516"><a href="#cb46-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-517"><a href="#cb46-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-518"><a href="#cb46-518" aria-hidden="true" tabindex="-1"></a>Using direct nominal attributes instead of one-hot encoding provides better results (*i.e.* higher accuracy) for the **Logistic Regression**, which is not the case for **k-Nearest Neighbors** algorithm, which provides the same accuracy.</span>
<span id="cb46-519"><a href="#cb46-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-520"><a href="#cb46-520" aria-hidden="true" tabindex="-1"></a><span class="fu"># Improve Accuracy</span></span>
<span id="cb46-521"><a href="#cb46-521" aria-hidden="true" tabindex="-1"></a><span class="fu">## Algorithm Tuning</span></span>
<span id="cb46-522"><a href="#cb46-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-523"><a href="#cb46-523" aria-hidden="true" tabindex="-1"></a>Depending on the algorithm to chose, we can improve the accuracy by choosing the appropriate set of parameters. Below, you'll find a recipe to find the optimal number of neighbors to set when using a **k-Nearest Neighbors** algorithm. Due to high computational cost, I did not run this code.</span>
<span id="cb46-524"><a href="#cb46-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-525"><a href="#cb46-525" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model_tuning}</span></span>
<span id="cb46-526"><a href="#cb46-526" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: true</span></span>
<span id="cb46-527"><a href="#cb46-527" aria-hidden="true" tabindex="-1"></a><span class="in">#| eval: false</span></span>
<span id="cb46-528"><a href="#cb46-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-529"><a href="#cb46-529" aria-hidden="true" tabindex="-1"></a><span class="in"># search for the optimal number of neighbors K (did not run)</span></span>
<span id="cb46-530"><a href="#cb46-530" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-531"><a href="#cb46-531" aria-hidden="true" tabindex="-1"></a><span class="in">grid = expand.grid(.k = seq(1, 20, by = 1))</span></span>
<span id="cb46-532"><a href="#cb46-532" aria-hidden="true" tabindex="-1"></a><span class="in">fitKnnUpVar = train(Y~., data=dataTrainVar,</span></span>
<span id="cb46-533"><a href="#cb46-533" aria-hidden="true" tabindex="-1"></a><span class="in">                    method="knn",</span></span>
<span id="cb46-534"><a href="#cb46-534" aria-hidden="true" tabindex="-1"></a><span class="in">                    metric=metric,</span></span>
<span id="cb46-535"><a href="#cb46-535" aria-hidden="true" tabindex="-1"></a><span class="in">                    tuneGrid=grid,</span></span>
<span id="cb46-536"><a href="#cb46-536" aria-hidden="true" tabindex="-1"></a><span class="in">                    trControl=trainControl)</span></span>
<span id="cb46-537"><a href="#cb46-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-538"><a href="#cb46-538" aria-hidden="true" tabindex="-1"></a><span class="in"># tuning kNN parameter</span></span>
<span id="cb46-539"><a href="#cb46-539" aria-hidden="true" tabindex="-1"></a><span class="in">plot(fitKnnUpVar)</span></span>
<span id="cb46-540"><a href="#cb46-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-541"><a href="#cb46-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-542"><a href="#cb46-542" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ensembles</span></span>
<span id="cb46-543"><a href="#cb46-543" aria-hidden="true" tabindex="-1"></a><span class="fu">### Stacking {#stacking}</span></span>
<span id="cb46-544"><a href="#cb46-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-545"><a href="#cb46-545" aria-hidden="true" tabindex="-1"></a>Another way to improve the accuracy is to combine the predictions of several models into ensemble predictions. To do this, we first have to make sure predictions from sub-models have a low correlation.</span>
<span id="cb46-546"><a href="#cb46-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-547"><a href="#cb46-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-correlogramPrediction}</span></span>
<span id="cb46-548"><a href="#cb46-548" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Correlogram of the predictions by models."</span></span>
<span id="cb46-549"><a href="#cb46-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-550"><a href="#cb46-550" aria-hidden="true" tabindex="-1"></a><span class="in"># correlation of models pairs of predictions</span></span>
<span id="cb46-551"><a href="#cb46-551" aria-hidden="true" tabindex="-1"></a><span class="in">corrplot(modelCor(results), method="pie")</span></span>
<span id="cb46-552"><a href="#cb46-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-553"><a href="#cb46-553" aria-hidden="true" tabindex="-1"></a>Here, that seems to be the case, since no one has a high correlation (*i.e* &gt; 0.75). I've decided to use both algorithms using nominal attributes and the *up-sampling* method to build a *meta*-model (<span class="in">`multiFit`</span>).</span>
<span id="cb46-554"><a href="#cb46-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-555"><a href="#cb46-555" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model_stack}</span></span>
<span id="cb46-556"><a href="#cb46-556" aria-hidden="true" tabindex="-1"></a><span class="in"># cross-validation</span></span>
<span id="cb46-557"><a href="#cb46-557" aria-hidden="true" tabindex="-1"></a><span class="in">stackControl = trainControl(method = "repeatedcv",</span></span>
<span id="cb46-558"><a href="#cb46-558" aria-hidden="true" tabindex="-1"></a><span class="in">                            number = 5,</span></span>
<span id="cb46-559"><a href="#cb46-559" aria-hidden="true" tabindex="-1"></a><span class="in">                            repeats = 2,</span></span>
<span id="cb46-560"><a href="#cb46-560" aria-hidden="true" tabindex="-1"></a><span class="in">                            savePredictions = "final",</span></span>
<span id="cb46-561"><a href="#cb46-561" aria-hidden="true" tabindex="-1"></a><span class="in">                            classProbs = TRUE)</span></span>
<span id="cb46-562"><a href="#cb46-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-563"><a href="#cb46-563" aria-hidden="true" tabindex="-1"></a><span class="in"># list of models</span></span>
<span id="cb46-564"><a href="#cb46-564" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-565"><a href="#cb46-565" aria-hidden="true" tabindex="-1"></a><span class="in">multiModels = caretList(Y~., data = dataTrainVar,</span></span>
<span id="cb46-566"><a href="#cb46-566" aria-hidden="true" tabindex="-1"></a><span class="in">                        methodList = c("glm", "knn"),</span></span>
<span id="cb46-567"><a href="#cb46-567" aria-hidden="true" tabindex="-1"></a><span class="in">                        tuneList = list(glm = caretModelSpec(method='glm',</span></span>
<span id="cb46-568"><a href="#cb46-568" aria-hidden="true" tabindex="-1"></a><span class="in">                                                             family='binomial'),</span></span>
<span id="cb46-569"><a href="#cb46-569" aria-hidden="true" tabindex="-1"></a><span class="in">                                        knn = caretModelSpec(method='knn')),</span></span>
<span id="cb46-570"><a href="#cb46-570" aria-hidden="true" tabindex="-1"></a><span class="in">                        trControl = trainControl)</span></span>
<span id="cb46-571"><a href="#cb46-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-572"><a href="#cb46-572" aria-hidden="true" tabindex="-1"></a><span class="in"># stacking</span></span>
<span id="cb46-573"><a href="#cb46-573" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-574"><a href="#cb46-574" aria-hidden="true" tabindex="-1"></a><span class="in">multiFits = caretEnsemble(multiModels,</span></span>
<span id="cb46-575"><a href="#cb46-575" aria-hidden="true" tabindex="-1"></a><span class="in">                          trControl = stackControl)</span></span>
<span id="cb46-576"><a href="#cb46-576" aria-hidden="true" tabindex="-1"></a><span class="in">print(multiFits)</span></span>
<span id="cb46-577"><a href="#cb46-577" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-578"><a href="#cb46-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-579"><a href="#cb46-579" aria-hidden="true" tabindex="-1"></a>The accuracy seems to be better than both algorithms alone (<span class="in">`Log`</span>: <span class="in">`r round(fitLogUpVar$results$Accuracy, 2)`</span> and <span class="in">`kNN`</span>: <span class="in">`r round(fitKnnUpVar$results$Accuracy, 2)`</span>, whereas <span class="in">`stacking`</span>: <span class="in">`r round(multiFits$error$Accuracy, 2)`</span>). However, the Kappa value of 0 is symptomatic of a problem that we're going to clarify when looking at the <span class="co">[</span><span class="ot">predictions</span><span class="co">](#prediction)</span>.</span>
<span id="cb46-580"><a href="#cb46-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-581"><a href="#cb46-581" aria-hidden="true" tabindex="-1"></a><span class="fu">### Boosting</span></span>
<span id="cb46-582"><a href="#cb46-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-583"><a href="#cb46-583" aria-hidden="true" tabindex="-1"></a>Another way to used ensemble predictions is to use an algorithm based on boosting method. The idea here is to build multiple models where each of which learns to fix the prediction errors of a prior model in the chain. Let's test one of the most popular boosting machine learning algorithms, the **C5.0** classification based on a set of rules.</span>
<span id="cb46-584"><a href="#cb46-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-585"><a href="#cb46-585" aria-hidden="true" tabindex="-1"></a><span class="in">```{r boosting}</span></span>
<span id="cb46-586"><a href="#cb46-586" aria-hidden="true" tabindex="-1"></a><span class="in"># C5.0 classification</span></span>
<span id="cb46-587"><a href="#cb46-587" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(7)</span></span>
<span id="cb46-588"><a href="#cb46-588" aria-hidden="true" tabindex="-1"></a><span class="in">fitC5UpVar = train(Y~., data = dataTrainVar,</span></span>
<span id="cb46-589"><a href="#cb46-589" aria-hidden="true" tabindex="-1"></a><span class="in">                   method = "C5.0Rules",</span></span>
<span id="cb46-590"><a href="#cb46-590" aria-hidden="true" tabindex="-1"></a><span class="in">                   metric = metric,</span></span>
<span id="cb46-591"><a href="#cb46-591" aria-hidden="true" tabindex="-1"></a><span class="in">                   trControl = trainControl)</span></span>
<span id="cb46-592"><a href="#cb46-592" aria-hidden="true" tabindex="-1"></a><span class="in">print(fitC5UpVar)</span></span>
<span id="cb46-593"><a href="#cb46-593" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-594"><a href="#cb46-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-595"><a href="#cb46-595" aria-hidden="true" tabindex="-1"></a><span class="fu"># Finalize Model</span></span>
<span id="cb46-596"><a href="#cb46-596" aria-hidden="true" tabindex="-1"></a><span class="fu">## Predictions on validation dataset {#prediction}</span></span>
<span id="cb46-597"><a href="#cb46-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-598"><a href="#cb46-598" aria-hidden="true" tabindex="-1"></a>Here comes the part where I've tested the two ensemble models (stacking and boosting) predictions on your validation dataset. But first, I have to pre-process this dataset to make sure both models will correctly run.</span>
<span id="cb46-599"><a href="#cb46-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-600"><a href="#cb46-600" aria-hidden="true" tabindex="-1"></a><span class="in">```{r validation_test}</span></span>
<span id="cb46-601"><a href="#cb46-601" aria-hidden="true" tabindex="-1"></a><span class="in"># remove missing value</span></span>
<span id="cb46-602"><a href="#cb46-602" aria-hidden="true" tabindex="-1"></a><span class="in">validationNa = na.omit(validation)</span></span>
<span id="cb46-603"><a href="#cb46-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-604"><a href="#cb46-604" aria-hidden="true" tabindex="-1"></a><span class="in"># keep the same attributes used in the learning dataset</span></span>
<span id="cb46-605"><a href="#cb46-605" aria-hidden="true" tabindex="-1"></a><span class="in">validationNa = validationNa[, .SD, .SDcols = colnames(dataTrainVar)]</span></span>
<span id="cb46-606"><a href="#cb46-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-607"><a href="#cb46-607" aria-hidden="true" tabindex="-1"></a><span class="in"># suitable name for R (i.e. the same as the learning dataset)</span></span>
<span id="cb46-608"><a href="#cb46-608" aria-hidden="true" tabindex="-1"></a><span class="in">validationNa[, Y:=make.names(Y)]</span></span>
<span id="cb46-609"><a href="#cb46-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-610"><a href="#cb46-610" aria-hidden="true" tabindex="-1"></a><span class="in"># Yeo-Johnson transform of the attribute AAGE</span></span>
<span id="cb46-611"><a href="#cb46-611" aria-hidden="true" tabindex="-1"></a><span class="in">validationNa$AAGE = predict(preprocessParams, validationNa[, "AAGE"])</span></span>
<span id="cb46-612"><a href="#cb46-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-613"><a href="#cb46-613" aria-hidden="true" tabindex="-1"></a><span class="in"># convert characters to factors</span></span>
<span id="cb46-614"><a href="#cb46-614" aria-hidden="true" tabindex="-1"></a><span class="in">ncolCha = names(which(sapply(validationNa, class) == "character"))</span></span>
<span id="cb46-615"><a href="#cb46-615" aria-hidden="true" tabindex="-1"></a><span class="in">validationNa[, (ncolCha) := lapply(.SD, as.factor), .SDcols=ncolCha]</span></span>
<span id="cb46-616"><a href="#cb46-616" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-617"><a href="#cb46-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-618"><a href="#cb46-618" aria-hidden="true" tabindex="-1"></a>Because I removed a lot of rows during the <span class="co">[</span><span class="ot">data cleaning</span><span class="co">](#dataCleaning)</span> step, it removed some levels of nominal attributes in the learning dataset. This implies that neither model can make prediction for this levels. To avoid errors when predicting on the validation dataset, I've removed any rows that do not match levels of the training dataset.</span>
<span id="cb46-619"><a href="#cb46-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-620"><a href="#cb46-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r levels_removed}</span></span>
<span id="cb46-621"><a href="#cb46-621" aria-hidden="true" tabindex="-1"></a><span class="in"># only keep levels of factors in the validation datatset that match those in the learning one</span></span>
<span id="cb46-622"><a href="#cb46-622" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in which(dataTrainVar[, lapply(.SD, class), .SDcols=-"Y"] == "factor")){</span></span>
<span id="cb46-623"><a href="#cb46-623" aria-hidden="true" tabindex="-1"></a><span class="in">  x = validationNa[, lapply(.SD, unique), .SDcols = i]</span></span>
<span id="cb46-624"><a href="#cb46-624" aria-hidden="true" tabindex="-1"></a><span class="in">  x = as.character(x[[1]])</span></span>
<span id="cb46-625"><a href="#cb46-625" aria-hidden="true" tabindex="-1"></a><span class="in">  y = dataTrainVar[, lapply(.SD, unique), .SDcols = i]</span></span>
<span id="cb46-626"><a href="#cb46-626" aria-hidden="true" tabindex="-1"></a><span class="in">  y = as.character(y[[1]])</span></span>
<span id="cb46-627"><a href="#cb46-627" aria-hidden="true" tabindex="-1"></a><span class="in">  if (length(setdiff(x, y))&gt;0){</span></span>
<span id="cb46-628"><a href="#cb46-628" aria-hidden="true" tabindex="-1"></a><span class="in">    delNrow = as.numeric()</span></span>
<span id="cb46-629"><a href="#cb46-629" aria-hidden="true" tabindex="-1"></a><span class="in">    for (j in 1:length(setdiff(x, y))){</span></span>
<span id="cb46-630"><a href="#cb46-630" aria-hidden="true" tabindex="-1"></a><span class="in">      delNrow = c(delNrow, which(validationNa[, i, with=F] == setdiff(x, y)[j]))</span></span>
<span id="cb46-631"><a href="#cb46-631" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb46-632"><a href="#cb46-632" aria-hidden="true" tabindex="-1"></a><span class="in">    validationNa = validationNa[-delNrow, ]</span></span>
<span id="cb46-633"><a href="#cb46-633" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb46-634"><a href="#cb46-634" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb46-635"><a href="#cb46-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-636"><a href="#cb46-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-637"><a href="#cb46-637" aria-hidden="true" tabindex="-1"></a>Now that we have a validation dataset that matches the same column names and levels of nominal attributes from the learning one, we can make predictions and compare them to the real values.</span>
<span id="cb46-638"><a href="#cb46-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-639"><a href="#cb46-639" aria-hidden="true" tabindex="-1"></a><span class="in">```{r prediction, eval=FALSE}</span></span>
<span id="cb46-640"><a href="#cb46-640" aria-hidden="true" tabindex="-1"></a><span class="in"># make prediction</span></span>
<span id="cb46-641"><a href="#cb46-641" aria-hidden="true" tabindex="-1"></a><span class="in">predictionsStack = predict(multiFits,</span></span>
<span id="cb46-642"><a href="#cb46-642" aria-hidden="true" tabindex="-1"></a><span class="in">                           validationNa[, .SD, .SDcols = -"Y"],</span></span>
<span id="cb46-643"><a href="#cb46-643" aria-hidden="true" tabindex="-1"></a><span class="in">                           type="raw")</span></span>
<span id="cb46-644"><a href="#cb46-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-645"><a href="#cb46-645" aria-hidden="true" tabindex="-1"></a><span class="in">predictionsC5 = predict(fitC5UpVar,</span></span>
<span id="cb46-646"><a href="#cb46-646" aria-hidden="true" tabindex="-1"></a><span class="in">                        validationNa[, .SD, .SDcols = -"Y"],</span></span>
<span id="cb46-647"><a href="#cb46-647" aria-hidden="true" tabindex="-1"></a><span class="in">                        type="raw")</span></span>
<span id="cb46-648"><a href="#cb46-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-649"><a href="#cb46-649" aria-hidden="true" tabindex="-1"></a><span class="in"># confusion matrix calculation</span></span>
<span id="cb46-650"><a href="#cb46-650" aria-hidden="true" tabindex="-1"></a><span class="in">confStack = confusionMatrix(predictionsStack, validationNa[, Y])</span></span>
<span id="cb46-651"><a href="#cb46-651" aria-hidden="true" tabindex="-1"></a><span class="in">confC5 = confusionMatrix(predictionsC5, validationNa[, Y])</span></span>
<span id="cb46-652"><a href="#cb46-652" aria-hidden="true" tabindex="-1"></a><span class="in">confStack</span></span>
<span id="cb46-653"><a href="#cb46-653" aria-hidden="true" tabindex="-1"></a><span class="in">confC5</span></span>
<span id="cb46-654"><a href="#cb46-654" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-655"><a href="#cb46-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-656"><a href="#cb46-656" aria-hidden="true" tabindex="-1"></a>We can see that the stacking model (*i.e* `Log` + `kNN`) has, indeed, an accuracy of `r round(multiFits$error$Accuracy, 2)` which is higher than the boosting model (*i.e* `C5.0`) with "only" `r round(fitC5UpVar$results$Accuracy, 2)`. However, the confusion matrix shows the stacking model simply predicts the same value (the one from the prevalent class), which results in a misleading accuracy (*i.e* accuracy = proportion of the majority class).</span>
<span id="cb46-657"><a href="#cb46-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-658"><a href="#cb46-658" aria-hidden="true" tabindex="-1"></a><span class="in">```{r accuracy, eval=FALSE}</span></span>
<span id="cb46-659"><a href="#cb46-659" aria-hidden="true" tabindex="-1"></a><span class="in"># accuracy &amp; proportion of the majority class</span></span>
<span id="cb46-660"><a href="#cb46-660" aria-hidden="true" tabindex="-1"></a><span class="in">accuracyStack = round(confStack$overall[1], 2)                     # accuracy of stack model</span></span>
<span id="cb46-661"><a href="#cb46-661" aria-hidden="true" tabindex="-1"></a><span class="in">propMajorClass = round(max(prop.table(table(validationNa$Y))), 2)  # prop of prevalent class</span></span>
<span id="cb46-662"><a href="#cb46-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-663"><a href="#cb46-663" aria-hidden="true" tabindex="-1"></a><span class="in"># accuracy = proportion of the majority class?</span></span>
<span id="cb46-664"><a href="#cb46-664" aria-hidden="true" tabindex="-1"></a><span class="in">accuracyStack == propMajorClass</span></span>
<span id="cb46-665"><a href="#cb46-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-666"><a href="#cb46-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-667"><a href="#cb46-667" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb46-668"><a href="#cb46-668" aria-hidden="true" tabindex="-1"></a><span class="fu">### Some insights</span></span>
<span id="cb46-669"><a href="#cb46-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-670"><a href="#cb46-670" aria-hidden="true" tabindex="-1"></a>Based on the calculation of variable importance in the <span class="in">`fitC5UpVar`</span> model, the three variables that, in order of importance, are the most important when estimating if the income level will be more than 50 000$ per annum seems to be:</span>
<span id="cb46-671"><a href="#cb46-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-672"><a href="#cb46-672" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the tax filer status (levels: Nonfiler)</span>
<span id="cb46-673"><a href="#cb46-673" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the age</span>
<span id="cb46-674"><a href="#cb46-674" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>the number of persons that worked for employer</span>
<span id="cb46-675"><a href="#cb46-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-676"><a href="#cb46-676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-varImportance}</span></span>
<span id="cb46-677"><a href="#cb46-677" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Distribution and barplot of the three most important variables when predicting the income level of the person represented by the record."</span></span>
<span id="cb46-678"><a href="#cb46-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-679"><a href="#cb46-679" aria-hidden="true" tabindex="-1"></a><span class="in"># variable importance for the fitC5UpVar model</span></span>
<span id="cb46-680"><a href="#cb46-680" aria-hidden="true" tabindex="-1"></a><span class="in">varImp(fitC5UpVar, scale = 100)</span></span>
<span id="cb46-681"><a href="#cb46-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-682"><a href="#cb46-682" aria-hidden="true" tabindex="-1"></a><span class="in"># some plot to illustrate</span></span>
<span id="cb46-683"><a href="#cb46-683" aria-hidden="true" tabindex="-1"></a><span class="in">grid.arrange(</span></span>
<span id="cb46-684"><a href="#cb46-684" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(dataset, aes(x = FILESTAT, fill=Y))+</span></span>
<span id="cb46-685"><a href="#cb46-685" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(position = position_dodge())+</span></span>
<span id="cb46-686"><a href="#cb46-686" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.position = "top"),</span></span>
<span id="cb46-687"><a href="#cb46-687" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(dataset, aes(x = AAGE, fill = Y))+</span></span>
<span id="cb46-688"><a href="#cb46-688" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar()+</span></span>
<span id="cb46-689"><a href="#cb46-689" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.position = "none"),</span></span>
<span id="cb46-690"><a href="#cb46-690" aria-hidden="true" tabindex="-1"></a><span class="in">  ggplot(dataset, aes(x = NOEMP, fill = Y))+</span></span>
<span id="cb46-691"><a href="#cb46-691" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_bar(position = position_dodge())+</span></span>
<span id="cb46-692"><a href="#cb46-692" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(legend.position="none"),</span></span>
<span id="cb46-693"><a href="#cb46-693" aria-hidden="true" tabindex="-1"></a><span class="in">  nrow = 3, heights = c(2, 1.5, 1.5))</span></span>
<span id="cb46-694"><a href="#cb46-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb46-695"><a href="#cb46-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-696"><a href="#cb46-696" aria-hidden="true" tabindex="-1"></a><span class="fu">### Go further</span></span>
<span id="cb46-697"><a href="#cb46-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-698"><a href="#cb46-698" aria-hidden="true" tabindex="-1"></a>Here are few ideas to improve this analysis:</span>
<span id="cb46-699"><a href="#cb46-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-700"><a href="#cb46-700" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Data Preparation</span>
<span id="cb46-701"><a href="#cb46-701" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span>Data cleaning</span>
<span id="cb46-702"><a href="#cb46-702" aria-hidden="true" tabindex="-1"></a><span class="ss">        - </span>Try to impute missing value using k nearest neighbors or bagged tree algorithm. It should allow the selected model to predict the income level for all people, regardless of the different levels of a factor in any nominal attributes.</span>
<span id="cb46-703"><a href="#cb46-703" aria-hidden="true" tabindex="-1"></a><span class="ss">        - </span>Look closer for outliers and maybe try some methods like PCA to remove noises.</span>
<span id="cb46-704"><a href="#cb46-704" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span>Data transform</span>
<span id="cb46-705"><a href="#cb46-705" aria-hidden="true" tabindex="-1"></a><span class="ss">        - </span>Try normalized numerical variables.</span>
<span id="cb46-706"><a href="#cb46-706" aria-hidden="true" tabindex="-1"></a><span class="ss">        - </span>Consider Box-Cox transform on other numerical attributes.</span>
<span id="cb46-707"><a href="#cb46-707" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span>Data split</span>
<span id="cb46-708"><a href="#cb46-708" aria-hidden="true" tabindex="-1"></a><span class="ss">        - </span>Simply use the whole learning dataset and not 10 \% of it.</span>
<span id="cb46-709"><a href="#cb46-709" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Evaluate algorithms</span>
<span id="cb46-710"><a href="#cb46-710" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span>Spot Check Algorithm: test more linear and non-linear algorithms.</span>
<span id="cb46-711"><a href="#cb46-711" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Improve accuracy</span>
<span id="cb46-712"><a href="#cb46-712" aria-hidden="true" tabindex="-1"></a><span class="ss">    + </span>Ensembles</span>
<span id="cb46-713"><a href="#cb46-713" aria-hidden="true" tabindex="-1"></a><span class="ss">        - </span>For boosting, it's the same, let's take a look at several boosting machine learning algorithms which seems to be very promising.</span>
<span id="cb46-714"><a href="#cb46-714" aria-hidden="true" tabindex="-1"></a><span class="ss">        - </span>For stacking, same as above, test different combinations of models, and then combine predictions using several different algorithms (*i.e* not just a simple linear model, like I did here).</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>